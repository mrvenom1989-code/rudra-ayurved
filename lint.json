[{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\actions.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'minutes' is never reassigned. Use 'const' instead.","line":56,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":56,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7465,7468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7465,7468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is assigned a value but never used.","line":351,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":351,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'limit' is assigned a value but never used.","line":351,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":351,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAll' is assigned a value but never used.","line":351,"column":84,"nodeType":"Identifier","messageId":"unusedVar","endLine":351,"endColumn":91},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":356,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":356,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":356,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12104,12107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12104,12107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":360,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":360,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":360,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":360,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12197,12200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12197,12200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":364,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":364,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'itemId' is defined but never used.","line":372,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":372,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qty' is defined but never used.","line":372,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":372,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used.","line":376,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":376,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'start' is defined but never used.","line":376,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":376,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'end' is defined but never used.","line":376,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":376,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":380,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":380,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":380,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12627,12630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12627,12630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":384,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":384,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":388,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":388,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'patientId' is defined but never used.","line":388,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":388,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":392,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":392,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'discount' is defined but never used.","line":392,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":392,"endColumn":72},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'total' is defined but never used.","line":392,"column":82,"nodeType":"Identifier","messageId":"unusedVar","endLine":392,"endColumn":87},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'paymentMode' is defined but never used.","line":392,"column":97,"nodeType":"Identifier","messageId":"unusedVar","endLine":392,"endColumn":108},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'start' is defined but never used.","line":397,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":397,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'end' is defined but never used.","line":397,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":397,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":431,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":431,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":435,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":435,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":435,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":435,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14050,14053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14050,14053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":439,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":439,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":439,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":439,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14180,14183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14180,14183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":25,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\n\nimport { Prisma } from \"@prisma/client\";\nimport { prisma as db } from \"@/lib/prisma\";\nimport { revalidatePath } from \"next/cache\";\nimport { getSession, createSession } from \"@/lib/auth\";\nimport bcrypt from \"bcryptjs\";\n\n// ==========================================\n// üõ†Ô∏è HELPER: SMART ID GENERATOR\n// ==========================================\nasync function generateReadableId(type: 'patient' | 'opd' | 'ipd') {\n  const counterName = type === 'patient' ? 'patient' : (type === 'opd' ? 'appointment_opd' : 'appointment_ipd');\n  const prefix = type === 'patient' ? 'RA-' : (type === 'opd' ? 'RAOPD' : 'RAIPD');\n\n  try {\n    const counter = await db.counter.upsert({\n      where: { name: counterName },\n      update: { value: { increment: 1 } },\n      create: { name: counterName, value: 663 }\n    });\n    return `${prefix}${counter.value.toString().padStart(4, '0')}`;\n  } catch (error) {\n    console.error(\"ID Gen Error:\", error);\n    return `${prefix}${Date.now().toString().slice(-4)}`;\n  }\n}\n\n// ‚úÖ HELPER: Get Role\nexport async function getCurrentUserRole() {\n  const session = await getSession();\n  return session?.role || \"STAFF\";\n}\n\n// ‚úÖ LOGIN ACTION\nexport async function loginAction(email: string, pass: string) {\n  try {\n    const user = await db.user.findUnique({ where: { email } });\n    if (!user) return { success: false, error: \"User not found\" };\n\n    const isValid = await bcrypt.compare(pass, user.password);\n    if (!isValid) return { success: false, error: \"Invalid credentials\" };\n\n    await createSession({ userId: user.id, email: user.email, role: user.role, name: user.name });\n    return { success: true };\n  } catch (error) {\n    console.error(\"Login Error:\", error);\n    return { success: false, error: \"Login failed\" };\n  }\n}\n\n// ‚úÖ HELPER: Parse Time for Validation\nfunction parseTime(timeStr: string) {\n  if (!timeStr) return 0;\n  const [time, modifier] = timeStr.split(' ');\n  let [hours, minutes] = time.split(':').map(Number);\n  if (hours === 12) {\n    hours = 0;\n  }\n  if (modifier === 'PM' && hours < 12) {\n    hours += 12;\n  }\n  return hours * 60 + (minutes || 0);\n}\n\n// ==========================================\n// 1. üè• PATIENT MANAGEMENT\n// ==========================================\n\nexport async function getPatients(query?: string) {\n  try {\n    const where: Prisma.PatientWhereInput = {};\n    if (query) {\n      where.OR = [\n        { name: { contains: query, mode: 'insensitive' } },\n        { phone: { contains: query } },\n        { readableId: { contains: query, mode: 'insensitive' } }\n      ];\n    }\n\n    // ‚úÖ FIX: Calculate Today in IST (India Standard Time)\n    // This ensures we get the correct \"Today\" even if server is in UTC\n    const now = new Date();\n    const istOffset = 5.5 * 60 * 60 * 1000;\n    const istDate = new Date(now.getTime() + istOffset);\n    const today = istDate.toISOString().split('T')[0];\n\n    return await db.patient.findMany({\n      where,\n      orderBy: { updatedAt: 'desc' },\n      take: 50,\n      include: {\n        // ‚úÖ FETCH ACTIVE APPOINTMENT\n        // If status is \"SCHEDULED\", it means consultation is NOT saved yet.\n        appointments: {\n          where: {\n            date: today,\n            status: \"SCHEDULED\"\n          },\n          select: {\n            readableId: true\n          },\n          take: 1\n        }\n      }\n    });\n  } catch { return []; }\n}\n\nexport async function getPatientData(patientId: string) {\n  try {\n    return await db.patient.findUnique({\n      where: { id: patientId },\n      include: {\n        consultations: {\n          orderBy: { createdAt: 'desc' },\n          include: {\n            appointment: true,\n            prescriptions: { include: { items: { include: { medicine: true } } } }\n          }\n        }\n      }\n    });\n  } catch { return null; }\n}\n\nexport async function createPatient(data: Omit<Prisma.PatientCreateInput, 'readableId'>) {\n  try {\n    const readableId = await generateReadableId('patient');\n    const newPatient = await db.patient.create({\n      data: {\n        ...data,\n        readableId,\n        age: Number(data.age) || 0,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      } as Prisma.PatientCreateInput\n    });\n    revalidatePath('/patients');\n    return { success: true, patient: newPatient };\n  } catch (error) {\n    console.error(\"Create Patient Error:\", error);\n    return { success: false, error: \"Failed to create patient\" };\n  }\n}\n\nexport async function updatePatient(id: string, data: Prisma.PatientUpdateInput) {\n  try {\n    const ageVal = isNaN(Number(data.age)) ? undefined : Number(data.age);\n    await db.patient.update({\n      where: { id },\n      data: {\n        ...data,\n        age: ageVal,\n      }\n    });\n    revalidatePath(`/patients/${id}`); revalidatePath('/patients');\n    return { success: true };\n  } catch {\n    return { success: false, error: \"Update failed\" };\n  }\n}\n\nexport async function deletePatient(id: string) {\n  try {\n    await db.patient.delete({ where: { id } });\n    revalidatePath('/patients');\n    return { success: true };\n  } catch { return { success: false, error: \"Failed to delete\" }; }\n}\n\nexport async function searchPatients(query: string) {\n  if (!query) return [];\n  return await db.patient.findMany({\n    where: {\n      OR: [\n        { name: { contains: query, mode: 'insensitive' } },\n        { phone: { contains: query } },\n        { readableId: { contains: query, mode: 'insensitive' } }\n      ]\n    },\n    take: 5,\n    select: { id: true, name: true, phone: true, readableId: true, walletBalance: true }\n  });\n}\n\n// ‚úÖ NEW ACTION: Update Wallet (Credit / Due)\nexport async function updatePatientWallet(patientId: string, amount: number, type: 'CREDIT' | 'DUE') {\n  try {\n    const numericAmount = parseFloat(amount.toString());\n    if (isNaN(numericAmount) || numericAmount <= 0) return { success: false, error: \"Invalid amount\" };\n\n    const adjustment = type === 'CREDIT' ? numericAmount : -numericAmount;\n\n    await db.patient.update({\n      where: { id: patientId },\n      data: { walletBalance: { increment: adjustment } }\n    });\n\n    revalidatePath('/patients');\n    revalidatePath(`/patients/${patientId}`);\n    revalidatePath('/pharmacy');\n\n    return { success: true };\n  } catch (error) {\n    console.error(\"Wallet Update Error:\", error);\n    return { success: false, error: \"Failed to update wallet\" };\n  }\n}\n\n// ==========================================\n// 2. üìÖ APPOINTMENT & CALENDAR\n// ==========================================\n\nexport async function getAppointments(start?: string, end?: string) {\n  try {\n    const where: Prisma.AppointmentWhereInput = {};\n    if (start && end) where.date = { gte: start, lte: end };\n    return await db.appointment.findMany({ where, orderBy: { startTime: 'asc' } });\n  } catch { return []; }\n}\n\nexport async function completeAppointment(id: string, discount: number = 0) {\n  try {\n    await db.appointment.update({\n      where: { id },\n      data: { status: \"COMPLETED\", discount: discount }\n    });\n    revalidatePath(\"/dashboard\"); revalidatePath(\"/calendar\");\n    return { success: true };\n  } catch { return { success: false, error: \"Failed to complete appointment\" }; }\n}\n\nexport async function markReminderSent(id: string) {\n  try {\n    await db.appointment.update({ where: { id }, data: { reminderSent: true } });\n    revalidatePath(\"/dashboard\");\n    return { success: true };\n  } catch { return { success: false }; }\n}\n\nexport async function createAppointment(data: any) {\n  try {\n    if (data.endTime && parseTime(data.startTime) >= parseTime(data.endTime)) {\n      return { success: false, error: \"End time must be after start time.\" };\n    }\n    const count = data.recurring?.count || 1;\n    const frequency = data.recurring?.frequency || 'daily';\n    const customDates = data.recurring?.customDates || [];\n    const targetDates: string[] = [];\n\n    if (frequency === 'custom') {\n      targetDates.push(data.date);\n      if (Array.isArray(customDates)) {\n        customDates.forEach((d: string) => { if (d && !targetDates.includes(d)) targetDates.push(d); });\n      }\n    } else {\n      for (let i = 0; i < count; i++) {\n        const dateObj = new Date(data.date);\n        if (frequency === 'daily') dateObj.setDate(dateObj.getDate() + i);\n        else if (frequency === 'weekly') dateObj.setDate(dateObj.getDate() + (i * 7));\n        else if (frequency === 'biweekly') dateObj.setDate(dateObj.getDate() + (i * 14));\n        else if (frequency === 'monthly') dateObj.setMonth(dateObj.getMonth() + i);\n        targetDates.push(dateObj.toISOString().split('T')[0]);\n      }\n    }\n\n    if (data.type !== \"Unavailable\") {\n      for (const dateString of targetDates) {\n        const conflict = await db.appointment.findFirst({\n          where: {\n            doctor: data.doctor, date: dateString, status: { not: \"CANCELLED\" },\n            AND: [{ startTime: { lt: data.endTime || data.startTime } }, { endTime: { gt: data.startTime } }]\n          }\n        });\n        if (conflict) return { success: false, error: `Slot busy on ${dateString}. Booking failed.` };\n      }\n    }\n\n    let patientId = data.patientId;\n    if (!patientId && data.phone) {\n      const cleanPhone = data.phone.trim().replace(/\\s/g, '');\n      const isDummyPhone = cleanPhone === \"+91\" || cleanPhone.length < 10;\n      let existingPatient = null;\n      if (!isDummyPhone) {\n        existingPatient = await db.patient.findFirst({\n          where: { phone: data.phone, name: { equals: data.patientName, mode: 'insensitive' } }\n        });\n      }\n      if (existingPatient) {\n        patientId = existingPatient.id;\n      } else {\n        const newPatient = await db.patient.create({\n          data: {\n            readableId: await generateReadableId('patient'),\n            name: data.patientName, phone: data.phone, age: 0, gender: \"Unknown\"\n          }\n        });\n        patientId = newPatient.id as string;\n      }\n    }\n\n    const idType = data.type.includes('Panchkarma') ? 'ipd' : 'opd';\n    for (const dateString of targetDates) {\n      const readableId = await generateReadableId(idType);\n      await db.appointment.create({\n        data: {\n          ...data,\n          patientId,\n          readableId, date: dateString, startTime: data.startTime, endTime: data.endTime || data.startTime,\n          status: \"SCHEDULED\", fee: 500, discount: 0\n        }\n      });\n    }\n    revalidatePath(\"/calendar\");\n    return { success: true };\n  } catch { return { success: false, error: \"Failed to book appointment\" }; }\n}\n\nexport async function updateAppointment(data: Prisma.AppointmentUpdateInput & { id: string }) {\n  try {\n    if (data.endTime && data.startTime && parseTime(data.startTime.toString()) >= parseTime(data.endTime.toString())) {\n      return { success: false, error: \"End time must be after start time.\" };\n    }\n    if (data.type !== \"Unavailable\") {\n      const conflict = await db.appointment.findFirst({\n        where: {\n          doctor: data.doctor as string, date: data.date as string, status: { not: \"CANCELLED\" }, id: { not: data.id },\n          AND: [{ startTime: { lt: data.endTime as string | undefined || data.startTime as string } }, { endTime: { gt: data.startTime as string } }]\n        }\n      });\n      if (conflict) return { success: false, error: `Doctor is already booked during this time.` };\n    }\n    await db.appointment.update({\n      where: { id: data.id },\n      data,\n    });\n    revalidatePath(\"/calendar\");\n    return { success: true };\n  } catch { return { success: false, error: \"Failed to update\" }; }\n}\n\nexport async function deleteAppointment(id: string) {\n  try { await db.appointment.delete({ where: { id } }); revalidatePath(\"/calendar\"); return { success: true }; } catch { return { success: false, error: \"Failed to delete\" }; }\n}\n\n// ==========================================\n// 3. üíä PHARMACY ACTIONS (STUBS/IMPLEMENTATION)\n// ==========================================\n\nexport async function getPharmacyInventory(query: string = \"\", limit: number = 50, showAll: boolean = false) {\n  // Stub: return empty list\n  return [];\n}\n\nexport async function createMedicine(data: any) {\n  return { success: true };\n}\n\nexport async function updateMedicine(id: string, data: any) {\n  return { success: true };\n}\n\nexport async function deleteMedicine(id: string) {\n  return { success: true };\n}\n\nexport async function getPharmacyQueue() {\n  return [];\n}\n\nexport async function dispenseMedicine(itemId: string, qty: number) {\n  return { success: true };\n}\n\nexport async function getDispensedHistory(query: string, start?: string, end?: string) {\n  return [];\n}\n\nexport async function savePrescription(data: any): Promise<{ success: boolean; error?: string }> {\n  return { success: true };\n}\n\nexport async function reopenConsultation(id: string): Promise<{ success: boolean; error?: string }> {\n  return { success: true };\n}\n\nexport async function deleteVisit(id: string, patientId: string): Promise<{ success: boolean; error?: string }> {\n  return { success: true };\n}\n\nexport async function updateConsultationFinancials(id: string, discount: number, total: number, paymentMode: string): Promise<{ success: boolean; error?: string }> {\n  return { success: true };\n}\n\n\nexport async function getReportData(start: string, end: string) {\n  // Stub implementation\n  return {\n    summary: {\n      totalRevenue: 0,\n      totalPatients: 0,\n      pharmacyRevenue: 0,\n      panchkarmaRevenue: 0,\n      appointmentRevenue: 0,\n      totalPrescriptions: 0,\n      totalWeightLoss: 0,\n      weightLossByGender: { Male: 0, Female: 0 }\n    },\n    charts: {\n      revenueOverTime: [],\n      topMedicines: []\n    },\n    rawTransactions: [],\n    weightLossPatients: []\n  };\n}\n\nexport async function getDashboardStats() {\n  return {\n    appointments: 0,\n    requests: [],\n    queue: 0,\n    lowStock: 0,\n    recent: [],\n    upcoming: [],\n    userName: \"Admin\"\n  };\n}\n\nexport async function completeRequest(id: string): Promise<{ success: boolean; error?: string }> {\n  return { success: true };\n}\n\nexport async function createConsultationRequest(data: any): Promise<{ success: boolean; error?: string }> {\n  return { success: true };\n}\n\nexport async function createDirectSale(data: any): Promise<{ success: boolean; error?: string }> {\n  return { success: true };\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\admin\\users\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\admin\\users\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\calendar\\page.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/rules-of-hooks').","line":122,"column":5,"severity":1,"nodeType":null,"fix":{"range":[4223,4277],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/rules-of-hooks').","line":128,"column":7,"severity":1,"nodeType":null,"fix":{"range":[4373,4427],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/rules-of-hooks').","line":130,"column":7,"severity":1,"nodeType":null,"fix":{"range":[4469,4523],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/rules-of-hooks').","line":137,"column":7,"severity":1,"nodeType":null,"fix":{"range":[4696,4750],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":4,"source":"\"use client\";\n\nimport { useState, useEffect, Suspense } from \"react\";\nimport { useSearchParams, useRouter } from \"next/navigation\";\nimport { format, addDays, startOfWeek, differenceInMinutes, parse, isSameDay, addMinutes } from \"date-fns\";\nimport { ChevronLeft, ChevronRight, Ban, Loader2 } from \"lucide-react\";\n\nimport AppointmentModal from \"@/components/AppointmentModal\"; \nimport StaffHeader from \"@/app/components/StaffHeader\";\nimport { getAppointments, createAppointment, updateAppointment, deleteAppointment, completeRequest } from \"@/app/actions\";\n\n// --- TYPES ---\ntype Appointment = {\n  id: string;\n  readableId: string | null;\n  date: string;\n  startTime: string;\n  endTime: string;\n  type: string;\n  status: string;\n  fee: number;\n  discount: number;\n  reminderSent: boolean;\n  doctor: string;\n  patientName: string;\n  phone: string;\n  patientId: string | null;\n};\n\ntype AppointmentWithLanes = Appointment & {\n  laneIndex: number;\n  startObj: Date;\n  endObj: Date;\n  effectiveEndObj: Date;\n};\n\n\n// --- CONFIG ---\nconst START_HOUR = 7; \nconst END_HOUR = 20;\nconst SLOT_DURATION = 10; \nconst TOTAL_MINUTES = (END_HOUR - START_HOUR) * 60;\nconst PIXELS_PER_MINUTE = 1.8;\nconst SLOT_HEIGHT = SLOT_DURATION * PIXELS_PER_MINUTE; \nconst HOURS = Array.from({ length: END_HOUR - START_HOUR + 1 }, (_, i) => START_HOUR + i);\nconst SLOTS_PER_HOUR = 60 / SLOT_DURATION; \nconst VISUAL_BLOCK_BUFFER = 15; \n\n// ‚úÖ HELPER: Lane Layout Algorithm\nconst calculateLanes = (appointments: Appointment[]) => {\n  const sorted = [...appointments].sort((a, b) => {\n     const startA = parse(a.startTime, 'hh:mm a', new Date());\n     const startB = parse(b.startTime, 'hh:mm a', new Date());\n     return startA.getTime() - startB.getTime();\n  });\n\n  const lanes: Appointment[][] = []; \n\n  const result: AppointmentWithLanes[] = sorted.map(apt => {\n     const start = parse(apt.startTime, 'hh:mm a', new Date());\n     let end = parse(apt.endTime || apt.startTime, 'hh:mm a', new Date());\n     \n     if (end <= start) end = addMinutes(start, SLOT_DURATION);\n\n     const duration = differenceInMinutes(end, start);\n     const effectiveEnd = duration < VISUAL_BLOCK_BUFFER ? addMinutes(start, VISUAL_BLOCK_BUFFER) : end;\n\n     let laneIndex = -1;\n     for (let i = 0; i < lanes.length; i++) {\n         const lastInLane = lanes[i][lanes[i].length - 1];\n         const lastStart = parse(lastInLane.startTime, 'hh:mm a', new Date());\n         let lastEnd = parse(lastInLane.endTime || lastInLane.startTime, 'hh:mm a', new Date());\n         if (lastEnd <= lastStart) lastEnd = addMinutes(lastStart, SLOT_DURATION);\n\n         const lastDuration = differenceInMinutes(lastEnd, lastStart);\n         const lastEffectiveEnd = lastDuration < VISUAL_BLOCK_BUFFER ? addMinutes(lastStart, VISUAL_BLOCK_BUFFER) : lastEnd;\n         \n         if (lastEffectiveEnd <= start) {\n             laneIndex = i;\n             lanes[i].push(apt);\n             break;\n         }\n     }\n\n     if (laneIndex === -1) {\n         lanes.push([apt]);\n         laneIndex = lanes.length - 1;\n     }\n\n     return { ...apt, laneIndex, startObj: start, endObj: end, effectiveEndObj: effectiveEnd };\n  });\n\n  return { appointmentsWithLanes: result, totalLanes: lanes.length };\n};\n\nfunction WeeklyCalendar() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n\n  const reqId = searchParams.get('reqId');\n  const reqName = searchParams.get('name');\n  const reqPhone = searchParams.get('phone');\n\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [initialData, setInitialData] = useState<Partial<Appointment> | null>(null);\n  const [editingAppointment, setEditingAppointment] = useState<Appointment | null>(null);\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const startDate = startOfWeek(currentDate, { weekStartsOn: 1 });\n  const weekDays = Array.from({ length: 7 }).map((_, i) => addDays(startDate, i));\n\n  const loadData = async () => {\n    setIsLoading(true);\n    const data = await getAppointments();\n    setAppointments(data as Appointment[]);\n    setIsLoading(false);\n  };\n  \n  useEffect(() => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    loadData();\n  }, [currentDate]);\n\n  useEffect(() => {\n    if (reqName && reqPhone) {\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      setEditingAppointment(null);\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      setInitialData({\n        patientName: reqName,\n        phone: reqPhone,\n        date: format(new Date(), \"yyyy-MM-dd\"),\n        startTime: \"10:00 AM\"\n      });\n      // eslint-disable-next-line react-hooks/rules-of-hooks\n      setIsModalOpen(true);\n    }\n  }, [reqName, reqPhone]);\n\n  const handleSave = async (data: Appointment) => {\n    let result;\n    if (editingAppointment) {\n      setAppointments(prev => prev.map(a => a.id === data.id ? { ...data, id: a.id } : a));\n      result = await updateAppointment(data);\n    } else {\n      result = await createAppointment(data);\n    }\n\n    if (!result.success) {\n      alert(result.error); \n      loadData(); \n      return; \n    }\n\n    setIsModalOpen(false);\n    if (!editingAppointment && reqId) {\n      await completeRequest(reqId);\n      router.replace('/calendar'); \n    }\n    loadData(); \n  };\n\n  const handleDelete = async (id: string) => {\n    if(!confirm(\"Are you sure you want to delete this booking?\")) return;\n    setIsModalOpen(false);\n    setAppointments(prev => prev.filter(a => a.id !== id)); \n    await deleteAppointment(id); \n  };\n\n  const blockWholeDay = async (date: Date) => {\n    const dateStr = format(date, \"yyyy-MM-dd\");\n    if(confirm(`Mark ${dateStr} as Holiday? (Blocks entire day)`)) {\n      const holidayBlock = {\n        patientName: \"HOLIDAY / CLOSED\",\n        phone: \"-\", \n        doctor: \"All\",\n        date: dateStr,\n        startTime: \"07:00 AM\", \n        endTime: \"08:00 PM\",\n        type: \"Unavailable\"\n      };\n      await createAppointment(holidayBlock as Appointment);\n      loadData();\n    }\n  };\n\n  const getCardColor = (apt: Appointment) => {\n    if (apt.type === 'Unavailable') return 'bg-gray-100 border-gray-400 text-gray-500 opacity-90';\n    \n    if (apt.doctor && (apt.doctor.includes('Dipal') || apt.doctor.includes('Cosmetology'))) {\n        return 'bg-purple-50 border-purple-600 text-purple-900';\n    }\n    \n    if (apt.type.includes('Panchkarma')) {\n        return 'bg-[#c5a059]/20 border-[#c5a059] text-[#7d5f2a]'; \n    }\n    \n    return 'bg-[#1e3a29]/10 border-[#1e3a29] text-[#1e3a29]'; \n  };\n\n  const getProcessedStyles = (apt: AppointmentWithLanes, dayAppointments: AppointmentWithLanes[]) => {\n      const startMinutes = (apt.startObj.getHours() * 60 + apt.startObj.getMinutes()) - (START_HOUR * 60);\n      const durationMinutes = differenceInMinutes(apt.endObj, apt.startObj);\n      \n      const overlaps = dayAppointments.filter(other => {\n          return (apt.startObj < other.effectiveEndObj && apt.effectiveEndObj > other.startObj);\n      });\n      \n      const maxLanesInGroup = new Set(overlaps.map((o: AppointmentWithLanes) => o.laneIndex)).size; \n      \n      const widthPercent = 100 / (maxLanesInGroup || 1);\n      const leftPercent = (apt.laneIndex * widthPercent);\n\n      return {\n          top: `${startMinutes * PIXELS_PER_MINUTE}px`,\n          height: `${Math.max(durationMinutes * PIXELS_PER_MINUTE, 22)}px`,\n          width: `${widthPercent}%`,\n          left: `${leftPercent}%`\n      };\n  };\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <header className=\"bg-white border-b px-6 py-4 flex justify-between items-center shrink-0 z-20 shadow-sm\">\n        <div>\n           <h1 className=\"text-2xl font-serif font-bold text-[#1e3a29] flex items-center gap-2\">\n             Weekly Schedule {isLoading && <Loader2 className=\"animate-spin text-[#c5a059]\" size={20}/>}\n           </h1>\n           <p className=\"text-sm text-gray-500\">{isLoading ? \"Loading...\" : `Managing ${appointments.length} entries`}</p>\n        </div>\n        <div className=\"flex items-center gap-4\">\n           <div className=\"flex items-center bg-white border rounded-lg\">\n             <button onClick={() => setCurrentDate(addDays(currentDate, -7))} className=\"p-2 hover:bg-gray-100\"><ChevronLeft size={20}/></button>\n             <span className=\"px-4 font-medium text-[#1e3a29] w-32 text-center\">{format(startDate, \"MMM d\")} - {format(addDays(startDate, 6), \"MMM d\")}</span>\n             <button onClick={() => setCurrentDate(addDays(currentDate, 7))} className=\"p-2 hover:bg-gray-100\"><ChevronRight size={20}/></button>\n           </div>\n           <button onClick={() => setCurrentDate(new Date())} className=\"bg-[#1e3a29] text-white px-4 py-2 rounded-lg text-sm\">Today</button>\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-y-auto relative custom-scrollbar\">\n        <div className=\"flex min-w-[1000px]\">\n          {/* Time Labels */}\n          <div className=\"w-16 bg-white border-r sticky left-0 z-20 shadow-[2px_0_5px_rgba(0,0,0,0.05)]\">\n             <div className=\"h-12 border-b bg-gray-50\"></div> \n             <div className=\"relative\" style={{ height: TOTAL_MINUTES * PIXELS_PER_MINUTE }}>\n               {HOURS.map(h => (\n                 <div key={h} className=\"absolute w-full text-right pr-2 text-xs text-gray-400 font-bold -mt-2\" style={{ top: (h - START_HOUR) * 60 * PIXELS_PER_MINUTE }}>\n                   {h > 12 ? h - 12 : h} {h >= 12 ? 'PM' : 'AM'}\n                 </div>\n               ))}\n             </div>\n          </div>\n\n          {/* Days */}\n          {weekDays.map((day) => {\n            const dateStr = format(day, 'yyyy-MM-dd');\n            const isToday = isSameDay(day, new Date());\n            \n            // ‚úÖ FIX: Robust Date Filtering (Ignores Time/Timezone Mismatch)\n            const dayRawAppointments = appointments.filter(a => {\n                if (!a.date) return false;\n                const aptDate = a.date.toString().split('T')[0]; // Extract YYYY-MM-DD\n                return aptDate === dateStr;\n            });\n            \n            const { appointmentsWithLanes } = calculateLanes(dayRawAppointments);\n\n            return (\n              <div key={day.toString()} className=\"flex-1 border-r min-w-[140px] bg-white relative group/col\">\n                <div className={`h-12 border-b flex justify-between items-center px-2 sticky top-0 z-10 bg-white ${isToday ? 'bg-[#c5a059]/10' : ''}`}>\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-[10px] uppercase font-bold text-gray-400\">{format(day, \"EEE\")}</span>\n                    <span className={`text-sm font-serif font-bold ${isToday ? 'text-[#c5a059]' : 'text-[#1e3a29]'}`}>{format(day, \"d\")}</span>\n                  </div>\n                  <button onClick={() => blockWholeDay(day)} title=\"Block Whole Day\" className=\"text-gray-300 hover:text-red-500 opacity-0 group-hover/col:opacity-100 transition p-1\"><Ban size={16} /></button>\n                </div>\n\n                <div className=\"relative\" style={{ height: TOTAL_MINUTES * PIXELS_PER_MINUTE }}>\n                  {HOURS.map(h => (\n                    <div key={h} className=\"absolute w-full border-b border-gray-100\" style={{ top: (h - START_HOUR) * 60 * PIXELS_PER_MINUTE }}></div>\n                  ))}\n                  \n                  {Array.from({ length: (END_HOUR - START_HOUR) * SLOTS_PER_HOUR }).map((_, i) => {\n                      const minutesFromStart = i * SLOT_DURATION;\n                      const hour = START_HOUR + Math.floor(minutesFromStart / 60);\n                      const minute = minutesFromStart % 60;\n                      return (\n                        <div key={i}\n                          onClick={() => {\n                            setEditingAppointment(null);\n                            const timeDate = new Date();\n                            timeDate.setHours(hour, minute);\n                            setInitialData({ date: dateStr, startTime: format(timeDate, \"hh:mm a\") });\n                            setIsModalOpen(true);\n                          }}\n                          className=\"absolute w-full border-b border-dashed border-gray-50 hover:bg-blue-50/30 transition cursor-pointer z-0\"\n                          style={{ top: minutesFromStart * PIXELS_PER_MINUTE, height: SLOT_HEIGHT }}\n                        />\n                      );\n                  })}\n\n                  {appointmentsWithLanes.map((apt) => (\n                      <div key={apt.id}\n                        onClick={(e) => { e.stopPropagation(); setEditingAppointment(apt); setIsModalOpen(true); }}\n                        className={`absolute rounded-sm px-1 py-0 border-l-4 border-white shadow-sm cursor-pointer z-10 overflow-hidden hover:z-50 hover:shadow-xl transition flex flex-col justify-center ${getCardColor(apt)}`}\n                        style={{\n                          ...getProcessedStyles(apt, appointmentsWithLanes),\n                          backgroundImage: apt.type === 'Unavailable' ? 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(0,0,0,0.05) 5px, rgba(0,0,0,0.05) 10px)' : 'none'\n                        }}\n                      >\n                        {apt.type === 'Unavailable' ? (\n                          <div className=\"font-bold tracking-widest text-center uppercase flex items-center justify-center gap-1\"><Ban size={12}/> CLOSED</div>\n                        ) : (\n                          <>\n                            <div className=\"flex items-center gap-1 leading-none h-full w-full overflow-hidden\">\n                                {apt.readableId && <span className=\"text-[9px] font-bold opacity-75 whitespace-nowrap\">#{apt.readableId}</span>}\n                                <span className=\"text-[10px] font-bold truncate leading-none\">{apt.patientName}</span>\n                            </div>\n                            \n                            {parseInt(getProcessedStyles(apt, appointmentsWithLanes).height as string) > 35 && (\n                               <>\n                                 <div className=\"opacity-80 truncate text-[9px] mt-0.5\">{apt.startTime} - {apt.endTime}</div>\n                                 <div className={`inline-block px-1 rounded-sm mt-0.5 text-[8px] font-bold uppercase tracking-wider ${apt.type.includes('Panchkarma') ? 'bg-[#c5a059] text-white' : 'bg-black/5'}`}>\n                                   {apt.type}\n                                 </div>\n                               </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                  ))}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      <AppointmentModal \n        isOpen={isModalOpen} \n        onClose={() => setIsModalOpen(false)}\n        initialData={initialData}\n        existingAppointment={editingAppointment}\n        onSave={handleSave}\n        onDelete={handleDelete}\n      />\n    </div>\n  );\n}\n\nexport default function CalendarPage() {\n  return (\n    <div className=\"h-screen bg-[#FDFBF7] flex flex-col font-sans text-neutral-800\">\n      <StaffHeader />\n      <div className=\"flex-1 overflow-hidden\">\n        <Suspense fallback={<div className=\"h-full flex items-center justify-center\"><Loader2 className=\"animate-spin text-[#c5a059]\" size={40}/></div>}>\n          <WeeklyCalendar />\n        </Suspense>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\components\\BillGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\components\\StaffHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\dashboard\\page.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'minutes' is never reassigned. Use 'const' instead.","line":133,"column":26,"nodeType":"Identifier","messageId":"useConst","endLine":133,"endColumn":33},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":501,"column":32,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click &quot;Send\" to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click &ldquo;Send\" to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click &#34;Send\" to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click &rdquo;Send\" to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":501,"column":37,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click \"Send&quot; to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click \"Send&ldquo; to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click \"Send&#34; to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[25515,25644],"text":"\n                    Tip: Click \"Send&rdquo; to open WhatsApp. The button will turn green to help you track progress.\n                 "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport Link from \"next/link\";\nimport { \n  Calendar, Users, \n  AlertTriangle, Clock, ChevronRight, Loader2, Trash2,\n  RefreshCw, CheckCircle, BadgePercent, X, MessageCircle, ListChecks \n} from \"lucide-react\";\nimport { getDashboardStats, completeRequest, completeAppointment } from \"@/app/actions\"; \nimport StaffHeader from \"@/app/components/StaffHeader\"; \n\n// --- TYPES ---\ntype Appointment = {\n  id: string;\n  readableId: string | null;\n  date: string;\n  startTime: string;\n  endTime: string;\n  type: string;\n  status: string;\n  fee: number;\n  discount: number;\n  reminderSent: boolean;\n  doctor: string;\n  patientName: string;\n  phone: string;\n  patientId: string | null;\n  updatedAt: string;\n};\n\ntype DashboardStats = {\n  appointments: number;\n  requests: { id: string; name: string; phone: string; symptoms: string | null; }[];\n  queue: number;\n  lowStock: number;\n  recent: Appointment[];\n  upcoming: Appointment[];\n  userName: string;\n};\n\nexport default function Dashboard() {\n  const [stats, setStats] = useState<DashboardStats | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n\n  // --- MODAL STATES ---\n  const [isCompleteModalOpen, setIsCompleteModalOpen] = useState(false);\n  const [isBulkReminderModalOpen, setIsBulkReminderModalOpen] = useState(false);\n  \n  const [selectedApt, setSelectedApt] = useState<Appointment | null>(null);\n  const [apptDiscount, setApptDiscount] = useState(\"0\");\n  \n  // Track sent reminders locally for the session\n  const [sentReminders, setSentReminders] = useState<string[]>([]);\n\n  // --- DATA LOADING ---\n  const loadData = useCallback(async (isBackground = false) => {\n    if (!isBackground) setRefreshing(true);\n    try {\n      const data = await getDashboardStats();\n      setStats(data as DashboardStats);\n    } catch (error) {\n      console.error(\"Dashboard Load Error:\", error);\n    } finally {\n      setLoading(false);\n      setRefreshing(false);\n    }\n  }, []);\n\n  // Initial & Auto Refresh\n  useEffect(() => {\n    loadData();\n    const interval = setInterval(() => loadData(true), 30000); \n    return () => clearInterval(interval);\n  }, [loadData]);\n\n  // Handle Manual Delete\n  const handleDeleteRequest = async (id: string) => {\n    if(!confirm(\"Are you sure you want to delete this request?\")) return;\n    await completeRequest(id); \n    loadData(); \n  };\n\n  // --- HANDLE APPOINTMENT COMPLETION ---\n  const openCompleteModal = (apt: Appointment) => {\n    setSelectedApt(apt);\n    setApptDiscount(\"0\");\n    setIsCompleteModalOpen(true);\n  };\n\n  const handleConfirmCompletion = async () => {\n    if (!selectedApt) return;\n    await completeAppointment(selectedApt.id, parseFloat(apptDiscount) || 0);\n    setIsCompleteModalOpen(false);\n    setSelectedApt(null);\n    loadData(); \n  };\n\n  // ‚úÖ WhatsApp Reminder Logic\n  const handleWhatsAppReminder = (apt: Appointment) => {\n    if (!apt.phone) return alert(\"No phone number found for this patient.\");\n\n    // 1. Clean Phone\n    let phone = apt.phone.replace(/[^0-9]/g, '');\n    if (phone.length === 10) phone = \"91\" + phone;\n\n    // 2. Format Date\n    const dateObj = new Date(apt.date);\n    const dateStr = dateObj.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });\n\n    // 3. Construct Message\n    const message = `Namaste ${apt.patientName}, this is a reminder for your appointment at Rudra Ayurved with ${apt.doctor} on ${dateStr} at ${apt.startTime}. Please reply to confirm.`;\n\n    // 4. Open WhatsApp & Mark as Sent locally\n    const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;\n    window.open(url, '_blank');\n    \n    // Mark as sent in local state\n    setSentReminders(prev => [...prev, apt.id]);\n  };\n\n  // ‚úÖ FILTER 1: Show appointments greater than current time (For Main Dashboard)\n  const getFilteredUpcoming = () => {\n      if (!stats?.upcoming) return [];\n      const now = new Date();\n      \n      return stats.upcoming.filter((apt: Appointment) => {\n          const aptDate = new Date(apt.date);\n          if (aptDate > now && aptDate.getDate() !== now.getDate()) return true;\n          if (aptDate.getDate() === now.getDate() && aptDate.getMonth() === now.getMonth() && aptDate.getFullYear() === now.getFullYear()) {\n             const [time, modifier] = apt.startTime.split(' ');\n             let [hours, minutes] = time.split(':');\n             if (hours === '12') hours = '00';\n             if (modifier === 'PM') hours = (parseInt(hours, 10) + 12).toString();\n             const aptTime = new Date();\n             aptTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\n             return aptTime > now;\n          }\n          return false;\n      });\n  };\n\n  // ‚úÖ FILTER 2: Get Today's & Tomorrow's Appointments (For Bulk List)\n  const getBulkAppointments = () => {\n      if (!stats?.upcoming) return [];\n      \n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n\n      const tomorrow = new Date(today);\n      tomorrow.setDate(tomorrow.getDate() + 1);\n\n      const endTomorrow = new Date(tomorrow);\n      endTomorrow.setHours(23, 59, 59, 999);\n\n      return stats.upcoming.filter((apt: Appointment) => {\n          const aptDate = new Date(apt.date);\n          // Return if date is Today OR Tomorrow\n          return aptDate >= today && aptDate <= endTomorrow;\n      });\n  };\n\n  const filteredUpcoming = getFilteredUpcoming();\n  const bulkAppointments = getBulkAppointments(); // Updated variable name\n\n  if (loading) return (\n    <div className=\"h-screen flex items-center justify-center bg-[#FDFBF7]\">\n      <Loader2 className=\"animate-spin text-[#c5a059]\" size={48} />\n    </div>\n  );\n\n  return (\n    <div className=\"h-screen bg-[#FDFBF7] flex flex-col font-sans text-neutral-800\">\n      \n      {/* HEADER NAVIGATION */}\n      <StaffHeader />\n\n      <div className=\"flex-1 overflow-y-auto p-8\">\n        {/* DASHBOARD HEADER */}\n        <header className=\"flex justify-between items-end mb-8\">\n          <div>\n            <h1 className=\"text-4xl font-serif font-bold text-[#1e3a29] mb-2\">\n              Namaste, {stats?.userName || \"Doctor\"} \n            </h1>\n            <p className=\"text-gray-500\">Here is your clinic overview.</p>\n          </div>\n          <div className=\"text-right flex flex-col items-end gap-2\">\n            <p className=\"text-sm font-bold text-[#c5a059] uppercase tracking-wider\">\n              {new Date().toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long' })}\n            </p>\n            <button \n              onClick={() => loadData()} \n              disabled={refreshing}\n              className=\"flex items-center gap-2 text-xs font-bold text-gray-400 hover:text-[#1e3a29] transition disabled:opacity-50\"\n            >\n              <RefreshCw size={14} className={refreshing ? \"animate-spin\" : \"\"} />\n              {refreshing ? \"Updating...\" : \"Refresh Data\"}\n            </button>\n          </div>\n        </header>\n\n        {/* 1. CLICKABLE STATS ROW */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-10\">\n          \n          <Link href=\"/calendar\" className=\"group bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md hover:border-[#c5a059] transition\">\n            <div>\n              <p className=\"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1\">Appointments Today</p>\n              <h2 className=\"text-4xl font-serif font-bold text-[#1e3a29]\">{stats?.appointments || 0}</h2>\n            </div>\n            <div className=\"w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center group-hover:scale-110 transition\">\n              <Calendar size={24}/>\n            </div>\n          </Link>\n\n          <Link href=\"/pharmacy\" className=\"group bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md hover:border-[#c5a059] transition\">\n            <div>\n              <p className=\"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1\">Pending Prescriptions</p>\n              <h2 className=\"text-4xl font-serif font-bold text-[#1e3a29]\">{stats?.queue || 0}</h2>\n            </div>\n            <div className={`w-12 h-12 rounded-full flex items-center justify-center group-hover:scale-110 transition ${stats?.queue && stats.queue > 0 ? 'bg-orange-50 text-orange-600 animate-pulse' : 'bg-green-50 text-green-600'}`}>\n              <Clock size={24}/>\n            </div>\n          </Link>\n\n          <Link href=\"/pharmacy?tab=inventory\" className=\"group bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md hover:border-[#c5a059] transition\">\n            <div>\n              <p className=\"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1\">Low Stock Alerts</p>\n              <h2 className={`text-4xl font-serif font-bold ${stats?.lowStock && stats.lowStock > 0 ? 'text-red-600' : 'text-[#1e3a29]'}`}>\n                {stats?.lowStock || 0}\n              </h2>\n            </div>\n            <div className={`w-12 h-12 rounded-full flex items-center justify-center group-hover:scale-110 transition ${stats?.lowStock && stats.lowStock > 0 ? 'bg-red-50 text-red-600' : 'bg-gray-50 text-gray-400'}`}>\n              <AlertTriangle size={24}/>\n            </div>\n          </Link>\n        </div>\n\n        <div className=\"grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8\">\n          \n          {/* SECTION 2: WEB REQUESTS */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-[#c5a059]/30 overflow-hidden h-full\">\n              <div className=\"bg-[#fff9f0] px-6 py-4 border-b border-[#c5a059]/10 flex justify-between items-center\">\n                <h3 className=\"font-serif font-bold text-[#1e3a29] flex items-center gap-2\">\n                  {stats?.requests && stats.requests.length > 0 && <span className=\"w-2 h-2 rounded-full bg-orange-500 animate-pulse\"></span>}\n                  Website Requests\n                </h3>\n                <span className=\"text-xs font-bold text-[#c5a059] uppercase\">{stats?.requests?.length || 0} Pending</span>\n              </div>\n              \n              <div className=\"divide-y divide-gray-100 max-h-[300px] overflow-y-auto\">\n                {stats?.requests?.map((req) => (\n                  <div key={req.id} className=\"p-4 flex items-center justify-between hover:bg-gray-50 transition\">\n                    <div>\n                        <p className=\"font-bold text-[#1e3a29]\">{req.name}</p>\n                        <p className=\"text-xs text-gray-500\">üìû {req.phone}</p>\n                        <div className=\"mt-1 bg-orange-50 text-orange-800 text-xs px-2 py-1 rounded inline-block font-medium\">\n                           Note: {req.symptoms || \"Consultation Request\"}\n                        </div>\n                    </div>\n                    <div className=\"flex gap-2 items-center\">\n                       <button onClick={() => handleDeleteRequest(req.id)} className=\"p-2 text-red-400 hover:bg-red-50 rounded-lg transition\" title=\"Delete Request\">\n                          <Trash2 size={16}/>\n                       </button>\n                       <Link \n                          href={`/calendar?reqId=${req.id}&name=${encodeURIComponent(req.name)}&phone=${req.phone}`} \n                          className=\"text-xs bg-[#1e3a29] text-white px-4 py-2 rounded-lg hover:bg-[#2a4d38] font-bold shadow-sm flex items-center gap-2\"\n                       >\n                          <Calendar size={14}/> Book Slot\n                       </Link>\n                    </div>\n                  </div>\n                ))}\n                {(!stats?.requests || stats.requests.length === 0) && (\n                    <div className=\"p-12 text-center text-gray-400 text-sm italic\">\n                       No pending requests from the website.\n                    </div>\n                )}\n              </div>\n          </div>\n\n          {/* SECTION 3: UPCOMING SCHEDULE */}\n          <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden h-full flex flex-col\">\n              <div className=\"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50\">\n                <h3 className=\"font-serif font-bold text-[#1e3a29] flex items-center gap-2\">\n                  <Users className=\"text-[#c5a059]\" size={20}/> Upcoming Schedule\n                </h3>\n                \n                {/* BULK REMINDER BUTTON */}\n                <button \n                  onClick={() => setIsBulkReminderModalOpen(true)}\n                  className=\"text-xs bg-[#1e3a29] text-white px-3 py-1.5 rounded-full hover:bg-[#2a4d38] flex items-center gap-1.5 transition shadow-sm\"\n                >\n                   <ListChecks size={14}/> Bulk Reminders\n                </button>\n              </div>\n              \n              <div className=\"flex-1 overflow-y-auto max-h-[300px]\">\n                {(filteredUpcoming.length === 0) ? (\n                    <div className=\"p-10 text-center text-gray-400 text-sm\">No upcoming appointments.</div>\n                ) : (\n                    <table className=\"w-full text-sm text-left\">\n                       <thead className=\"bg-gray-100 text-gray-500 text-xs uppercase sticky top-0 z-10\">\n                          <tr>\n                             <th className=\"p-3\">Time</th>\n                             <th className=\"p-3\">Patient</th>\n                             <th className=\"p-3\">Info</th>\n                             <th className=\"p-3\">Action</th>\n                          </tr>\n                       </thead>\n                       <tbody className=\"divide-y divide-gray-100\">\n                          {filteredUpcoming.map((apt:Appointment) => {\n                             const isToday = new Date(apt.date).getDate() === new Date().getDate();\n                             const isSent = sentReminders.includes(apt.id) || apt.reminderSent;\n                             return (\n                                <tr key={apt.id} className=\"hover:bg-gray-50 transition\">\n                                   <td className=\"p-3\">\n                                      <div className=\"font-bold text-[#1e3a29]\">{apt.startTime}</div>\n                                      <span className={`text-[10px] px-1.5 py-0.5 rounded font-bold ${isToday ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>\n                                         {isToday ? 'TODAY' : 'TMROW'}\n                                      </span>\n                                   </td>\n                                   <td className=\"p-3 font-medium\">\n                                      {apt.patientName}\n                                      <div className=\"text-[10px] text-gray-400\">üìû {apt.phone}</div>\n                                   </td>\n                                   <td className=\"p-3\">\n                                      <div className=\"text-xs font-bold text-gray-600\">{apt.doctor}</div>\n                                      <div className=\"text-[10px] text-gray-400\">{apt.type}</div>\n                                   </td>\n                                   <td className=\"p-3 flex items-center gap-2\">\n                                      {/* WhatsApp Button */}\n                                      <button \n                                        onClick={() => handleWhatsAppReminder(apt)}\n                                        className={`p-2 rounded-full transition ${isSent ? 'bg-green-100 text-green-700' : 'text-[#25D366] hover:bg-green-50'}`} \n                                        title=\"Send WhatsApp Reminder\"\n                                      >\n                                        {isSent ? <CheckCircle size={20}/> : <MessageCircle size={20} />}\n                                      </button>\n                                      \n                                      <button \n                                        onClick={() => openCompleteModal(apt)}\n                                        className=\"text-green-600 hover:bg-green-50 p-2 rounded-full transition\" \n                                        title=\"Complete Appointment\"\n                                      >\n                                        <CheckCircle size={20} />\n                                      </button>\n                                   </td>\n                                </tr>\n                             )\n                          })}\n                       </tbody>\n                    </table>\n                )}\n             </div>\n          </div>\n        </div>\n\n        {/* SECTION 4: COMPLETED TODAY */}\n        <div className=\"mt-8\">\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n              <div className=\"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50\">\n                 <h3 className=\"font-serif font-bold text-[#1e3a29] flex items-center gap-2\">\n                    <CheckCircle className=\"text-green-600\" size={18}/> Completed Today\n                 </h3>\n                 <span className=\"text-xs font-bold text-gray-400\">Recent 5</span>\n              </div>\n              \n              <div className=\"divide-y divide-gray-100\">\n                  {(!stats?.recent || stats.recent.length === 0) ? (\n                    <div className=\"p-8 text-center text-gray-400 text-sm\">No completed appointments yet today.</div>\n                  ) : (\n                    stats.recent.map((apt: Appointment) => (\n                      <Link key={apt.id} href={`/patients/${apt.patientId}`} className=\"group p-4 flex items-center justify-between hover:bg-gray-50 transition cursor-pointer\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-700 font-bold text-xs\">\n                             {apt.patientName.charAt(0)}\n                          </div>\n                          <div>\n                            <p className=\"font-bold text-[#1e3a29] text-sm group-hover:text-[#c5a059] transition\">{apt.patientName}</p>\n                            <p className=\"text-xs text-gray-500\">{apt.type} ‚Ä¢ {apt.doctor}</p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                           <span className=\"text-xs text-gray-400\">\n                              {new Date(apt.updatedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}\n                           </span>\n                           <ChevronRight size={16} className=\"text-gray-300 group-hover:text-[#c5a059]\"/>\n                        </div>\n                      </Link>\n                    ))\n                  )}\n              </div>\n            </div>\n        </div>\n\n      </div>\n\n      {/* --- COMPLETE APPOINTMENT MODAL --- */}\n      {isCompleteModalOpen && selectedApt && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n           <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden animate-in zoom-in-95\">\n              <div className=\"bg-[#1e3a29] p-4 text-white flex justify-between items-center\">\n                 <h3 className=\"font-bold\">Complete Appointment</h3>\n                 <button onClick={() => setIsCompleteModalOpen(false)}><X size={20}/></button>\n              </div>\n              <div className=\"p-6\">\n                 <p className=\"text-sm text-gray-600 mb-4\">\n                   Marking appointment for <span className=\"font-bold text-[#1e3a29]\">{selectedApt.patientName}</span> as completed.\n                 </p>\n                 \n                 <div className=\"mb-4\">\n                    <label className=\"text-xs font-bold text-gray-500 uppercase mb-1 block\">Apply Discount (‚Çπ)</label>\n                    <div className=\"flex items-center border rounded px-3 py-2 focus-within:ring-2 focus-within:ring-[#c5a059]\">\n                       <BadgePercent size={16} className=\"text-gray-400 mr-2\"/>\n                       <input \n                          type=\"number\" \n                          className=\"w-full text-sm outline-none font-bold text-[#1e3a29]\"\n                          placeholder=\"0\"\n                          value={apptDiscount}\n                          onChange={(e) => setApptDiscount(e.target.value)}\n                       />\n                    </div>\n                    <p className=\"text-[10px] text-gray-400 mt-1\">\n                       Standard Fee: ‚Çπ500. Final Bill: ‚Çπ{500 - (parseFloat(apptDiscount) || 0)}\n                    </p>\n                 </div>\n\n                 <button \n                    onClick={handleConfirmCompletion}\n                    className=\"w-full bg-[#1e3a29] text-white py-3 rounded-lg font-bold text-sm hover:bg-[#162b1e] transition shadow-md flex justify-center items-center gap-2\"\n                 >\n                    <CheckCircle size={16}/> Confirm Completion\n                 </button>\n              </div>\n           </div>\n        </div>\n      )}\n\n      {/* --- BULK REMINDER MODAL (UPDATED) --- */}\n      {isBulkReminderModalOpen && (\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\n             <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in zoom-in-95 flex flex-col max-h-[80vh]\">\n                 <div className=\"bg-[#1e3a29] p-4 text-white flex justify-between items-center shrink-0\">\n                    <div>\n                        <h3 className=\"font-bold flex items-center gap-2\"><ListChecks size={20}/> Bulk Reminders</h3>\n                        <p className=\"text-[10px] text-gray-300\">Showing appointments for Today & Tomorrow</p>\n                    </div>\n                    <button onClick={() => setIsBulkReminderModalOpen(false)}><X size={20}/></button>\n                 </div>\n                 \n                 <div className=\"flex-1 overflow-y-auto p-0\">\n                    <table className=\"w-full text-sm text-left\">\n                       <thead className=\"bg-gray-100 text-gray-500 text-xs uppercase sticky top-0\">\n                          <tr>\n                             <th className=\"p-3\">Time</th>\n                             <th className=\"p-3\">Patient</th>\n                             <th className=\"p-3\">Phone</th>\n                             <th className=\"p-3 text-right\">Action</th>\n                          </tr>\n                       </thead>\n                       <tbody className=\"divide-y divide-gray-100\">\n                          {bulkAppointments.length === 0 ? (\n                              <tr><td colSpan={4} className=\"p-8 text-center text-gray-400\">No appointments scheduled.</td></tr>\n                          ) : (\n                              bulkAppointments.map((apt: Appointment) => {\n                                  const isSent = sentReminders.includes(apt.id) || apt.reminderSent;\n                                  const isToday = new Date(apt.date).getDate() === new Date().getDate();\n                                  \n                                  return (\n                                      <tr key={apt.id} className={isSent ? \"bg-green-50\" : \"hover:bg-gray-50\"}>\n                                          <td className=\"p-3\">\n                                              <div className=\"font-bold text-[#1e3a29]\">{apt.startTime}</div>\n                                              {isToday && <span className=\"text-[9px] bg-green-100 text-green-700 px-1 rounded font-bold\">TODAY</span>}\n                                          </td>\n                                          <td className=\"p-3 font-medium\">{apt.patientName}</td>\n                                          <td className=\"p-3 text-gray-500 text-xs font-mono\">{apt.phone}</td>\n                                          <td className=\"p-3 text-right\">\n                                              <button \n                                                  onClick={() => handleWhatsAppReminder(apt)}\n                                                  disabled={isSent}\n                                                  className={`text-xs px-3 py-1.5 rounded-full font-bold flex items-center gap-1 ml-auto transition ${\n                                                      isSent \n                                                      ? \"bg-green-200 text-green-800 cursor-not-allowed\" \n                                                      : \"bg-[#25D366] text-white hover:bg-[#1ebc57]\"\n                                                  }`}\n                                              >\n                                                  {isSent ? <CheckCircle size={12}/> : <MessageCircle size={12}/>}\n                                                  {isSent ? \"Sent\" : \"Send\"}\n                                              </button>\n                                          </td>\n                                      </tr>\n                                  );\n                              })\n                          )}\n                       </tbody>\n                    </table>\n                 </div>\n                 \n                 <div className=\"p-3 bg-gray-50 border-t text-center text-xs text-gray-500\">\n                    Tip: Click \"Send\" to open WhatsApp. The button will turn green to help you track progress.\n                 </div>\n             </div>\n          </div>\n      )}\n\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\login\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":9,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ChevronRight"},"fix":{"range":[248,262],"text":""},"desc":"Remove unused variable \"ChevronRight\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8253,8256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8253,8256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9290,9293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9290,9293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":271,"column":21,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14954,14983],"text":"&quot;‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø\""},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14954,14983],"text":"&ldquo;‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø\""},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14954,14983],"text":"&#34;‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø\""},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14954,14983],"text":"&rdquo;‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø\""},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":271,"column":49,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[14954,14983],"text":"\"‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[14954,14983],"text":"\"‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[14954,14983],"text":"\"‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[14954,14983],"text":"\"‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":340,"column":26,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[19655,19831],"text":"\r\n                         &quot;Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.\"\r\n                       "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[19655,19831],"text":"\r\n                         &ldquo;Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.\"\r\n                       "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[19655,19831],"text":"\r\n                         &#34;Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.\"\r\n                       "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[19655,19831],"text":"\r\n                         &rdquo;Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.\"\r\n                       "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":340,"column":149,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[19655,19831],"text":"\r\n                         \"Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.&quot;\r\n                       "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[19655,19831],"text":"\r\n                         \"Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.&ldquo;\r\n                       "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[19655,19831],"text":"\r\n                         \"Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.&#34;\r\n                       "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[19655,19831],"text":"\r\n                         \"Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.&rdquo;\r\n                       "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":351,"column":23,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[20492,20640],"text":"\r\n                      &quot;Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.\"\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[20492,20640],"text":"\r\n                      &ldquo;Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.\"\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[20492,20640],"text":"\r\n                      &#34;Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.\"\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[20492,20640],"text":"\r\n                      &rdquo;Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.\"\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":351,"column":124,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[20492,20640],"text":"\r\n                      \"Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.&quot;\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[20492,20640],"text":"\r\n                      \"Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.&ldquo;\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[20492,20640],"text":"\r\n                      \"Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.&#34;\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[20492,20640],"text":"\r\n                      \"Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.&rdquo;\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":373,"column":26,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[21907,22053],"text":"\r\n                         &quot;Enhancing your natural beauty with the precision of modern science and the care of a doctor.\"\r\n                       "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[21907,22053],"text":"\r\n                         &ldquo;Enhancing your natural beauty with the precision of modern science and the care of a doctor.\"\r\n                       "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[21907,22053],"text":"\r\n                         &#34;Enhancing your natural beauty with the precision of modern science and the care of a doctor.\"\r\n                       "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[21907,22053],"text":"\r\n                         &rdquo;Enhancing your natural beauty with the precision of modern science and the care of a doctor.\"\r\n                       "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":373,"column":119,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[21907,22053],"text":"\r\n                         \"Enhancing your natural beauty with the precision of modern science and the care of a doctor.&quot;\r\n                       "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[21907,22053],"text":"\r\n                         \"Enhancing your natural beauty with the precision of modern science and the care of a doctor.&ldquo;\r\n                       "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[21907,22053],"text":"\r\n                         \"Enhancing your natural beauty with the precision of modern science and the care of a doctor.&#34;\r\n                       "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[21907,22053],"text":"\r\n                         \"Enhancing your natural beauty with the precision of modern science and the care of a doctor.&rdquo;\r\n                       "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":384,"column":23,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[22724,22863],"text":"\r\n                      &quot;Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.\"\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[22724,22863],"text":"\r\n                      &ldquo;Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.\"\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[22724,22863],"text":"\r\n                      &#34;Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.\"\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[22724,22863],"text":"\r\n                      &rdquo;Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.\"\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":384,"column":115,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[22724,22863],"text":"\r\n                      \"Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.&quot;\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[22724,22863],"text":"\r\n                      \"Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.&ldquo;\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[22724,22863],"text":"\r\n                      \"Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.&#34;\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[22724,22863],"text":"\r\n                      \"Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.&rdquo;\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":461,"column":21,"nodeType":"JSXOpeningElement","endLine":466,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":495,"column":21,"nodeType":"JSXOpeningElement","endLine":500,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":686,"column":21,"nodeType":"JSXOpeningElement","endLine":691,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":706,"column":28,"nodeType":"JSXOpeningElement","endLine":706,"endColumn":144},{"ruleId":"jsx-a11y/alt-text","severity":1,"message":"img elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","line":706,"column":28,"nodeType":"JSXOpeningElement","endLine":706,"endColumn":144}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"; \r\n\r\nimport { useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { \r\n  ArrowRight, Phone, MapPin, Instagram, Facebook, \r\n  Sparkles, Leaf, Calendar, CheckCircle2, Loader2, X, Wallet,\r\n  Eye, ChevronRight, Info, MessageCircle, Mail\r\n} from \"lucide-react\";\r\nimport { createConsultationRequest } from \"@/app/actions\"; \r\n\r\n// --- DATA: PANCHAKARMA THERAPIES ---\r\nconst PANCHAKARMA_SERVICES = [\r\n  { \r\n    id: 'vamana',\r\n    name: \"Vamana\", \r\n    subtitle: \"Therapeutic Emesis\", \r\n    desc: \"Eliminates Kapha toxins from the body.\",\r\n    detail: \"Vamana is a medicated emesis therapy that removes Kapha toxins collected in the body and the respiratory tract. This is given to people with high Kapha imbalance. Daily treatment is administered for a few days to loosen toxins and mobilize them to the stomach.\",\r\n    benefits: [\"Treats Asthma & Allergies\", \"Reduces Obesity\", \"Clears Skin Disorders (Psoriasis)\", \"Improves Digestion\"],\r\n    img: \"/treatments/vamana.jpg\", \r\n    gallery: [\"/treatments/vamana.jpg\", \"/treatments/vamana-2.jpg\"] \r\n  },\r\n  { \r\n    id: 'virechana',\r\n    name: \"Virechana\", \r\n    subtitle: \"Purgation Therapy\", \r\n    desc: \"Removes Pitta toxins from the liver and gallbladder.\",\r\n    detail: \"Virechana is the administration of purgative substances for the cleansing of Pitta and the purification of the blood toxins from the body that are concentrated in the liver and gallbladder. It completely cleanses the gastrointestinal tract.\",\r\n    benefits: [\"Detoxifies Liver\", \"Treats Acidity & Ulcers\", \"Cures Skin Inflammations\", \"Relieves Jaundice\"],\r\n    img: \"/treatments/virechana.jpg\",\r\n    gallery: [\"/treatments/virechana.jpg\", \"/treatments/virechana-2.jpg\"]\r\n  },\r\n  { \r\n    id: 'basti',\r\n    name: \"Basti\", \r\n    subtitle: \"Medicated Enema\", \r\n    desc: \"The mother of all treatments for Vata disorders.\",\r\n    detail: \"Basti involves the introduction of herbal decoctions and medicated oils into the colon through the rectum. Since Vata is mainly located in the colon and bones, Basti is considered the most effective treatment for Vata disorders.\",\r\n    benefits: [\"Relieves Arthritis & Joint Pain\", \"Treats Constipation\", \"Helps in Neurological Disorders\", \"Rejuvenates the Body\"],\r\n    img: \"/treatments/basti.jpg\",\r\n    gallery: [\"/treatments/basti.jpg\", \"/treatments/basti-detail.jpg\"]\r\n  },\r\n  { \r\n    id: 'nasya',\r\n    name: \"Nasya\", \r\n    subtitle: \"Nasal Administration\", \r\n    desc: \"Cleanses the head and neck region.\",\r\n    detail: \"Nasya involves the administration of medicated oil or powder through the nostrils. It is highly effective for ailments of the head, neck, and shoulders, as the nose is considered the doorway to the brain.\",\r\n    benefits: [\"Cures Sinusitis & Migraine\", \"Improves Memory & Eyesight\", \"Relieves Cervical Spondylosis\", \"Prevents Hair Fall\"],\r\n    img: \"/treatments/nasya.jpg\",\r\n    gallery: [\"/treatments/nasya.jpg\", \"/treatments/nasya-2.jpg\"]\r\n  },\r\n  { \r\n    id: 'raktamokshana',\r\n    name: \"Raktamokshana\", \r\n    subtitle: \"Bloodletting Therapy\", \r\n    desc: \"Purifies the blood to treat skin diseases.\",\r\n    detail: \"A specialized therapy to remove impure blood from the body. It is often used for Pitta disorders and blood-borne diseases. Leech therapy (Jaloka) is a common form of this treatment used for localized purification.\",\r\n    benefits: [\"Treats Eczema & Acne\", \"Reduces localized swelling\", \"Effective for Varicose Veins\", \"Relieves Gout\"],\r\n    img: \"/treatments/raktamokshana.jpg\",\r\n    gallery: [\"/treatments/raktamokshana.jpg\", \"/treatments/rakta.jpg\"]\r\n  },\r\n  { \r\n    id: 'shirodhara',\r\n    name: \"Shirodhara\", \r\n    subtitle: \"Stress Relief\", \r\n    desc: \"Deep relaxation for the nervous system.\",\r\n    detail: \"A gentle, continuous stream of warm herbal oil is poured over the forehead. This therapy induces a deep state of relaxation and mental clarity.\",\r\n    benefits: [\"Cures Insomnia\", \"Relieves Anxiety & Stress\", \"Improves Concentration\", \"Balances Hormones\"],\r\n    img: \"/treatments/shirodhara.jpg\",\r\n    gallery: [\"/treatments/shirodhara.jpg\", \"/treatments/shiro-2.jpg\"]\r\n  },\r\n  { \r\n    id: 'abhyanga',\r\n    name: \"Abhyanga\", \r\n    subtitle: \"Full Body Massage\", \r\n    desc: \"Nourishes tissues and improves circulation.\",\r\n    detail: \"Traditional Ayurvedic full body massage using warm, herb-infused oils specific to your Dosha. It helps to liquefy toxins and move them towards the gastrointestinal tract for elimination.\",\r\n    benefits: [\"Improves Blood Circulation\", \"Tones Muscles\", \"Softens Skin\", \"Relieves Fatigue\"],\r\n    img: \"/treatments/abhyanga.jpg\",\r\n    gallery: [\"/treatments/abhyanga.jpg\", \"/treatments/massage.jpg\"]\r\n  },\r\n  { \r\n    id: 'janubasti',\r\n    name: \"Janu Basti\", \r\n    subtitle: \"Knee Care\", \r\n    desc: \"Specialized treatment for knee pain.\",\r\n    detail: \"Warm medicated oil is pooled over the knee joint for a specific duration. This lubricates the joints and strengthens the muscles supporting the knee.\",\r\n    benefits: [\"Relieves Knee Pain\", \"Treats Osteoarthritis\", \"Reduces Stiffness\", \"Improves Mobility\"],\r\n    img: \"/treatments/janu-basti.jpg\",\r\n    gallery: [\"/treatments/janu-basti.jpg\", \"/treatments/knee.jpg\"]\r\n  }\r\n];\r\n\r\n// --- DATA: COSMETOLOGY SERVICES ---\r\nconst COSMETOLOGY_SERVICES = [\r\n  { \r\n    id: 'laser',\r\n    name: \"Hair Restoration & Skin Rejuvenation\", \r\n    subtitle: \"Hair Restoration & Skin Rejuvenation\", \r\n    desc: \"A regenerative treatment for Hair Restoration & Skin Rejuvenation.\",\r\n    detail: \"A regenerative treatment using concentrated platelets from your own blood to stimulate healing in injured tissues, promoting natural repair for conditions like tendinitis, hair loss and skin rejuvenation\",\r\n    benefits: [\"Uses your own blood, minimizing rejection risk.\", \"Minimally invasive and non-surgical.\", \"Promotes natural healing processes. \", \"Safe for Sensitive Skin\"],\r\n    img: \"/treatments/prptreatment.jpg\",\r\n    gallery: [\"/treatments/prptreatment.jpg\", \"/treatments/prpmachine.jpg\"]\r\n  },\r\n  { \r\n    id: 'hydra',\r\n    name: \"HydraFacial\", \r\n    subtitle: \"Deep Cleansing\", \r\n    desc: \"Cleanse, exfoliate, and hydrate.\",\r\n    detail: \"A medical-grade resurfacing treatment that clears out your pores and hydrates your skin. It involves cleansing, exfoliation, extraction, hydration and antioxidant protection.\",\r\n    benefits: [\"Instant Glow\", \"Removes Blackheads\", \"Deep Hydration\", \"Even Skin Tone\"],\r\n    img: \"/treatments/hydrafacial.jpg\",\r\n    gallery: [\"/treatments/hydrafacial.jpg\", \"/treatments/facial-2.jpg\"]\r\n  },\r\n  { \r\n    id: 'peel',\r\n    name: \"Chemical Peels\", \r\n    subtitle: \"Skin Resurfacing\", \r\n    desc: \"Treats acne, scars, and pigmentation.\",\r\n    detail: \"Controlled application of chemical solutions to exfoliate the skin, allowing new skin to regenerate. We use customized peels ranging from superficial to deep based on skin concerns.\",\r\n    benefits: [\"Reduces Acne Scars\", \"Treats Hyperpigmentation\", \"Smooths Fine Lines\", \"Brightens Complexion\"],\r\n    img: \"/treatments/chemical-peel.jpg\",\r\n    gallery: [\"/treatments/chemical-peel.jpg\", \"/treatments/peel-2.jpg\"]\r\n  }\r\n];\r\n\r\n// --- DATA: CLINIC GALLERY ---\r\n// ‚úÖ UPDATED: Added 2 more images and adjusted spans for a cleaner mosaic\r\nconst CLINIC_GALLERY = [\r\n    { id: 1, src: \"/clinic/reception.jpg\", alt: \"Reception Area\", span: \"md:col-span-2 md:row-span-2\" },\r\n    { id: 2, src: \"/clinic/consultation.jpg\", alt: \"Consultation Room\", span: \"md:col-span-1 md:row-span-1\" },\r\n    { id: 3, src: \"/clinic/therapyroom.jpg\", alt: \"Panchakarma Therapy\", span: \"md:col-span-1 md:row-span-1\" },\r\n    { id: 4, src: \"/clinic/shirodhararoom.jpg\", alt: \"Shirodhara Room\", span: \"md:col-span-1 md:row-span-1\" },\r\n    { id: 5, src: \"/clinic/medstore.jpg\", alt: \"Medicine Store\", span: \"md:col-span-1 md:row-span-1\" },\r\n    // New Images\r\n    { id: 6, src: \"/clinic/consultation2.jpg\", alt: \"Cosmetology Consultation\", span: \"md:col-span-2 md:row-span-1\" },\r\n    { id: 7, src: \"/clinic/inpatient.jpg\", alt: \"Patient Room\", span: \"md:col-span-2 md:row-span-1\" },\r\n];\r\n\r\nexport default function LandingPage() {\r\n  const [isBookingModalOpen, setIsBookingModalOpen] = useState(false);\r\n  const [selectedTreatment, setSelectedTreatment] = useState<any>(null); \r\n  const [activeImage, setActiveImage] = useState<string>(\"\"); \r\n  \r\n  const [loading, setLoading] = useState(false);\r\n  const [formData, setFormData] = useState({ name: \"\", phone: \"\", symptoms: \"\" });\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if(!formData.phone || !formData.name) return alert(\"Name and Phone are required!\");\r\n\r\n    setLoading(true);\r\n    const res = await createConsultationRequest(formData);\r\n    setLoading(false);\r\n\r\n    if(res.success) {\r\n      alert(\"Request received! Our team will call you shortly to confirm the time.\");\r\n      setIsBookingModalOpen(false);\r\n      setFormData({ name: \"\", phone: \"\", symptoms: \"\" });\r\n    } else {\r\n      alert(\"Error submitting request. Please try again.\");\r\n    }\r\n  };\r\n\r\n  const handleBookFromTreatment = () => {\r\n    setFormData(prev => ({...prev, symptoms: `Inquiry about: ${selectedTreatment.name}`}));\r\n    setSelectedTreatment(null);\r\n    setIsBookingModalOpen(true);\r\n  };\r\n\r\n  const openTreatment = (item: any) => {\r\n    setSelectedTreatment(item);\r\n    setActiveImage(item.img); \r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[#FDFBF7] font-sans text-neutral-800 selection:bg-[#c5a059] selection:text-white\">\r\n      \r\n      {/* --- TOP BAR (CONTACT & SOCIALS) --- */}\r\n      {/* ‚úÖ DESIGN CHANGE: Removed global pulse, added Gold Badge to phone for 'pop' */}\r\n      <div className=\"bg-[#1e3a29] text-white/90 text-[11px] md:text-xs py-2 px-6 md:px-10 flex justify-between items-center z-50 relative border-b border-[#c5a059]\">\r\n          <div className=\"flex gap-4 md:gap-6 items-center\">\r\n              {/* Gold Badge for Phone */}\r\n              <a href=\"tel:+916352135799\" className=\"flex items-center gap-1.5 bg-[#c5a059] text-[#1e3a29] px-2 py-0.5 rounded-sm font-bold hover:bg-white hover:text-[#1e3a29] transition shadow-sm\">\r\n                  <Phone size={12}  /> +91 63521 35799\r\n              </a>\r\n              <a href=\"mailto:rudraayurved5@gmail.com\" className=\"hidden md:flex items-center gap-1.5 hover:text-[#c5a059] transition\">\r\n                  <Mail size={12} className=\"text-[#c5a059]\" /> rudraayurved5@gmail.com\r\n              </a>\r\n          </div>\r\n          <div className=\"flex gap-3 md:gap-4 items-center\">\r\n              <span className=\"hidden md:inline opacity-60\">Follow us:</span>\r\n              <a href=\"https://wa.me/916352135799\" target=\"_blank\" className=\"hover:text-[#25D366] transition\" title=\"WhatsApp\">\r\n                  {/* Subtle pulse on just the icon */}\r\n                  <MessageCircle size={15} className=\"animate-pulse\" /> \r\n              </a>\r\n              <a href=\"https://www.instagram.com/rudraayurved5/?hl=en\" target=\"_blank\" className=\"hover:text-[#E1306C] transition\" title=\"Instagram\">\r\n                  <Instagram size={15} className=\"animate-pulse\"/>\r\n              </a>\r\n              <a href=\"https://www.facebook.com/p/Rudra-Ayurved-61577961763044/\" target=\"_blank\" className=\"hover:text-[#1877F2] transition\" title=\"Facebook\">\r\n                  <Facebook size={15} className=\"animate-pulse\"/>\r\n              </a>\r\n          </div>\r\n      </div>\r\n\r\n      {/* --- NAVIGATION --- */}\r\n      <nav className=\"sticky top-0 z-50 bg-[#FDFBF7]/90 backdrop-blur-md border-b border-gray-100 transition-all duration-300\">\r\n        <div className=\"flex justify-between items-center px-6 md:px-10 py-3 max-w-7xl mx-auto\">\r\n          \r\n          <div className=\"flex items-center gap-3\">\r\n             <div className=\"relative w-14 h-14\">\r\n                <Image \r\n                  src=\"/rudralogo.png\" \r\n                  alt=\"Rudra Ayurved Logo\" \r\n                  fill\r\n                  className=\"object-contain\"\r\n                  priority\r\n                />\r\n             </div>\r\n             <div className=\"leading-tight flex flex-col justify-center\">\r\n               <h1 className=\"font-serif text-2xl font-bold text-[#B09B5C] tracking-wide\">RUDRA AYURVED</h1>\r\n               <span className=\"text-[10px] font-bold text-[#1e3a29] tracking-[0.2em] uppercase\">Multi - Speciality Panchkarma Hospital</span>\r\n             </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-4 md:gap-8\">\r\n              <Link href=\"#specialists\" className=\"hidden md:block text-sm font-medium text-gray-600 hover:text-[#c5a059] transition\">Specialists</Link>\r\n              <Link href=\"#treatments\" className=\"hidden md:block text-sm font-medium text-gray-600 hover:text-[#c5a059] transition\">Treatments</Link>\r\n              <Link href=\"#gallery\" className=\"hidden md:block text-sm font-medium text-gray-600 hover:text-[#c5a059] transition\">Clinic</Link> \r\n              <Link href=\"#contact\" className=\"hidden md:block text-sm font-medium text-gray-600 hover:text-[#c5a059] transition\">Visit Us</Link>\r\n              \r\n              <Link href=\"/login\" className=\"bg-[#1e3a29] text-white px-4 md:px-5 py-2 rounded-full text-xs md:text-sm font-bold hover:bg-[#2a4d38] transition flex items-center gap-2 shadow-lg shadow-[#1e3a29]/20\">\r\n                Staff Login <ArrowRight size={15}/>\r\n              </Link>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n\r\n      {/* --- HERO SECTION --- */}\r\n      <header className=\"relative pt-20 pb-32 px-6 md:px-10 overflow-hidden\">\r\n         \r\n         <div className=\"absolute inset-0 z-0\">\r\n            <Image \r\n              src=\"/hero-bg.jpg\" \r\n              alt=\"Ayurveda Background\" \r\n              fill \r\n              className=\"object-cover opacity-100\" \r\n              priority\r\n            />\r\n            <div className=\"absolute inset-0 bg-[#FDFBF7]/80 via-[#FDFBF7]/60 to-transparent\"></div>\r\n         </div>\r\n\r\n         <div className=\"max-w-7xl mx-auto grid md:grid-cols-2 gap-12 items-center relative z-10\">\r\n            <div className=\"max-w-2xl animate-in fade-in slide-in-from-bottom-10 duration-700\">\r\n               <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#c5a059]/10 text-[#c5a059] text-xs font-bold tracking-widest uppercase mb-6 border border-[#c5a059]/20 backdrop-blur-sm\">\r\n                 <Sparkles size={12} /> Multi-Speciality Panchkarma Hospital\r\n               </div>\r\n               \r\n               <h1 className=\"text-5xl md:text-7xl font-serif font-bold text-[#1e3a29] leading-[1.1] mb-6 drop-shadow-sm\">\r\n                 Healing Roots, <br/>\r\n                 <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-[#c5a059] to-[#8a6e3e]\">\r\n                   Glowing Future.\r\n                 </span>\r\n               </h1>\r\n               \r\n               <p className=\"text-lg text-gray-600 mb-8 leading-relaxed max-w-lg font-medium\">\r\n                 <i>\"‡§Ü‡§Ø‡•Å‡§∞‡•ç‡§µ‡•á‡§¶: ‡§∂‡§æ‡§∂‡•ç‡§µ‡§§‡•ã ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø\"</i> ‚Äî Restoring your natural balance through ancient Nadi Pariksha and modern Aesthetic Cosmetology treatments.\r\n               </p>\r\n               \r\n               <div className=\"flex flex-col sm:flex-row gap-4\">\r\n                  <button \r\n                    onClick={() => setIsBookingModalOpen(true)}\r\n                    className=\"bg-[#1e3a29] text-white px-8 py-3.5 rounded-lg font-bold hover:bg-[#2a4d38] transition shadow-xl shadow-[#1e3a29]/10 flex items-center justify-center gap-2\"\r\n                  >\r\n                    <Calendar size={18} /> Book Consultation\r\n                  </button>\r\n                  <Link href=\"#treatments\" className=\"px-8 py-3.5 border border-[#1e3a29] rounded-lg font-bold text-[#1e3a29] hover:bg-[#1e3a29] hover:text-white transition text-center bg-white/50 backdrop-blur-sm\">\r\n                    Explore Services\r\n                  </Link>\r\n               </div>\r\n            </div>\r\n\r\n            <div className=\"hidden md:block relative\">\r\n               <div className=\"absolute top-0 right-0 w-[600px] h-[600px] bg-[#c5a059]/20 rounded-full blur-3xl -z-10\"></div>\r\n               <div className=\"relative z-10 grid grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-4 mt-8\">\r\n                    <div className=\"bg-white/80 backdrop-blur-md p-4 rounded-2xl shadow-sm border border-gray-100 transform hover:-translate-y-1 transition duration-300\">\r\n                       <Leaf className=\"text-[#1e3a29] mb-2\" size={28}/>\r\n                       <h3 className=\"font-bold text-[#1e3a29]\">Kerala Panchakarma</h3>\r\n                       <p className=\"text-xs text-gray-500 mt-1\">Detoxification & Rejuvenation</p>\r\n                    </div>\r\n                    <div className=\"bg-white/80 backdrop-blur-md p-4 rounded-2xl shadow-sm border border-gray-100 transform hover:-translate-y-1 transition duration-300\">\r\n                       <Sparkles className=\"text-[#c5a059] mb-2\" size={28}/>\r\n                       <h3 className=\"font-bold text-[#1e3a29]\">Cosmetology Tech</h3>\r\n                       <p className=\"text-xs text-gray-500 mt-1\">Hair Restoration & Skin Rejuvenation</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"space-y-4\">\r\n                     <div className=\"bg-[#1e3a29] p-6 rounded-2xl shadow-lg text-white transform hover:-translate-y-1 transition duration-300\">\r\n                        <h3 className=\"font-serif text-2xl font-bold\">15+</h3>\r\n                        <p className=\"text-xs text-[#c5a059] uppercase tracking-wider mt-1\">Years Experience</p>\r\n                     </div>\r\n                     <div className=\"bg-white/80 backdrop-blur-md p-4 rounded-2xl shadow-sm border border-gray-100 transform hover:-translate-y-1 transition duration-300\">\r\n                       <CheckCircle2 className=\"text-[#1e3a29] mb-2\" size={28}/>\r\n                       <h3 className=\"font-bold text-[#1e3a29]\">Nadi Pariksha</h3>\r\n                       <p className=\"text-xs text-gray-500 mt-1\">Pulse Diagnosis</p>\r\n                    </div>\r\n                  </div>\r\n               </div>\r\n            </div>\r\n         </div>\r\n      </header>\r\n\r\n      {/* --- SPECIALISTS SECTION --- */}\r\n      <section id=\"specialists\" className=\"py-24 bg-white relative\">\r\n        <div className=\"max-w-7xl mx-auto px-6 md:px-10\">\r\n           <div className=\"text-center mb-16\">\r\n             <span className=\"text-[#c5a059] font-bold text-xs uppercase tracking-widest\">Our Experts</span>\r\n             <h2 className=\"text-3xl md:text-4xl font-serif font-bold text-[#1e3a29] mt-3\">Meet The Healers</h2>\r\n             <div className=\"w-20 h-1 bg-[#c5a059] mx-auto mt-6 rounded-full\"></div>\r\n           </div>\r\n\r\n           <div className=\"grid md:grid-cols-2 gap-12 max-w-5xl mx-auto\">\r\n             {/* Doctor 1 */}\r\n             <div className=\"group relative bg-[#FDFBF7] rounded-3xl overflow-hidden hover:shadow-2xl hover:shadow-[#1e3a29]/10 transition duration-500 border border-gray-100\">\r\n                 <div className=\"aspect-[4/3] relative overflow-hidden\">\r\n                    <Image \r\n                      src=\"/rudrachirag.jpg\" \r\n                      alt=\"Dr. Chirag Raval\"\r\n                      fill\r\n                      className=\"object-cover object-top transition duration-700 group-hover:scale-105\"\r\n                      sizes=\"(max-width: 768px) 100vw, 50vw\"\r\n                    />\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-[#1e3a29]/90 to-transparent opacity-0 group-hover:opacity-100 transition duration-500 flex items-end p-8\">\r\n                       <p className=\"text-white/90 text-sm\">\r\n                         \"Ayurveda is not just a system of medicine, it is a science of life. My goal is to treat the root cause, not just symptoms.\"\r\n                       </p>\r\n                    </div>\r\n                 </div>\r\n                 <div className=\"p-8 relative\">\r\n                    <div className=\"absolute -top-6 right-8 w-12 h-12 bg-[#1e3a29] rounded-full flex items-center justify-center text-white shadow-lg\">\r\n                       <Leaf size={20} />\r\n                    </div>\r\n                    <h3 className=\"text-2xl font-serif font-bold text-[#1e3a29] mb-1\">Dr. Chirag Raval</h3>\r\n                    <p className=\"text-xs font-bold text-[#c5a059] uppercase tracking-wider mb-4\">B.A.M.S, CCPT (Kerala)</p>\r\n                    <p className=\"text-gray-600 italic mb-6 border-l-2 border-[#c5a059] pl-4\">\r\n                      \"Expert in Pulse Diagnosis (Nadi Pariksha) and Panchakarma therapies for chronic lifestyle disorders.\"\r\n                    </p>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                       {['Lifestyle Disorders', 'Nadi Pariksha', 'Panchakarma'].map(tag => (\r\n                         <span key={tag} className=\"px-3 py-1 bg-[#1e3a29]/5 text-[#1e3a29] text-xs font-bold rounded-full\">{tag}</span>\r\n                       ))}\r\n                    </div>\r\n                 </div>\r\n             </div>\r\n\r\n             {/* Doctor 2 */}\r\n             <div className=\"group relative bg-[#FDFBF7] rounded-3xl overflow-hidden hover:shadow-2xl hover:shadow-[#c5a059]/10 transition duration-500 border border-gray-100\">\r\n                 <div className=\"aspect-[4/3] relative overflow-hidden\">\r\n                    <Image \r\n                      src=\"/rudradipal.jpg\" \r\n                      alt=\"Dr. Dipal Raval\"\r\n                      fill\r\n                      className=\"object-cover object-top transition duration-700 group-hover:scale-105\"\r\n                      sizes=\"(max-width: 768px) 100vw, 50vw\"\r\n                    />\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-[#c5a059]/90 to-transparent opacity-0 group-hover:opacity-100 transition duration-500 flex items-end p-8\">\r\n                       <p className=\"text-white/95 text-sm\">\r\n                         \"Enhancing your natural beauty with the precision of modern science and the care of a doctor.\"\r\n                       </p>\r\n                    </div>\r\n                 </div>\r\n                 <div className=\"p-8 relative\">\r\n                    <div className=\"absolute -top-6 right-8 w-12 h-12 bg-[#c5a059] rounded-full flex items-center justify-center text-white shadow-lg\">\r\n                       <Sparkles size={20} />\r\n                    </div>\r\n                    <h3 className=\"text-2xl font-serif font-bold text-[#1e3a29] mb-1\">Dr. Dipal Raval</h3>\r\n                    <p className=\"text-xs font-bold text-[#c5a059] uppercase tracking-wider mb-4\">B.H.M.S, P.G.D.C.C, P.G.D.C.T</p>\r\n                    <p className=\"text-gray-600 italic mb-6 border-l-2 border-[#c5a059] pl-4\">\r\n                      \"Specialist in Hair Repair, Skin Rejuvenation, and advanced Clinical Cosmetology treatments.\"\r\n                    </p>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                       {['Cosmetology', 'Skin & Hair'].map(tag => (\r\n                         <span key={tag} className=\"px-3 py-1 bg-[#c5a059]/10 text-[#c5a059] text-xs font-bold rounded-full\">{tag}</span>\r\n                       ))}\r\n                    </div>\r\n                 </div>\r\n             </div>\r\n           </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* --- GLIMPSE OF OUR CLINIC SECTION (UPDATED) --- */}\r\n      <section id=\"gallery\" className=\"py-20 bg-[#FDFBF7]\">\r\n          <div className=\"max-w-7xl mx-auto px-6 md:px-10\">\r\n              <div className=\"text-center mb-12\">\r\n                  <span className=\"text-[#c5a059] font-bold text-xs uppercase tracking-widest\">Our Space</span>\r\n                  <h2 className=\"text-3xl md:text-4xl font-serif font-bold text-[#1e3a29] mt-3\">Glimpse of Our Clinic</h2>\r\n                  <p className=\"text-gray-500 mt-4 max-w-2xl mx-auto\">\r\n                      Experience the serene and hygienic environment designed for your healing and relaxation.\r\n                  </p>\r\n              </div>\r\n\r\n              {/* ‚úÖ UPDATED: Grid Layout to handle 7 images */}\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 md:grid-rows-3 gap-4 h-[900px] md:h-[700px]\">\r\n                  {CLINIC_GALLERY.map((item) => (\r\n                      <div key={item.id} className={`relative rounded-xl overflow-hidden group ${item.span}`}>\r\n                          <Image \r\n                              src={item.src} \r\n                              alt={item.alt}\r\n                              fill\r\n                              className=\"object-cover transition duration-700 group-hover:scale-110\"\r\n                              onError={(e) => {\r\n                                  e.currentTarget.style.display = 'none';\r\n                                  e.currentTarget.parentElement!.style.backgroundColor = '#e5e7eb';\r\n                              }}\r\n                          />\r\n                          <div className=\"absolute inset-0 bg-black/20 group-hover:bg-black/40 transition duration-500 flex items-center justify-center opacity-0 group-hover:opacity-100\">\r\n                              <p className=\"text-white font-bold text-lg tracking-wide\">{item.alt}</p>\r\n                          </div>\r\n                      </div>\r\n                  ))}\r\n              </div>\r\n          </div>\r\n      </section>\r\n\r\n      {/* --- TREATMENTS SECTION --- */}\r\n      <section id=\"treatments\" className=\"py-24 bg-[#1e3a29] text-white\">\r\n        <div className=\"max-w-7xl mx-auto px-6 md:px-10\">\r\n          \r\n          {/* ‚úÖ FIXED: Mobile Alignment for Header */}\r\n          <div className=\"flex flex-col md:flex-row justify-between items-start md:items-end mb-16 gap-6 text-left\">\r\n            <div>\r\n              <span className=\"text-[#c5a059] font-bold text-xs uppercase tracking-widest\">Our Services</span>\r\n              <h2 className=\"text-3xl md:text-5xl font-serif font-bold mt-3\">Signature Therapies</h2>\r\n            </div>\r\n            <p className=\"text-gray-300 max-w-md text-sm leading-relaxed\">\r\n              We combine the detoxification power of Kerala Panchakarma with state-of-the-art Cosmetology technology for complete wellness.\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"space-y-16\">\r\n            \r\n            {/* 1. Panchakarma Grid */}\r\n            <div>\r\n              <h3 className=\"text-2xl font-serif font-bold mb-8 flex items-center gap-3\">\r\n                <Leaf className=\"text-[#c5a059]\" /> Panchakarma & Detox\r\n              </h3>\r\n              <div className=\"grid md:grid-cols-4 gap-4\">\r\n                {PANCHAKARMA_SERVICES.map((item) => (\r\n                  <div \r\n                    key={item.id} \r\n                    onClick={() => openTreatment(item)} \r\n                    className=\"group relative h-72 rounded-xl overflow-hidden cursor-pointer bg-neutral-800 border border-white/10 hover:border-[#c5a059]/50 transition-all duration-300 hover:shadow-2xl\"\r\n                  >\r\n                    {/* Image */}\r\n                    <img \r\n                      src={item.img} \r\n                      alt={item.name} \r\n                      className=\"w-full h-full object-cover opacity-70 group-hover:opacity-90 group-hover:scale-105 transition duration-700\"\r\n                      onError={(e) => { e.currentTarget.style.display = 'none'; }}\r\n                    />\r\n                    \r\n                    {/* Content Overlay */}\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-[#0f1f15] via-[#0f1f15]/50 to-transparent p-6 flex flex-col justify-end\">\r\n                       <h4 className=\"font-bold text-lg text-white mb-1\">{item.name}</h4>\r\n                       <p className=\"text-xs text-[#c5a059] font-bold uppercase tracking-wider mb-2\">{item.subtitle}</p>\r\n                       \r\n                       <div className=\"flex items-center gap-2 text-xs font-medium text-white/80 bg-white/10 w-fit px-3 py-1.5 rounded-full mt-2 group-hover:bg-[#c5a059] group-hover:text-[#1e3a29] transition-colors\">\r\n                          <Eye size={14} /> Tap to View Details\r\n                       </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* 2. Cosmetology Grid */}\r\n            <div>\r\n              <h3 className=\"text-2xl font-serif font-bold mb-8 flex items-center gap-3\">\r\n                <Sparkles className=\"text-[#c5a059]\" /> Cosmetology & PRP\r\n              </h3>\r\n              <div className=\"grid md:grid-cols-3 gap-6\">\r\n                {COSMETOLOGY_SERVICES.map((item) => (\r\n                  <div \r\n                    key={item.id} \r\n                    onClick={() => openTreatment(item)} \r\n                    className=\"group relative h-72 rounded-xl overflow-hidden cursor-pointer bg-neutral-800 border border-white/10 hover:border-[#c5a059]/50 transition-all duration-300 hover:shadow-2xl\"\r\n                  >\r\n                    {/* Image */}\r\n                    <img \r\n                      src={item.img} \r\n                      alt={item.name} \r\n                      className=\"w-full h-full object-cover opacity-70 group-hover:opacity-90 group-hover:scale-105 transition duration-700\"\r\n                      onError={(e) => { e.currentTarget.style.display = 'none'; }}\r\n                    />\r\n                    \r\n                    {/* Content Overlay */}\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-[#0f1f15] via-[#0f1f15]/50 to-transparent p-6 flex flex-col justify-end\">\r\n                       <h4 className=\"font-bold text-lg text-white mb-1\">{item.name}</h4>\r\n                       <p className=\"text-xs text-[#c5a059] font-bold uppercase tracking-wider mb-2\">{item.subtitle}</p>\r\n                       \r\n                       <div className=\"flex items-center gap-2 text-xs font-medium text-white/80 bg-white/10 w-fit px-3 py-1.5 rounded-full mt-2 group-hover:bg-[#c5a059] group-hover:text-[#1e3a29] transition-colors\">\r\n                          <Eye size={14} /> Tap to View Details\r\n                       </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* --- FOOTER --- */}\r\n      <footer id=\"contact\" className=\"bg-[#162b1e] text-white pt-20 pb-10 border-t border-white/10\">\r\n         <div className=\"max-w-7xl mx-auto px-6 md:px-10\">\r\n            <div className=\"grid md:grid-cols-3 gap-12 mb-16\">\r\n               {/* 1. Address Section */}\r\n              <div className=\"flex gap-4 items-start\">\r\n                <div className=\"w-10 h-10 bg-[#c5a059] rounded-full flex items-center justify-center shrink-0 text-[#1e3a29] mt-1\">\r\n                  <MapPin size={20}/>\r\n                </div>\r\n                <div>\r\n                  <h4 className=\"font-serif font-bold text-lg mb-2\">Visit Our Clinic</h4>\r\n                  \r\n                  {/* Address Text (Non-clickable) */}\r\n                  <p className=\"text-sm text-gray-400 leading-relaxed mb-3\">\r\n                    206, B-Block, 2nd Floor,<br/> \r\n                    Olive Greens, Gota, S.G. Highway,<br/> \r\n                    Ahmedabad - 382481\r\n                  </p>\r\n\r\n                  {/* ‚úÖ UPDATE: Get Directions Button */}\r\n                  <a \r\n                    href=\"https://maps.app.goo.gl/2EpwqWbUEQkiwR6k7\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"inline-flex items-center gap-2 text-[#c5a059] font-bold text-xs border border-[#c5a059] px-4 py-2 rounded-full hover:bg-[#c5a059] hover:text-[#1e3a29] transition\"\r\n                  >\r\n                    Get Directions <ArrowRight size={12} />\r\n                  </a>\r\n                </div>\r\n              </div>\r\n\r\n               <div className=\"flex gap-4 items-start\">\r\n                  <div className=\"w-10 h-10 bg-[#c5a059] rounded-full flex items-center justify-center shrink-0 text-[#1e3a29] mt-1\">\r\n                    <Phone size={20}/>\r\n                  </div>\r\n                  <div>\r\n                    <h4 className=\"font-serif font-bold text-lg mb-2\">Get in Touch</h4>\r\n                    {/* ‚úÖ UPDATE: WhatsApp Click-to-Chat */}\r\n                    <p className=\"text-sm text-gray-400 hover:text-[#c5a059] transition flex items-center gap-2\">\r\n                      <a href=\"tel:+916352135799\">+91 63521 35799</a>\r\n                      <a \r\n                        href=\"https://wa.me/916352135799\" \r\n                        target=\"_blank\" \r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"inline-flex items-center gap-1 text-[#25D366] font-bold bg-white/10 px-2 py-0.5 rounded text-[10px] hover:bg-[#25D366] hover:text-white transition\"\r\n                      >\r\n                         <MessageCircle size={10} /> WhatsApp\r\n                      </a>\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-400 mt-1 hover:text-[#c5a059] transition\">\r\n                      <a href=\"mailto:rudraayurved5@gmail.com\">rudraayurved5@gmail.com</a>\r\n                    </p>\r\n                  </div>\r\n               </div>\r\n\r\n               <div className=\"flex gap-4 items-start\">\r\n                  <div className=\"w-10 h-10 bg-[#c5a059] rounded-full flex items-center justify-center shrink-0 text-[#1e3a29] mt-1\">\r\n                    <Sparkles size={20}/>\r\n                  </div>\r\n                  <div>\r\n                    <h4 className=\"font-serif font-bold text-lg mb-2\">Social Media</h4>\r\n                    <div className=\"flex gap-4 mt-2\">\r\n                       <a href=\"https://www.instagram.com/rudraayurved5/?hl=en\" target=\"_blank\" className=\"bg-white/10 p-2 rounded-lg hover:bg-[#c5a059] hover:text-[#1e3a29] transition\">\r\n                         <Instagram size={20} />\r\n                       </a>\r\n                       <a href=\"https://www.facebook.com/p/Rudra-Ayurved-61577961763044/\" target=\"_blank\" className=\"bg-white/10 p-2 rounded-lg hover:bg-[#c5a059] hover:text-[#1e3a29] transition\">\r\n                         <Facebook size={20} />\r\n                       </a>\r\n                    </div>\r\n                  </div>\r\n               </div>\r\n            </div>\r\n\r\n            <div className=\"border-t border-white/10 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500\">\r\n               <p>¬© {new Date().getFullYear()} Rudra Ayurved. All Rights Reserved.</p>\r\n               <div className=\"flex gap-6 mt-4 md:mt-0\">\r\n                  <Link href=\"#\" className=\"hover:text-[#c5a059] transition\">Privacy Policy</Link>\r\n                  <Link href=\"#\" className=\"hover:text-[#c5a059] transition\">Terms of Service</Link>\r\n               </div>\r\n            </div>\r\n         </div>\r\n      </footer>\r\n\r\n      {/* --- BOOKING & DETAILS MODALS REMAIN UNCHANGED --- */}\r\n      {isBookingModalOpen && (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200\">\r\n          <div className=\"bg-white rounded-2xl p-6 w-full max-w-md shadow-2xl animate-in zoom-in duration-200\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                 <div>\r\n                    <h2 className=\"text-2xl font-serif font-bold text-[#1e3a29]\">Request Consultation</h2>\r\n                    <p className=\"text-xs text-gray-500\">We will call you to confirm the time.</p>\r\n                 </div>\r\n                 <button onClick={() => setIsBookingModalOpen(false)} className=\"text-gray-400 hover:text-red-500 transition\">\r\n                   <X size={24} />\r\n                 </button>\r\n              </div>\r\n\r\n              <div className=\"bg-[#1e3a29]/5 border border-[#1e3a29]/10 rounded-lg p-3 mb-6 flex items-center gap-3\">\r\n                <div className=\"bg-[#1e3a29] text-white p-2 rounded-full\">\r\n                  <Wallet size={16} />\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-xs font-bold text-gray-500 uppercase tracking-wide\">Consultation Charge</p>\r\n                  <p className=\"text-lg font-bold text-[#1e3a29]\">‚Çπ500 <span className=\"text-xs font-normal text-gray-500\">(Pay at Clinic)</span></p>\r\n                </div>\r\n              </div>\r\n              \r\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                <div>\r\n                   <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Full Name <span className=\"text-red-500\">*</span></label>\r\n                   <input \r\n                     required\r\n                     className=\"w-full p-3 border border-gray-200 rounded-lg outline-none focus:border-[#c5a059] focus:ring-1 focus:ring-[#c5a059] bg-white text-gray-900\"\r\n                     placeholder=\"Enter your name\"\r\n                     value={formData.name}\r\n                     onChange={(e) => setFormData({...formData, name: e.target.value})}\r\n                   />\r\n                </div>\r\n                <div>\r\n                   <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Mobile Number <span className=\"text-red-500\">*</span></label>\r\n                   <input \r\n                     required\r\n                     type=\"tel\"\r\n                     className=\"w-full p-3 border border-gray-200 rounded-lg outline-none focus:border-[#c5a059] focus:ring-1 focus:ring-[#c5a059] bg-white text-gray-900\"\r\n                     placeholder=\"e.g. 9876543210\"\r\n                     value={formData.phone}\r\n                     onChange={(e) => setFormData({...formData, phone: e.target.value})}\r\n                   />\r\n                </div>\r\n                <div>\r\n                   <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Symptoms / Purpose</label>\r\n                   <textarea \r\n                     className=\"w-full p-3 border border-gray-200 rounded-lg outline-none focus:border-[#c5a059] focus:ring-1 focus:ring-[#c5a059] resize-none h-24 bg-white text-gray-900\"\r\n                     placeholder=\"Briefly describe your issue...\"\r\n                     value={formData.symptoms}\r\n                     onChange={(e) => setFormData({...formData, symptoms: e.target.value})}\r\n                   />\r\n                </div>\r\n\r\n                <button \r\n                  disabled={loading}\r\n                  className=\"w-full bg-[#1e3a29] text-white font-bold py-3.5 rounded-lg hover:bg-[#162b1e] transition flex items-center justify-center gap-2 mt-2\"\r\n                >\r\n                  {loading ? <Loader2 className=\"animate-spin\" size={20} /> : \"Submit Request\"}\r\n                </button>\r\n              </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {selectedTreatment && (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md p-4 animate-in fade-in duration-300\">\r\n           <div className=\"bg-white rounded-2xl w-full max-w-5xl h-[85vh] md:h-auto overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300 flex flex-col md:flex-row relative\">\r\n              \r\n              {/* Close Button */}\r\n              <button \r\n                onClick={() => setSelectedTreatment(null)} \r\n                className=\"absolute top-4 right-4 z-20 bg-white/20 hover:bg-white text-gray-400 hover:text-red-500 backdrop-blur-sm p-2 rounded-full transition-all\"\r\n              >\r\n                <X size={24} />\r\n              </button>\r\n\r\n              {/* Left: Image Gallery */}\r\n              <div className=\"w-full md:w-1/2 bg-neutral-900 relative\">\r\n                  <div className=\"h-64 md:h-full relative\">\r\n                    {/* ‚úÖ UPDATED: Uses activeImage state */}\r\n                    <img \r\n                       src={activeImage} \r\n                       alt={selectedTreatment.name} \r\n                       className=\"w-full h-full object-cover\"\r\n                       onError={(e) => { e.currentTarget.style.display = 'none'; }}\r\n                    />\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex flex-col justify-end p-8\">\r\n                       <h2 className=\"text-3xl md:text-4xl font-serif font-bold text-white\">{selectedTreatment.name}</h2>\r\n                       <p className=\"text-[#c5a059] uppercase tracking-widest font-bold mt-2 text-sm\">{selectedTreatment.subtitle}</p>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Mini Gallery Strip */}\r\n                  <div className=\"absolute bottom-4 right-4 flex gap-2\">\r\n                     {selectedTreatment.gallery && selectedTreatment.gallery.map((img: string, i: number) => (\r\n                       <div \r\n                         key={i} \r\n                         onClick={() => setActiveImage(img)} // üëà Updated click handler\r\n                         className={`w-12 h-12 md:w-16 md:h-16 rounded-lg border-2 overflow-hidden cursor-pointer transition ${activeImage === img ? 'border-[#c5a059] scale-105' : 'border-white/50 hover:border-white'}`}\r\n                       >\r\n                           <img src={img} className=\"w-full h-full object-cover\" onError={(e) => { e.currentTarget.style.display = 'none'; }}/>\r\n                       </div>\r\n                     ))}\r\n                  </div>\r\n              </div>\r\n\r\n              {/* Right: Details */}\r\n              <div className=\"w-full md:w-1/2 p-6 md:p-10 overflow-y-auto bg-white flex flex-col\">\r\n                  <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2 text-[#c5a059] mb-4\">\r\n                         <Info size={18} />\r\n                         <span className=\"text-xs font-bold uppercase tracking-widest\">Therapy Details</span>\r\n                      </div>\r\n                      \r\n                      <p className=\"text-lg text-[#1e3a29] leading-relaxed mb-6 font-medium\">\r\n                         {selectedTreatment.detail}\r\n                      </p>\r\n\r\n                      {selectedTreatment.benefits && (\r\n                        <div className=\"mb-8\">\r\n                          <h4 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\r\n                            <CheckCircle2 size={18} className=\"text-[#c5a059]\" /> Key Benefits\r\n                          </h4>\r\n                          <ul className=\"grid grid-cols-1 gap-3\">\r\n                            {selectedTreatment.benefits.map((benefit: string, i: number) => (\r\n                              <li key={i} className=\"text-gray-600 text-sm flex items-start gap-3 bg-gray-50 p-3 rounded-lg border border-gray-100\">\r\n                                  <span className=\"w-1.5 h-1.5 bg-[#1e3a29] rounded-full mt-1.5 shrink-0\"></span>\r\n                                  {benefit}\r\n                              </li>\r\n                            ))}\r\n                          </ul>\r\n                        </div>\r\n                      )}\r\n                  </div>\r\n\r\n                  <div className=\"pt-6 border-t border-gray-100 mt-6\">\r\n                      <button \r\n                        onClick={handleBookFromTreatment}\r\n                        className=\"w-full bg-[#1e3a29] text-white py-4 rounded-xl font-bold text-lg hover:bg-[#162b1e] transition flex items-center justify-center gap-2 shadow-lg shadow-[#1e3a29]/20\"\r\n                      >\r\n                         <Calendar size={20} /> Book This Therapy\r\n                      </button>\r\n                      <p className=\"text-center text-xs text-gray-400 mt-3\">\r\n                        Consultation required before therapy confirmation.\r\n                      </p>\r\n                  </div>\r\n              </div>\r\n           </div>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\patients\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":46,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMemo"},"fix":{"range":[53,62],"text":""},"desc":"Remove unused variable \"useMemo\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":8,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Phone"},"fix":{"range":[294,301],"text":""},"desc":"Remove unused variable \"Phone\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Activity' is defined but never used.","line":10,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":70,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Activity"},"fix":{"range":[441,451],"text":""},"desc":"Remove unused variable \"Activity\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IndianRupee' is defined but never used.","line":11,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":52,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"IndianRupee"},"fix":{"range":[492,505],"text":""},"desc":"Remove unused variable \"IndianRupee\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":11,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":64,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CreditCard"},"fix":{"range":[505,517],"text":""},"desc":"Remove unused variable \"CreditCard\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2919,2922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2919,2922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3071,3074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3071,3074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3308,3311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3308,3311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3372,3375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3372,3375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4122,4125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4122,4125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":131,"column":6,"nodeType":"ArrayExpression","endLine":131,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [patientId, linkedAppointmentIdParam, loadData]","fix":{"range":[5025,5062],"text":"[patientId, linkedAppointmentIdParam, loadData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5326,5329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5326,5329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5588,5591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5588,5591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6092,6095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6092,6095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6130,6133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6130,6133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":222,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7893,7896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7893,7896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9126,9129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9126,9129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":327,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11494,11497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11494,11497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":338,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11934,11937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11934,11937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":401,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14034,14037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14034,14037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":402,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14091,14094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14091,14094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":217,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":220,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24482,24485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24482,24485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":380,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":383,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24645,24648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24645,24648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":534,"column":184,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":187,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24869,24872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24869,24872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":534,"column":303,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":306,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24988,24991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24988,24991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":535,"column":204,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":207,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25220,25223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25220,25223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":535,"column":353,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":356,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25369,25372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25369,25372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":536,"column":206,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":536,"endColumn":209,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25618,25621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25618,25621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":536,"column":347,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":536,"endColumn":350,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25759,25762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25759,25762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":538,"column":211,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":538,"endColumn":214,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26073,26076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26073,26076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":538,"column":346,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":538,"endColumn":349,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26208,26211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26208,26211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":539,"column":213,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":539,"endColumn":216,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26457,26460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26457,26460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":539,"column":352,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":539,"endColumn":355,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26596,26599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26596,26599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":541,"column":207,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":541,"endColumn":210,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26871,26874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26871,26874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":541,"column":348,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":541,"endColumn":351,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27012,27015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27012,27015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":542,"column":207,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":542,"endColumn":210,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27258,27261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27258,27261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":542,"column":346,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":542,"endColumn":349,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27397,27400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27397,27400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":543,"column":246,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":543,"endColumn":249,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27681,27684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27681,27684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":543,"column":454,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":543,"endColumn":457,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27889,27892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27889,27892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":698,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":698,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42249,42252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42249,42252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef, useMemo } from \"react\";\r\nimport { useRouter, useParams, useSearchParams } from \"next/navigation\"; \r\nimport StaffHeader from \"@/app/components/StaffHeader\"; \r\nimport { generateBill } from \"@/app/components/BillGenerator\";\r\nimport { \r\n  User, Phone, Calendar, Edit2, Search, \r\n  Plus, FileText, Trash2, Stethoscope, Loader2, X,\r\n  FileUp, Eye, Printer, Scale, Leaf, Droplets, BadgePercent, Activity,\r\n  ChevronDown, ChevronUp, Save, Wallet, IndianRupee, CreditCard\r\n} from \"lucide-react\";\r\n\r\nimport { \r\n  getPatientData, \r\n  getPharmacyInventory, \r\n  updatePatientDetails, \r\n  savePrescription, \r\n  searchPatients,\r\n  deleteVisit,\r\n  uploadConsultationReport,\r\n  updatePatientWallet // ‚úÖ Using the dedicated wallet action\r\n} from \"@/app/patients/actions\"; // Ensuring we import from the correct actions file\r\n\r\n// --- STATIC DATA ---\r\nconst DOSAGE_OPTIONS = [\r\n  \"1-0-0\", \"0-1-0\", \"0-0-1\", \"1-0-1\", \"1-1-0\", \"0-1-1\", \"1-1-1\", \r\n  \"2-0-0\", \"0-2-0\", \"0-0-2\", \"2-0-2\", \"2-2-0\", \"0-2-2\", \"2-2-2\", \r\n  \"3-0-0\", \"0-3-0\", \"0-0-3\", \"3-0-3\", \"3-3-0\", \"0-3-3\", \"3-3-3\",\r\n  \"4-0-0\", \"0-4-0\", \"0-0-4\", \"4-0-4\", \"4-4-0\", \"0-4-4\", \"4-4-4\", \r\n  \"SOS\"\r\n];\r\nconst UNIT_OPTIONS = [\"Tablet\", \"Capsule\", \"Spoon (tsp)\", \"Drop\", \"Sachet\", \"Pouch\", \"Ointment\", \"Powder\"]; \r\nconst INSTRUCTION_OPTIONS = [\"After Food\", \"Before Food\", \"Empty Stomach\", \"Before Sleep\"]; \r\nconst WITH_OPTIONS = [\"Regular Water\", \"Warm Water\", \"Milk\", \"Honey\", \"Ghee\", \"External Application\"]; \r\n\r\nconst REGULAR_DURATIONS = [\"7 Days\",\"10 Days\",\"15 Days\", \"21 Days\", \"30 Days\", \"45 Days\", \"60 Days\", \"90 Days\",\"120 Days\"];\r\nconst PANCHKARMA_DURATIONS = Array.from({length: 30}, (_, i) => `${i + 1} Days`);\r\n\r\nconst PHYSICAL_GENERALS_TEMPLATE = `Appetite : \r\nThirst : \r\nCraving/Desire For Food Or Drinks (If Any) : \r\nAversion Of Food Or Drinks (If Any) : \r\nTaste You Prefer Most : Sweet [ ], Spicy [ ], Sour [ ], Salty [ ]\r\nThermal : \r\nPerspiration : \r\nBowels : \r\nUrine : \r\nSleep : \r\nDreams : \r\nFears : `;\r\n\r\n// ‚úÖ HELPER: Sanitize Name\r\nconst cleanName = (name: string) => {\r\n    if (!name) return \"Unknown\";\r\n    return name.replace(/[0-9]/g, '').trim();\r\n};\r\n\r\nexport default function PatientProfile() {\r\n  const router = useRouter();\r\n  const params = useParams();\r\n  const searchParams = useSearchParams();\r\n  const patientId = params.id as string;\r\n  const linkedAppointmentIdParam = searchParams.get('appointmentId'); \r\n\r\n  // --- STATE ---\r\n  const [loading, setLoading] = useState(true);\r\n  const [savingDetails, setSavingDetails] = useState(false);\r\n  const [uploadingId, setUploadingId] = useState<string | null>(null);\r\n  const [isEditingDetails, setIsEditingDetails] = useState(false);\r\n  const [showExtendedDetails, setShowExtendedDetails] = useState(false); \r\n\r\n  // Search States\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [patientSuggestions, setPatientSuggestions] = useState<any[]>([]);\r\n  const [showPatientSearch, setShowPatientSearch] = useState(false);\r\n\r\n  // Medicine States\r\n  const [inventory, setInventory] = useState<any[]>([]); \r\n  const [medQuery, setMedQuery] = useState(\"\"); \r\n  const [showMedList, setShowMedList] = useState(false);\r\n  const medListRef = useRef<HTMLDivElement>(null); \r\n\r\n  // Patient Data\r\n  const [patient, setPatient] = useState<any>(null);\r\n  const [visitHistory, setVisitHistory] = useState<any[]>([]);\r\n\r\n  // Current Visit (Draft)\r\n  const [consultationType, setConsultationType] = useState<'REGULAR' | 'PANCHKARMA'>('REGULAR');\r\n  const [visitNote, setVisitNote] = useState(\"\"); \r\n  const [panchkarmaNote, setPanchkarmaNote] = useState(\"\"); \r\n  const [isChargeable, setIsChargeable] = useState(\"YES\"); \r\n  \r\n  // Wallet Modal State\r\n  const [showWalletModal, setShowWalletModal] = useState(false);\r\n  const [walletAmount, setWalletAmount] = useState(\"\");\r\n  const [walletType, setWalletType] = useState<\"CREDIT\" | \"DUE\">(\"CREDIT\");\r\n\r\n  // Track the Appointment ID explicitly\r\n  const [selectedAppointmentId, setSelectedAppointmentId] = useState<string | null>(null);\r\n\r\n  const [currentPrescriptions, setCurrentPrescriptions] = useState<any[]>([]);\r\n  const [editingVisitId, setEditingVisitId] = useState<string | null>(null); \r\n  \r\n  const [editingMedId, setEditingMedId] = useState<number | null>(null);\r\n\r\n  const [newMed, setNewMed] = useState({\r\n    medicineId: \"\", \r\n    medicineName: \"\",\r\n    dosage: \"1-0-1\", \r\n    unit: \"Tablet\",\r\n    duration: \"7 Days\", \r\n    instruction: \"\",\r\n    with: \"Regular Water\" \r\n  });\r\n\r\n  // --- 1. LOAD DATA ---\r\n  useEffect(() => {\r\n    if(linkedAppointmentIdParam) {\r\n        setSelectedAppointmentId(linkedAppointmentIdParam);\r\n    }\r\n    loadData();\r\n\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (medListRef.current && !medListRef.current.contains(event.target as Node)) {\r\n        setShowMedList(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, [patientId, linkedAppointmentIdParam]);\r\n\r\n  async function loadData() {\r\n    try {\r\n      setLoading(true);\r\n      const [pData, pharmacyData] = await Promise.all([\r\n        getPatientData(patientId),\r\n        getPharmacyInventory()\r\n      ]);\r\n\r\n      if (pData) {\r\n        const rawData = pData as any;\r\n        \r\n        setPatient({\r\n            ...pData,\r\n            physicalGenerals: rawData.physicalGenerals ? rawData.physicalGenerals : PHYSICAL_GENERALS_TEMPLATE\r\n        });\r\n        \r\n        const mappedHistory = (pData.consultations || []).map((c: any) => ({\r\n          id: c.id,\r\n          appointmentId: c.appointment?.readableId,\r\n          date: c.createdAt,\r\n          diagnosis: c.diagnosis,\r\n          notes: c.notes, \r\n          doctorName: c.doctorName,\r\n          reportUrl: c.reportUrl,\r\n          pharmacyDiscount: c.discount || 0, \r\n          appointmentDiscount: c.appointment?.discount || 0,\r\n          paidAmount: c.paidAmount || 0,\r\n          paymentMode: c.paymentMode || \"Cash\",\r\n          prescriptions: c.prescriptions.flatMap((p: any) => \r\n            p.items.map((i: any) => ({\r\n              id: i.id, \r\n              medicineName: i.medicine.name, \r\n              medicineId: i.medicineId,\r\n              dosage: i.dosage,\r\n              unit: i.unit,\r\n              duration: i.duration,\r\n              instruction: i.instruction,\r\n              panchkarma: i.panchkarma,\r\n              price: i.medicine.price \r\n            }))\r\n          )\r\n        }));\r\n        setVisitHistory(mappedHistory);\r\n      }\r\n      setInventory(pharmacyData || []);\r\n    } catch (err) {\r\n      console.error(\"Load Failed\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  // --- 2. SEARCH EFFECT ---\r\n  useEffect(() => {\r\n    const delayDebounceFn = setTimeout(async () => {\r\n      if (searchQuery.length > 1) {\r\n        const results = await searchPatients(searchQuery);\r\n        setPatientSuggestions(results);\r\n        setShowPatientSearch(true);\r\n      } else {\r\n        setPatientSuggestions([]);\r\n        setShowPatientSearch(false);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(delayDebounceFn);\r\n  }, [searchQuery]);\r\n\r\n  // --- HANDLERS ---\r\n  const selectPatient = (id: string) => {\r\n    setSearchQuery(\"\");\r\n    setShowPatientSearch(false);\r\n    router.push(`/patients/${id}`);\r\n  };\r\n\r\n  const handleSaveDetails = async () => {\r\n    setSavingDetails(true);\r\n    const cleanData = {\r\n        ...patient,\r\n        initialWeight: patient.initialWeight || null,\r\n        currentWeight: patient.currentWeight || null,\r\n        physicalGenerals: patient.physicalGenerals\r\n    };\r\n\r\n    const res = await updatePatientDetails(patientId, cleanData);\r\n    setSavingDetails(false);\r\n    if (res.success) setIsEditingDetails(false);\r\n    else alert(\"Failed to update details.\");\r\n  };\r\n\r\n  const selectMedicine = (med: any) => {\r\n    setNewMed({ ...newMed, medicineId: med.id, medicineName: med.name, unit: med.type || \"Tablet\" });\r\n    setMedQuery(med.name); \r\n    setShowMedList(false); \r\n  };\r\n\r\n  const handleAddMedicine = () => {\r\n    if (!newMed.medicineId && !newMed.medicineName) return alert(\"Please select or enter a medicine\");\r\n    \r\n    const combinedInstruction = consultationType === 'REGULAR' \r\n        ? `${newMed.instruction} (with ${newMed.with})`\r\n        : newMed.instruction;\r\n\r\n    const newItem = {\r\n        ...newMed,\r\n        instruction: combinedInstruction,\r\n        medicineName: newMed.medicineName || medQuery,\r\n        dosage: consultationType === 'REGULAR' ? newMed.dosage : \"-\",\r\n        unit: consultationType === 'REGULAR' ? newMed.unit : \"-\",\r\n        id: Date.now()\r\n    };\r\n\r\n    if (editingMedId !== null) {\r\n        setCurrentPrescriptions(prev => prev.map(item => item.id === editingMedId ? { ...item, ...newItem } : item));\r\n        setEditingMedId(null);\r\n    } else {\r\n        setCurrentPrescriptions([...currentPrescriptions, newItem]);\r\n    }\r\n    \r\n    setNewMed({ ...newMed, medicineId: \"\", medicineName: \"\", instruction: \"\" }); \r\n    setMedQuery(\"\"); \r\n  };\r\n\r\n  const handleEditDraftMedicine = (item: any) => {\r\n      setEditingMedId(item.id);\r\n      setMedQuery(item.medicineName);\r\n      \r\n      let instr = item.instruction;\r\n      let withVal = \"Regular Water\"; \r\n      if (instr && instr.includes(\"(with\")) {\r\n         const parts = instr.split(\"(with\");\r\n         instr = parts[0].trim();\r\n         withVal = parts[1].replace(\")\", \"\").trim();\r\n      }\r\n\r\n      setNewMed({\r\n          medicineId: item.medicineId,\r\n          medicineName: item.medicineName,\r\n          dosage: item.dosage,\r\n          unit: item.unit,\r\n          duration: item.duration,\r\n          instruction: instr,\r\n          with: withVal\r\n      });\r\n  };\r\n\r\n  const removeDraftMedicine = (id: number) => {\r\n    setCurrentPrescriptions(currentPrescriptions.filter(p => p.id !== id));\r\n    if (editingMedId === id) {\r\n        setEditingMedId(null);\r\n        setNewMed({ ...newMed, medicineId: \"\", medicineName: \"\", instruction: \"\" });\r\n        setMedQuery(\"\");\r\n    }\r\n  };\r\n\r\n  const handleSaveVisit = async () => {\r\n    if (currentPrescriptions.length === 0 && !visitNote && !panchkarmaNote) {\r\n      return alert(\"Please add medicines or a note before saving.\");\r\n    }\r\n    \r\n    // Logic: If Chargeable=YES, Discount=0. If NO, Discount=500.\r\n    const calculatedApptDiscount = isChargeable === \"YES\" ? 0 : 500;\r\n\r\n    const visitData = { \r\n      diagnosis: consultationType === 'REGULAR' ? visitNote : \"Panchkarma Procedure\", \r\n      notes: panchkarmaNote, \r\n      prescriptions: currentPrescriptions,\r\n      doctorName: \"Dr. Chirag Raval\",\r\n      \r\n      appointmentId: selectedAppointmentId,\r\n      appointmentDiscount: calculatedApptDiscount, \r\n      \r\n      // Default to 0 so it registers as \"Due\" in wallet if not paid immediately\r\n      discount: 0,\r\n      paidAmount: 0,\r\n      paymentMode: \"Cash\"\r\n    };\r\n    \r\n    const result = await savePrescription(patientId, visitData, editingVisitId || undefined);\r\n    \r\n    if (result.success) {\r\n      alert(editingVisitId ? \"Consultation Updated!\" : \"Consultation Saved!\");\r\n      window.location.reload();\r\n    } else {\r\n      alert(\"Failed to save visit.\");\r\n    }\r\n  };\r\n\r\n  const handleDeleteHistory = async (id: string) => {\r\n    if (confirm(\"Delete this consultation?\")) {\r\n      await deleteVisit(id, patientId);\r\n      setVisitHistory(visitHistory.filter(v => v.id !== id));\r\n    }\r\n  };\r\n\r\n  const handleEditHistory = (visit: any) => {\r\n    if (currentPrescriptions.length > 0) {\r\n      if(!confirm(\"Discard current unsaved changes?\")) return;\r\n    }\r\n    \r\n    setEditingVisitId(visit.id); \r\n    setVisitNote(visit.diagnosis || \"\");\r\n    setPanchkarmaNote(visit.notes || \"\");\r\n    setSelectedAppointmentId(visit.appointmentId || null);\r\n    setIsChargeable(visit.appointmentDiscount >= 500 ? \"NO\" : \"YES\");\r\n    \r\n    const draftItems = visit.prescriptions.map((p: any) => ({\r\n       id: Math.random(),\r\n       medicineId: p.medicineId,\r\n       medicineName: p.medicineName,\r\n       dosage: p.dosage,\r\n       unit: p.unit || \"Tablet\",\r\n       duration: p.duration,\r\n       instruction: p.instruction,\r\n    }));\r\n    setCurrentPrescriptions(draftItems);\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n  };\r\n\r\n  const handleCancelEdit = () => {\r\n      setEditingVisitId(null);\r\n      setVisitNote(\"\");\r\n      setPanchkarmaNote(\"\");\r\n      setIsChargeable(\"YES\");\r\n      setSelectedAppointmentId(linkedAppointmentIdParam || null);\r\n      setCurrentPrescriptions([]);\r\n  };\r\n\r\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>, consultationId: string) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    if (file.size > 4 * 1024 * 1024) return alert(\"File size too large (Max 4MB)\");\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n    formData.append(\"consultationId\", consultationId);\r\n\r\n    setUploadingId(consultationId);\r\n    try {\r\n        const res = await uploadConsultationReport(formData);\r\n        if (res.success) {\r\n            setVisitHistory(prev => prev.map(v => v.id === consultationId ? {...v, reportUrl: res.url} : v));\r\n        } else {\r\n            alert(\"Upload failed\");\r\n        }\r\n    } catch (error) {\r\n        console.error(error);\r\n        alert(\"Error uploading file\");\r\n    } finally {\r\n        setUploadingId(null);\r\n    }\r\n  };\r\n\r\n  // ‚úÖ MANAGE WALLET: Now uses the consistent updatePatientWallet action\r\n  const handleWalletUpdate = async () => {\r\n      if (!walletAmount || parseFloat(walletAmount) <= 0) return alert(\"Please enter valid amount\");\r\n\r\n      const res = await updatePatientWallet(patientId, parseFloat(walletAmount), walletType);\r\n\r\n      if(res.success) {\r\n          alert(\"Wallet Updated!\");\r\n          setShowWalletModal(false);\r\n          setWalletAmount(\"\");\r\n          loadData(); // Refresh data to show new balance\r\n      } else {\r\n          alert(\"Failed to update wallet\");\r\n      }\r\n  };\r\n\r\n  const handlePrintReceipt = (visit: any) => {\r\n    const items = visit.prescriptions.map((p: any) => ({\r\n        name: `${p.medicineName} ${p.unit !== '-' ? `(${p.unit})` : ''}`,\r\n        qty: 1, \r\n        amount: p.price || 0 \r\n    }));\r\n\r\n    const fee = 500 - (visit.appointmentDiscount || 0);\r\n\r\n    if (fee > 0) items.unshift({ name: \"Consultation Charge\", qty: 1, amount: fee });\r\n    else items.unshift({ name: \"Consultation (Free)\", qty: 1, amount: 0 });\r\n    \r\n    if (visit.pharmacyDiscount > 0) items.push({ name: \"PHARMACY DISCOUNT\", qty: 1, amount: -visit.pharmacyDiscount });\r\n\r\n    if (visit.paidAmount > 0) items.push({ name: `PAID (${visit.paymentMode})`, qty: 1, amount: -visit.paidAmount });\r\n\r\n    generateBill({\r\n        billNo: `RCPT-${visit.id.slice(-4).toUpperCase()}`,\r\n        date: new Date(visit.date).toLocaleDateString(),\r\n        patientName: cleanName(patient.name), \r\n        patientId: patient.readableId || patient.id.slice(0,6),\r\n        appointmentId: visit.appointmentId || \"WALK-IN\", \r\n        doctorName: visit.doctorName || \"Dr. Chirag Raval\",\r\n        items: items\r\n    });\r\n  };\r\n\r\n  if (loading) return <div className=\"flex items-center justify-center h-screen\"><Loader2 className=\"animate-spin\" /> Loading...</div>;\r\n  if (!patient) return <div className=\"p-10 text-center\">Patient not found</div>;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex flex-col\">\r\n      <StaffHeader />\r\n\r\n      <main className=\"flex-1 p-6 max-w-7xl mx-auto w-full space-y-6\">\r\n        \r\n        {/* --- TOP BAR (SEARCH & WALLET) --- */}\r\n        <div className=\"flex flex-col sm:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-100\">\r\n           <div>\r\n            <h2 className=\"text-2xl font-serif font-bold text-[#1e3a29]\">Patient Profile</h2>\r\n            <div className=\"flex gap-2 items-center mt-1\">\r\n                <p className=\"text-xs text-[#c5a059] font-bold uppercase tracking-widest bg-[#1e3a29]/5 px-2 py-1 rounded w-fit\">\r\n                    ID: {patient.readableId}\r\n                </p>\r\n                {linkedAppointmentIdParam && <span className=\"text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold\">Linked: {linkedAppointmentIdParam.slice(-4)}</span>}\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-4 w-full sm:w-auto\">\r\n              {/* üí∞ WALLET BADGE */}\r\n              <button \r\n                  onClick={() => {\r\n                      setWalletAmount(\"\");\r\n                      setWalletType(\"CREDIT\");\r\n                      setShowWalletModal(true);\r\n                  }} \r\n                  className={`flex items-center gap-2 px-4 py-2 rounded-lg border shadow-sm transition hover:shadow-md ${patient.walletBalance < 0 ? 'bg-red-50 border-red-200 text-red-700' : (patient.walletBalance > 0 ? 'bg-green-50 border-green-200 text-green-700' : 'bg-gray-50 text-gray-600')}`}\r\n              >\r\n                  <Wallet size={18}/>\r\n                  <div className=\"text-left\">\r\n                      <p className=\"text-[10px] font-bold uppercase\">Wallet Balance</p>\r\n                      <p className=\"font-bold text-sm\">\r\n                          {patient.walletBalance < 0 ? `Due: ‚Çπ${Math.abs(patient.walletBalance)}` : `Credit: ‚Çπ${patient.walletBalance}`}\r\n                      </p>\r\n                  </div>\r\n              </button>\r\n\r\n              <div className=\"relative w-full sm:w-80\">\r\n                <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={18} />\r\n                    <input \r\n                    type=\"text\" \r\n                    placeholder=\"Search Patient...\" \r\n                    className=\"w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-[#c5a059]\"\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                    onFocus={() => searchQuery.length > 1 && setShowPatientSearch(true)}\r\n                    onBlur={() => setTimeout(() => setShowPatientSearch(false), 200)} \r\n                    />\r\n                    {searchQuery && (\r\n                    <button onClick={() => { setSearchQuery(\"\"); setShowPatientSearch(false); }} className=\"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600\">\r\n                        <X size={16} />\r\n                    </button>\r\n                    )}\r\n                </div>\r\n                {showPatientSearch && patientSuggestions.length > 0 && (\r\n                    <div className=\"absolute top-full mt-2 left-0 w-full bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden z-50\">\r\n                        {patientSuggestions.map((p) => (\r\n                            <button key={p.id} onClick={() => selectPatient(p.id)} className=\"w-full text-left px-4 py-3 hover:bg-gray-50 border-b flex justify-between group\">\r\n                                <div><p className=\"font-bold text-sm text-[#1e3a29]\">{cleanName(p.name)}</p><p className=\"text-xs text-gray-500\">{p.phone}</p></div>\r\n                                <div className=\"text-right\">\r\n                                    <span className=\"text-xs font-mono bg-gray-100 px-2 py-1 rounded\">{p.readableId}</span>\r\n                                    {p.walletBalance !== 0 && (\r\n                                        <p className={`text-[10px] font-bold mt-1 ${p.walletBalance < 0 ? 'text-red-500' : 'text-green-500'}`}>\r\n                                            {p.walletBalance < 0 ? `Due: ${Math.abs(p.walletBalance)}` : `Adv: ${p.walletBalance}`}\r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n              </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          \r\n          {/* --- LEFT: PATIENT DETAILS --- */}\r\n          <div className=\"lg:col-span-1 space-y-6\">\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden\">\r\n              <div className=\"bg-[#1e3a29] p-4 flex justify-between items-center\">\r\n                  <h3 className=\"text-white font-bold flex items-center gap-2\"><User size={18} /> Personal Details</h3>\r\n                  <button onClick={() => isEditingDetails ? handleSaveDetails() : setIsEditingDetails(true)} disabled={savingDetails} className=\"bg-[#c5a059] text-[#1e3a29] px-3 py-1 rounded text-xs font-bold disabled:opacity-50\">\r\n                    {savingDetails ? \"Saving...\" : (isEditingDetails ? \"Save\" : \"Edit\")}\r\n                  </button>\r\n              </div>\r\n              <div className=\"p-6 space-y-4 max-h-[80vh] overflow-y-auto\">\r\n                <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Name</label>{isEditingDetails ? <input className=\"w-full border-b font-medium\" value={patient.name} onChange={e => setPatient({...patient, name: e.target.value})} /> : <p className=\"font-bold text-xl\">{cleanName(patient.name)}</p>}</div>\r\n                <div className=\"flex gap-4\">\r\n                   <div className=\"flex-1\"><label className=\"text-xs text-gray-400 uppercase\">Age</label>{isEditingDetails ? <input type=\"number\" className=\"w-full border-b\" value={patient.age} onChange={e => setPatient({...patient, age: e.target.value})} /> : <p>{patient.age} Y</p>}</div>\r\n                   <div className=\"flex-1\"><label className=\"text-xs text-gray-400 uppercase\">Gender</label>{isEditingDetails ? <select className=\"w-full border-b\" value={patient.gender} onChange={e => setPatient({...patient, gender: e.target.value})}><option>Male</option><option>Female</option></select> : <p>{patient.gender}</p>}</div>\r\n                </div>\r\n                <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Phone</label>{isEditingDetails ? <input className=\"w-full border-b\" value={patient.phone} onChange={e => setPatient({...patient, phone: e.target.value})} /> : <p>{patient.phone}</p>}</div>\r\n                <div><label className=\"text-xs font-bold text-gray-400 uppercase\">History / Allergies</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-sm rounded\" rows={2} value={patient.history || \"\"} onChange={e => setPatient({...patient, history: e.target.value})} /> : <p className=\"text-sm italic text-gray-600\">{patient.history || \"-\"}</p>}</div>\r\n                <div className=\"grid grid-cols-2 gap-4 pt-2 border-t border-dashed\">\r\n                   <div><label className=\"text-[10px] font-bold text-gray-400 uppercase flex items-center gap-1\"><Scale size={10}/> Weight</label>{isEditingDetails ? <div className=\"flex gap-1\"><input placeholder=\"Cur\" className=\"w-10 border-b text-sm\" value={patient.currentWeight || \"\"} onChange={e => setPatient({...patient, currentWeight: e.target.value})} /><span className=\"text-gray-400\">/</span><input placeholder=\"Init\" className=\"w-10 border-b text-sm\" value={patient.initialWeight || \"\"} onChange={e => setPatient({...patient, initialWeight: e.target.value})} /></div> : <p className=\"text-sm font-bold text-gray-700\">{patient.currentWeight || \"-\"} / {patient.initialWeight || \"-\"}</p>}</div>\r\n                   <div><label className=\"text-[10px] font-bold text-gray-400 uppercase flex items-center gap-1\"><Leaf size={10}/> Prakriti</label>{isEditingDetails ? <input className=\"w-full border-b text-sm\" value={patient.prakriti || \"\"} onChange={e => setPatient({...patient, prakriti: e.target.value})} /> : <p className=\"text-sm font-bold text-purple-700\">{patient.prakriti || \"-\"}</p>}</div>\r\n                </div>\r\n                <button onClick={() => setShowExtendedDetails(!showExtendedDetails)} className=\"text-xs font-bold text-[#c5a059] flex items-center gap-1 w-full justify-center border-t border-b py-2\">{showExtendedDetails ? <><ChevronUp size={14}/> Show Less</> : <><ChevronDown size={14}/> Show Medical History</>}</button>\r\n                {showExtendedDetails && (\r\n                   <div className=\"space-y-4 pt-2 animate-in slide-in-from-top-2\">\r\n                      <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Chief Complaints</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-sm rounded\" rows={2} value={(patient as any).chiefComplaints || \"\"} onChange={e => setPatient({...patient, chiefComplaints: e.target.value})} /> : <p className=\"text-sm whitespace-pre-wrap\">{(patient as any).chiefComplaints || \"-\"}</p>}</div>\r\n                      <div><label className=\"text-xs font-bold text-gray-400 uppercase\">K/C/O</label>{isEditingDetails ? <input className=\"w-full border-b text-sm\" value={(patient as any).kco || \"\"} onChange={e => setPatient({...patient, kco: e.target.value})} /> : <p className=\"text-sm\">{(patient as any).kco || \"-\"}</p>}</div>\r\n                      <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Current Meds</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-sm rounded\" value={(patient as any).currentMedications || \"\"} onChange={e => setPatient({...patient, currentMedications: e.target.value})} /> : <p className=\"text-sm\">{(patient as any).currentMedications || \"-\"}</p>}</div>\r\n                      <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Investigations</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-sm rounded\" value={(patient as any).investigations || \"\"} onChange={e => setPatient({...patient, investigations: e.target.value})} /> : <p className=\"text-sm\">{(patient as any).investigations || \"-\"}</p>}</div>\r\n                      <div className=\"grid grid-cols-2 gap-3\">\r\n                         <div><label className=\"text-[10px] font-bold text-gray-400 uppercase\">Past History</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-xs rounded\" value={(patient as any).pastHistory || \"\"} onChange={e => setPatient({...patient, pastHistory: e.target.value})} /> : <p className=\"text-xs\">{(patient as any).pastHistory || \"-\"}</p>}</div>\r\n                         <div><label className=\"text-[10px] font-bold text-gray-400 uppercase\">Family History</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-xs rounded\" value={(patient as any).familyHistory || \"\"} onChange={e => setPatient({...patient, familyHistory: e.target.value})} /> : <p className=\"text-xs\">{(patient as any).familyHistory || \"-\"}</p>}</div>\r\n                      </div>\r\n                      <div><label className=\"text-xs font-bold text-gray-400 uppercase\">Mental Generals</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-sm rounded\" value={(patient as any).mentalGenerals || \"\"} onChange={e => setPatient({...patient, mentalGenerals: e.target.value})} /> : <p className=\"text-sm\">{(patient as any).mentalGenerals || \"-\"}</p>}</div>\r\n                      <div><label className=\"text-xs font-bold text-gray-400 uppercase\">OBS/GYN History</label>{isEditingDetails ? <textarea className=\"w-full border p-1 text-sm rounded\" value={(patient as any).obsGynHistory || \"\"} onChange={e => setPatient({...patient, obsGynHistory: e.target.value})} /> : <p className=\"text-sm\">{(patient as any).obsGynHistory || \"-\"}</p>}</div>\r\n                      <div><label className=\"text-xs font-bold text-gray-400 uppercase block mb-1\">Physical Generals</label>{isEditingDetails ? <textarea className=\"w-full border p-2 text-xs font-mono rounded bg-gray-50 h-64\" value={(patient as any).physicalGenerals} onChange={e => setPatient({...patient, physicalGenerals: e.target.value})} /> : <pre className=\"text-xs text-gray-600 whitespace-pre-wrap font-sans bg-gray-50 p-2 rounded\">{(patient as any).physicalGenerals}</pre>}</div>\r\n                   </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* --- RIGHT: PRESCRIBE --- */}\r\n          <div className=\"lg:col-span-2 space-y-6\">\r\n            \r\n            <div className={`bg-white rounded-xl shadow-sm border p-6 relative ${editingVisitId ? 'border-amber-400 ring-1 ring-amber-400' : 'border-gray-100'}`}>\r\n               <div className=\"flex justify-between items-center mb-4\">\r\n                  <h3 className=\"font-bold text-[#1e3a29] flex items-center gap-2\">\r\n                     <Stethoscope className=\"text-[#c5a059]\" /> \r\n                     {editingVisitId ? \"Editing Past Consultation\" : \"New Consultation\"}\r\n                  </h3>\r\n                  {editingVisitId && (\r\n                     <button onClick={handleCancelEdit} className=\"text-xs bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-gray-600\">Cancel Edit</button>\r\n                  )}\r\n               </div>\r\n\r\n               <div className=\"flex gap-4 mb-4 p-1 bg-gray-50 rounded-lg w-fit\">\r\n                  <button type=\"button\" onClick={() => setConsultationType('REGULAR')} className={`px-4 py-2 text-xs font-bold rounded-md transition ${consultationType === 'REGULAR' ? 'bg-[#1e3a29] text-white shadow' : 'text-gray-500 hover:bg-gray-200'}`}>Regular Consultation</button>\r\n                  <button type=\"button\" onClick={() => setConsultationType('PANCHKARMA')} className={`px-4 py-2 text-xs font-bold rounded-md transition ${consultationType === 'PANCHKARMA' ? 'bg-[#c5a059] text-[#1e3a29] shadow' : 'text-gray-500 hover:bg-gray-200'}`}>Panchkarma / Procedure</button>\r\n               </div>\r\n               \r\n               {consultationType === 'REGULAR' && (\r\n                 <>\r\n                    <div className=\"mb-4\">\r\n                        <label className=\"text-[10px] font-bold uppercase text-gray-400\">Diagnosis / Symptoms</label>\r\n                        <textarea className=\"w-full p-3 border rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#c5a059] outline-none\" rows={2} value={visitNote} onChange={(e) => setVisitNote(e.target.value)} placeholder=\"Enter diagnosis...\" />\r\n                    </div>\r\n                    <div className=\"mb-4\">\r\n                        <label className=\"text-[10px] font-bold uppercase text-gray-400\">Special Note (Optional)</label>\r\n                        <textarea className=\"w-full p-2 border rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#c5a059] outline-none\" rows={1} value={panchkarmaNote} onChange={(e) => setPanchkarmaNote(e.target.value)} placeholder=\"Enter special notes...\" />\r\n                    </div>\r\n                 </>\r\n               )}\r\n\r\n               {consultationType === 'PANCHKARMA' && (\r\n                 <div className=\"mb-4\">\r\n                    <label className=\"text-[10px] font-bold uppercase text-[#c5a059]\">Procedure Details / Notes</label>\r\n                    <textarea \r\n                        className=\"w-full p-3 border border-purple-100 rounded-lg text-sm outline-none focus:ring-2 focus:ring-purple-400 bg-purple-50\"\r\n                        rows={3} \r\n                        placeholder=\"Enter Panchkarma procedure details...\"\r\n                        value={panchkarmaNote} \r\n                        onChange={(e) => setPanchkarmaNote(e.target.value)} \r\n                    />\r\n                 </div>\r\n               )}\r\n               \r\n               <div className={`bg-[#f8faf9] p-4 rounded-lg border transition-all ${editingMedId !== null ? 'border-amber-300 ring-1 ring-amber-300' : 'border-gray-200'}`}>\r\n                  {editingMedId !== null && <div className=\"text-xs font-bold text-amber-600 mb-2 flex items-center gap-1\"><Edit2 size={12}/> Editing Item</div>}\r\n                  <div className=\"grid grid-cols-12 gap-3 items-end\">\r\n                      <div className={`col-span-12 ${consultationType === 'PANCHKARMA' ? 'md:col-span-8' : 'md:col-span-4'} relative`} ref={medListRef}>\r\n                         <label className=\"text-[10px] font-bold uppercase text-gray-500\">{consultationType === 'PANCHKARMA' ? 'Procedure' : 'Medicine'}</label>\r\n                         <input type=\"text\" className=\"w-full p-2 border rounded-md text-sm bg-white\" value={medQuery} onChange={(e) => { setMedQuery(e.target.value); setShowMedList(true); }} onFocus={() => setShowMedList(true)} placeholder={consultationType === 'PANCHKARMA' ? \"Search procedure...\" : \"Search medicine...\"} />\r\n                         {showMedList && (\r\n                           <div className=\"absolute top-full mt-1 left-0 w-full bg-white border rounded-md shadow-lg max-h-48 overflow-y-auto z-40\">\r\n                             {inventory.filter(i=>i.name.toLowerCase().includes(medQuery.toLowerCase())).map(item => (\r\n                               <button type=\"button\" key={item.id} onClick={() => selectMedicine(item)} className=\"w-full text-left px-3 py-2 text-sm hover:bg-green-50 text-[#1e3a29] border-b\">{item.name}</button>\r\n                             ))}\r\n                           </div>\r\n                         )}\r\n                      </div>\r\n\r\n                      {consultationType === 'REGULAR' && (\r\n                        <>\r\n                            <div className=\"col-span-6 md:col-span-2\"><label className=\"text-[10px] font-bold uppercase text-gray-500\">Dosage</label><select className=\"w-full p-2 border rounded text-sm bg-white\" value={newMed.dosage} onChange={e => setNewMed({...newMed, dosage: e.target.value})}>{DOSAGE_OPTIONS.map(opt => <option key={opt}>{opt}</option>)}</select></div>\r\n                            <div className=\"col-span-6 md:col-span-2\"><label className=\"text-[10px] font-bold uppercase text-gray-500\">Unit</label><select className=\"w-full p-2 border rounded text-sm bg-white\" value={newMed.unit} onChange={e => setNewMed({...newMed, unit: e.target.value})}>{UNIT_OPTIONS.map(opt => <option key={opt}>{opt}</option>)}</select></div>\r\n                        </>\r\n                      )}\r\n\r\n                      <div className=\"col-span-6 md:col-span-2\"><label className=\"text-[10px] font-bold uppercase text-gray-500\">Duration</label><select className=\"w-full p-2 border rounded text-sm bg-white\" value={newMed.duration} onChange={e => setNewMed({...newMed, duration: e.target.value})}>{(consultationType === 'PANCHKARMA' ? PANCHKARMA_DURATIONS : REGULAR_DURATIONS).map(opt => <option key={opt}>{opt}</option>)}</select></div>\r\n                      <div className=\"col-span-6 md:col-span-2\"><button type=\"button\" onClick={handleAddMedicine} className={`w-full h-[38px] text-white rounded flex items-center justify-center text-sm font-bold shadow-md ${editingMedId !== null ? 'bg-amber-500 hover:bg-amber-600' : 'bg-[#1e3a29] hover:bg-[#162b1e]'}`}>{editingMedId !== null ? <Save size={16} /> : <Plus size={16} />}<span className=\"ml-1\">ADD</span></button></div>\r\n                  </div>\r\n                  \r\n                  <div className=\"grid grid-cols-12 gap-3 items-end mt-2\">\r\n                      {consultationType === 'REGULAR' && (\r\n                        <div className=\"col-span-4\">\r\n                            <label className=\"text-[10px] font-bold uppercase text-gray-500 flex items-center gap-1\"><Droplets size={10}/> With</label>\r\n                            <select className=\"w-full p-2 border rounded text-sm bg-white\" value={newMed.with} onChange={e => setNewMed({...newMed, with: e.target.value})}>{WITH_OPTIONS.map(opt => <option key={opt}>{opt}</option>)}</select>\r\n                        </div>\r\n                      )}\r\n                      <div className={consultationType === 'REGULAR' ? \"col-span-8\" : \"col-span-12\"}>\r\n                         <label className=\"text-[10px] font-bold uppercase text-gray-500\">Instruction</label>\r\n                         <input list=\"instruction-options\" className=\"w-full p-2 border rounded text-sm bg-white\" value={newMed.instruction} onChange={e => setNewMed({...newMed, instruction: e.target.value})} placeholder=\"Select or type...\" />\r\n                         <datalist id=\"instruction-options\">{INSTRUCTION_OPTIONS.map(opt => <option key={opt} value={opt} />)}</datalist>\r\n                      </div>\r\n                  </div>\r\n               </div>\r\n\r\n               {currentPrescriptions.length > 0 && (\r\n                 <div className=\"mt-4 border rounded-lg overflow-hidden\">\r\n                   <table className=\"w-full text-sm text-left\">\r\n                      <thead className=\"bg-gray-100 text-xs text-gray-500 uppercase\">\r\n                         <tr><th className=\"p-2 pl-3\">Medicine/Procedure</th><th className=\"p-2\">Dosage</th><th className=\"p-2\">Details</th><th className=\"p-2 text-right\">Action</th></tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-gray-100\">\r\n                         {currentPrescriptions.map((p) => (\r\n                           <tr key={p.id} className={editingMedId === p.id ? \"bg-amber-50\" : \"\"}>\r\n                              <td className=\"p-2 pl-3\"><div className=\"font-bold text-[#1e3a29]\">{p.medicineName}</div><div className=\"text-xs text-gray-500\">{p.unit} ‚Ä¢ {p.duration}</div></td>\r\n                              <td className=\"p-2 font-mono text-xs\">{p.dosage}</td>\r\n                              <td className=\"p-2 text-xs text-gray-600\">{p.instruction}</td>\r\n                              <td className=\"p-2 text-right\"><button onClick={() => handleEditDraftMedicine(p)} className=\"text-blue-400 hover:text-blue-600 mr-2\"><Edit2 size={16}/></button><button onClick={() => removeDraftMedicine(p.id)} className=\"text-red-400 hover:text-red-600\"><Trash2 size={16}/></button></td>\r\n                           </tr>\r\n                         ))}\r\n                      </tbody>\r\n                   </table>\r\n                 </div>\r\n               )}\r\n\r\n               <div className=\"mt-6 border-t pt-4 flex justify-between items-center\">\r\n                  <div className=\"flex items-center gap-4\">\r\n                      <span className=\"text-xs font-bold text-gray-500 uppercase flex items-center gap-1\"><BadgePercent size={14}/> Consultation Charge?</span>\r\n                      <div className=\"flex gap-2 bg-gray-100 p-1 rounded\">\r\n                         <button type=\"button\" onClick={() => setIsChargeable(\"YES\")} className={`px-3 py-1 rounded text-xs font-bold transition ${isChargeable === \"YES\" ? 'bg-green-600 text-white shadow' : 'text-gray-500 hover:bg-white'}`}>Yes (‚Çπ500)</button>\r\n                         <button type=\"button\" onClick={() => setIsChargeable(\"NO\")} className={`px-3 py-1 rounded text-xs font-bold transition ${isChargeable === \"NO\" ? 'bg-blue-600 text-white shadow' : 'text-gray-500 hover:bg-white'}`}>No (Free)</button>\r\n                      </div>\r\n                  </div>\r\n\r\n                  <button type=\"button\" onClick={handleSaveVisit} className={`px-6 py-2 rounded font-bold text-sm shadow flex items-center gap-2 ${editingVisitId ? 'bg-amber-400 text-black hover:bg-amber-500' : 'bg-[#c5a059] text-[#1e3a29] hover:bg-[#b08d4b]'}`}>\r\n                     <FileText size={16} /> {editingVisitId ? \"Update Consultation\" : \"Save Consultation\"}\r\n                  </button>\r\n               </div>\r\n            </div>\r\n            \r\n            {/* Visit History */}\r\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n               <h3 className=\"font-bold text-[#1e3a29] flex items-center gap-2 mb-6\"><Calendar className=\"text-[#c5a059]\" /> History</h3>\r\n               <div className=\"space-y-6\">\r\n                  {visitHistory.length === 0 ? <p className=\"text-gray-400 text-sm italic\">No history found.</p> : visitHistory.map((visit) => (\r\n                    <div key={visit.id} className=\"relative pl-6 border-l-2 border-[#c5a059]/30 pb-6 last:pb-0\">\r\n                       <div className=\"absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-[#c5a059] border-2 border-white shadow-sm\"></div>\r\n                       <div className=\"flex justify-between items-start mb-2\">\r\n                          <div>\r\n                            <span className=\"text-xs font-bold text-[#c5a059] uppercase\">{new Date(visit.date).toLocaleDateString()}</span>\r\n                            <p className=\"font-bold text-sm mt-1\">{visit.diagnosis || \"No Diagnosis\"}</p>\r\n                            \r\n                            <div className=\"flex gap-2 mt-1 text-[10px]\">\r\n                                {visit.appointmentDiscount >= 500 ? <span className=\"bg-blue-50 text-blue-600 px-1 rounded\">Consult: Free</span> : <span className=\"bg-green-50 text-green-700 px-1 rounded\">Consult: Paid</span>}\r\n                                {visit.paidAmount > 0 && <span className=\"bg-gray-100 text-gray-600 px-1 rounded\">Paid: ‚Çπ{visit.paidAmount}</span>}\r\n                            </div>\r\n\r\n                            <div className=\"mt-2 flex items-center gap-3\">\r\n                                {visit.reportUrl ? <a href={visit.reportUrl} target=\"_blank\" className=\"text-xs bg-green-50 text-green-700 px-2 py-1 rounded flex items-center gap-1 font-bold\"><Eye size={12} /> View Report</a> : <label className={`text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded flex items-center gap-1 font-bold cursor-pointer ${uploadingId === visit.id ? 'opacity-50' : ''}`}>{uploadingId === visit.id ? <Loader2 size={12} className=\"animate-spin\"/> : <FileUp size={12}/>} Upload<input type=\"file\" className=\"hidden\" onChange={(e) => handleFileUpload(e, visit.id)} /></label>}\r\n                                <button onClick={() => handlePrintReceipt(visit)} className=\"text-xs bg-yellow-50 text-yellow-700 px-2 py-1 rounded flex items-center gap-1 font-bold\"><Printer size={12} /> Receipt</button>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex gap-2\">\r\n                             <button onClick={() => handleEditHistory(visit)} className=\"text-blue-500 bg-blue-50 p-1 rounded\"><Edit2 size={14}/></button>\r\n                             <button onClick={() => handleDeleteHistory(visit.id)} className=\"text-red-500 bg-red-50 p-1 rounded\"><Trash2 size={14}/></button>\r\n                          </div>\r\n                       </div>\r\n                       {visit.prescriptions?.map((p:any, i:number) => (\r\n                         <div key={i} className=\"flex justify-between text-xs text-gray-600 py-1 border-b last:border-0 border-gray-100\">\r\n                           <span>{p.medicineName}</span>\r\n                           <span>{p.dosage}</span>\r\n                         </div>\r\n                       ))}\r\n                    </div>\r\n                  ))}\r\n               </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ‚úÖ WALLET UPDATE MODAL */}\r\n        {showWalletModal && (\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n                <div className=\"bg-white rounded-xl shadow-xl w-full max-w-sm p-6 animate-in zoom-in-95\">\r\n                    <h3 className=\"text-lg font-bold text-[#1e3a29] mb-4 flex items-center gap-2\"><Wallet/> Manage Wallet</h3>\r\n                    <p className=\"text-sm text-gray-500 mb-4\">Managing balance for <span className=\"font-bold text-black\">{patient.name}</span></p>\r\n                    \r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Transaction Type</label>\r\n                            <select \r\n                                className=\"w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-[#c5a059]\"\r\n                                value={walletType}\r\n                                onChange={(e) => setWalletType(e.target.value as \"CREDIT\" | \"DUE\")}\r\n                            >\r\n                                <option value=\"CREDIT\">Credit (Deposit / Advance)</option>\r\n                                <option value=\"DUE\">Due (Charge / Debt)</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Amount (‚Çπ)</label>\r\n                            <input \r\n                                type=\"number\" \r\n                                autoFocus\r\n                                placeholder=\"Enter Amount\" \r\n                                className=\"w-full p-3 border rounded-lg text-lg font-bold outline-none focus:ring-2 focus:ring-[#c5a059]\"\r\n                                value={walletAmount}\r\n                                onChange={(e) => setWalletAmount(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex gap-3 mt-6\">\r\n                        <button onClick={() => setShowWalletModal(false)} className=\"flex-1 py-2 text-gray-600 font-bold bg-gray-100 rounded-lg hover:bg-gray-200\">Cancel</button>\r\n                        <button \r\n                            onClick={handleWalletUpdate} \r\n                            className={`flex-1 py-2 text-white font-bold rounded-lg transition ${walletType === 'CREDIT' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}\r\n                        >\r\n                            {walletType === 'CREDIT' ? 'Add Credit' : 'Add Due'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )}\r\n\r\n      </main>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\patients\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3107,3110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3107,3110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":140,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":140,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4181,4184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4181,4184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5332,5335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5332,5335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":299,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10542,10545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10542,10545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":331,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":331,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":335,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11642,11645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11642,11645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":352,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":352,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":356,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12709,12712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12709,12712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":372,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":372,"endColumn":17}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\";\r\n\r\nimport { prisma as db } from \"@/lib/prisma\";\r\nimport { revalidatePath } from \"next/cache\";\r\nimport { createClient } from \"@supabase/supabase-js\"; \r\n\r\n// üõ†Ô∏è HELPER: ID GENERATOR\r\nasync function generateReadableId(type: 'patient' | 'opd' | 'ipd') {\r\n  const counterName = type === 'patient' ? 'patient' : (type === 'opd' ? 'appointment_opd' : 'appointment_ipd');\r\n  const prefix = type === 'patient' ? 'RA-' : (type === 'opd' ? 'RAOPD' : 'RAIPD');\r\n  \r\n  try {\r\n    const counter = await db.counter.upsert({\r\n      where: { name: counterName },\r\n      update: { value: { increment: 1 } },\r\n      create: { name: counterName, value: 663 } \r\n    });\r\n    return `${prefix}${counter.value.toString().padStart(4, '0')}`;\r\n  } catch (error) {\r\n    console.error(\"ID Gen Error:\", error);\r\n    return `${prefix}${Date.now().toString().slice(-4)}`;\r\n  }\r\n}\r\n\r\n// 1. Fetch Patient Details & Consultations\r\nexport async function getPatientData(patientId: string) {\r\n  try {\r\n    const patient = await db.patient.findUnique({\r\n      where: { id: patientId },\r\n      include: {\r\n        consultations: {\r\n          orderBy: { createdAt: 'desc' },\r\n          include: {\r\n            appointment: true,\r\n            prescriptions: {\r\n              include: {\r\n                items: {\r\n                  include: { medicine: true } \r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n    return patient;\r\n  } catch (error) {\r\n    console.error(\"Error fetching patient:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// 2. Search Patients (Updated to include Today's Appointment)\r\nexport async function searchPatients(query: string) {\r\n  if (!query) return [];\r\n  \r\n  // ‚úÖ FIX: Use IST Date to ensure we get the correct \"Today\"\r\n  const now = new Date();\r\n  const istOffset = 5.5 * 60 * 60 * 1000;\r\n  const istDate = new Date(now.getTime() + istOffset);\r\n  const today = istDate.toISOString().split('T')[0];\r\n\r\n  const patients = await db.patient.findMany({\r\n    where: {\r\n      OR: [\r\n        { name: { contains: query, mode: 'insensitive' } },\r\n        { phone: { contains: query } },\r\n        { readableId: { contains: query, mode: 'insensitive' } }\r\n      ]\r\n    },\r\n    take: 5,\r\n    select: { \r\n        id: true, \r\n        name: true, \r\n        phone: true, \r\n        readableId: true, \r\n        walletBalance: true,\r\n        // ‚úÖ Fetch active appointment for today\r\n        appointments: {\r\n            where: {\r\n                date: today,\r\n                status: \"SCHEDULED\"\r\n            },\r\n            select: {\r\n                readableId: true\r\n            }\r\n        }\r\n    } \r\n  });\r\n  \r\n  return patients;\r\n}\r\n\r\n// 3. Get Medicine Inventory\r\nexport async function getPharmacyInventory() {\r\n  const medicines = await db.medicine.findMany({\r\n    where: { stock: { gt: 0 } },\r\n    orderBy: { name: 'asc' },\r\n    select: { id: true, name: true, stock: true, type: true, price: true } \r\n  });\r\n  return medicines;\r\n}\r\n\r\n// ‚úÖ NEW: Main Get Patients List (Updated for Table View)\r\nexport async function getPatients(query?: string) {\r\n  try {\r\n    const where: any = {};\r\n    if (query) {\r\n      where.OR = [\r\n        { name: { contains: query, mode: 'insensitive' } },\r\n        { phone: { contains: query } },\r\n        { readableId: { contains: query, mode: 'insensitive' } }\r\n      ];\r\n    }\r\n\r\n    // ‚úÖ FIX: Use IST Date\r\n    const now = new Date();\r\n    const istOffset = 5.5 * 60 * 60 * 1000;\r\n    const istDate = new Date(now.getTime() + istOffset);\r\n    const today = istDate.toISOString().split('T')[0];\r\n\r\n    return await db.patient.findMany({ \r\n        where, \r\n        orderBy: { updatedAt: 'desc' }, \r\n        take: 50,\r\n        include: {\r\n            // ‚úÖ Include Today's Scheduled Appointment\r\n            appointments: {\r\n                where: {\r\n                    date: today,\r\n                    status: \"SCHEDULED\"\r\n                },\r\n                select: {\r\n                    readableId: true\r\n                },\r\n                take: 1\r\n            }\r\n        }\r\n    });\r\n  } catch (error) { return []; }\r\n}\r\n\r\n// 4. Update Patient Details\r\nexport async function updatePatientDetails(id: string, data: any) {\r\n  try {\r\n    await db.patient.update({\r\n      where: { id },\r\n      data: {\r\n        name: data.name,\r\n        age: parseInt(data.age) || undefined, \r\n        gender: data.gender,\r\n        phone: data.phone,\r\n        bloodGroup: data.bloodGroup,\r\n        prakriti: data.prakriti,\r\n        initialWeight: data.initialWeight,\r\n        currentWeight: data.currentWeight,\r\n        history: data.history, \r\n        chiefComplaints: data.chiefComplaints,\r\n        kco: data.kco,\r\n        currentMedications: data.currentMedications,\r\n        investigations: data.investigations,\r\n        pastHistory: data.pastHistory,\r\n        familyHistory: data.familyHistory,\r\n        mentalGenerals: data.mentalGenerals,\r\n        obsGynHistory: data.obsGynHistory,\r\n        physicalGenerals: data.physicalGenerals\r\n      }\r\n    });\r\n    \r\n    revalidatePath(`/patients/${id}`);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Update Error:\", error);\r\n    return { success: false, error: \"Failed to update patient\" };\r\n  }\r\n}\r\n\r\n// 5. SAVE CONSULTATION & PRESCRIPTION\r\nexport async function savePrescription(patientId: string, visitData: any, consultationId?: string) {\r\n  try {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    let finalAppointmentId = visitData.appointmentId;\r\n\r\n    // ‚úÖ FIX: Resolve Readable ID (e.g., RAOPD1201) to UUID\r\n    // This prevents the P2025 error when the URL passes a string ID\r\n    if (finalAppointmentId && typeof finalAppointmentId === 'string' && finalAppointmentId.startsWith('RA')) {\r\n        const appointmentObj = await db.appointment.findUnique({ \r\n            where: { readableId: finalAppointmentId } \r\n        });\r\n        // If found, use the UUID. If not, set to null so the code creates a new one below.\r\n        finalAppointmentId = appointmentObj ? appointmentObj.id : null;\r\n    }\r\n\r\n    // A. Handle Guest\r\n    if (patientId === \"GUEST\") {\r\n        let guest = await db.patient.findFirst({ where: { phone: \"9999999999\" } });\r\n        if (!guest) {\r\n            guest = await db.patient.create({\r\n                data: { readableId: \"GUEST\", name: \"Guest Patient\", phone: \"9999999999\", age: 0, gender: \"Unknown\", walletBalance: 0 }\r\n            });\r\n        }\r\n        patientId = guest.id;\r\n    }\r\n\r\n    // B. Ensure Appointment Exists (For Fee Status)\r\n    if (!finalAppointmentId) {\r\n        const existing = await db.appointment.findFirst({ where: { patientId, date: today, status: \"SCHEDULED\" } });\r\n        if (existing) finalAppointmentId = existing.id;\r\n    }\r\n\r\n    // If still no appointment (Ad-hoc visit), create \"Walk-in\"\r\n    if (!finalAppointmentId && visitData.doctorName !== \"Pharmacy Direct Sale\") {\r\n        const p = await db.patient.findUnique({ where: { id: patientId } });\r\n        const readableId = await generateReadableId('opd');\r\n        const newAppt = await db.appointment.create({\r\n            data: {\r\n                readableId,\r\n                date: today,\r\n                startTime: new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' }),\r\n                endTime: new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' }),\r\n                type: \"Walk-in\",\r\n                patientName: p?.name || \"Unknown\",\r\n                phone: p?.phone || \"\",\r\n                doctor: visitData.doctorName || \"Dr. Chirag Raval\",\r\n                status: \"COMPLETED\",\r\n                patientId: patientId,\r\n                fee: 500,\r\n                discount: 0\r\n            }\r\n        });\r\n        finalAppointmentId = newAppt.id;\r\n    }\r\n\r\n    const apptDiscount = Number(visitData.appointmentDiscount ?? 0); \r\n    const pharmacyDiscount = Number(visitData.discount ?? 0); \r\n    const paidAmount = Number(visitData.paidAmount ?? 0);\r\n    const paymentMode = visitData.paymentMode || \"Cash\";\r\n\r\n    // ‚ùå REMOVED: Auto-calculation of wallet delta. \r\n    // The wallet will NOT be updated automatically based on this transaction.\r\n\r\n    // D. Database Operations (Transaction)\r\n    await db.$transaction(async (tx) => {\r\n        \r\n        // 1. Update Appointment Fee Status (Only if we have a valid ID)\r\n        if (finalAppointmentId) {\r\n            const aptExists = await tx.appointment.findUnique({ where: { id: finalAppointmentId } });\r\n            if (aptExists) {\r\n                await tx.appointment.update({\r\n                    where: { id: finalAppointmentId },\r\n                    data: { status: \"COMPLETED\", discount: apptDiscount }\r\n                });\r\n            }\r\n        }\r\n\r\n        // 2. Create/Update Consultation\r\n        let consultId = consultationId;\r\n        \r\n        if (consultId) {\r\n            // Edit Mode\r\n            await tx.prescriptionItem.deleteMany({ where: { prescription: { consultationId: consultId } } });\r\n            await tx.consultation.update({\r\n                where: { id: consultId },\r\n                data: {\r\n                    diagnosis: visitData.diagnosis,\r\n                    notes: visitData.notes,\r\n                    discount: pharmacyDiscount,\r\n                    paidAmount: paidAmount,\r\n                    paymentMode: paymentMode\r\n                }\r\n            });\r\n        } else {\r\n            // New Mode\r\n            const newConsult = await tx.consultation.create({\r\n                data: {\r\n                    patientId,\r\n                    doctorName: \"Dr. Chirag Raval\",\r\n                    symptoms: visitData.diagnosis,\r\n                    diagnosis: visitData.diagnosis,\r\n                    notes: visitData.notes,\r\n                    discount: pharmacyDiscount,\r\n                    appointmentId: finalAppointmentId,\r\n                    paidAmount: paidAmount,\r\n                    paymentMode: paymentMode,\r\n                    createdAt: new Date()\r\n                }\r\n            });\r\n            consultId = newConsult.id;\r\n        }\r\n\r\n        // 3. Create Prescription Items\r\n        let prescription = await tx.prescription.findFirst({ where: { consultationId: consultId } });\r\n        if (!prescription) {\r\n            prescription = await tx.prescription.create({ data: { consultationId: consultId! } });\r\n        }\r\n\r\n        if (visitData.prescriptions.length > 0) {\r\n            await tx.prescriptionItem.createMany({\r\n                data: visitData.prescriptions.map((p: any) => ({\r\n                    prescriptionId: prescription!.id,\r\n                    medicineId: p.medicineId,\r\n                    dosage: p.dosage,\r\n                    unit: p.unit,\r\n                    duration: p.duration,\r\n                    instruction: p.instruction,\r\n                    panchkarma: p.panchkarma,\r\n                    status: \"PENDING\"\r\n                }))\r\n            });\r\n        }\r\n\r\n        // ‚ùå REMOVED: The logic that updated tx.patient walletBalance is gone.\r\n    });\r\n\r\n    revalidatePath(`/patients/${patientId}`);\r\n    revalidatePath(`/pharmacy`);\r\n    return { success: true };\r\n\r\n  } catch (error) {\r\n    console.error(\"Save Error:\", error);\r\n    return { success: false, error: \"Failed to save visit\" };\r\n  }\r\n}\r\n\r\n// 6. Delete Patient\r\nexport async function deletePatient(id: string) {\r\n  try {\r\n    await db.patient.delete({ where: { id } });\r\n    revalidatePath('/patients');\r\n    return { success: true };\r\n  } catch (error) { return { success: false, error: \"Failed to delete\" }; }\r\n}\r\n\r\n// 7. Create Patient\r\nexport async function createPatient(data: any) {\r\n  try {\r\n    const readableId = await generateReadableId('patient');\r\n    const newPatient = await db.patient.create({\r\n      data: {\r\n        readableId,\r\n        name: data.name, phone: data.phone, age: parseInt(data.age) || 0,\r\n        gender: data.gender, bloodGroup: data.bloodGroup, prakriti: data.prakriti,\r\n        initialWeight: data.initialWeight, currentWeight: data.currentWeight, history: data.history,\r\n        chiefComplaints: data.chiefComplaints, kco: data.kco, currentMedications: data.currentMedications,\r\n        investigations: data.investigations, pastHistory: data.pastHistory, familyHistory: data.familyHistory,\r\n        mentalGenerals: data.mentalGenerals, obsGynHistory: data.obsGynHistory, physicalGenerals: data.physicalGenerals,\r\n        walletBalance: 0.0 \r\n      }\r\n    });\r\n    revalidatePath('/patients');\r\n    return { success: true, patient: newPatient }; \r\n  } catch (error) { return { success: false, error: \"Failed to create patient\" }; }\r\n}\r\n\r\n// 8. Update Patient\r\nexport async function updatePatient(id: string, data: any) {\r\n  try {\r\n    const ageVal = isNaN(parseInt(data.age)) ? undefined : parseInt(data.age);\r\n    await db.patient.update({\r\n      where: { id },\r\n      data: {\r\n        name: data.name, age: ageVal, gender: data.gender, phone: data.phone,\r\n        bloodGroup: data.bloodGroup, prakriti: data.prakriti,\r\n        initialWeight: data.initialWeight, currentWeight: data.currentWeight, history: data.history,\r\n        chiefComplaints: data.chiefComplaints, kco: data.kco, currentMedications: data.currentMedications,\r\n        investigations: data.investigations, pastHistory: data.pastHistory, familyHistory: data.familyHistory,\r\n        mentalGenerals: data.mentalGenerals, obsGynHistory: data.obsGynHistory, physicalGenerals: data.physicalGenerals\r\n      }\r\n    });\r\n    revalidatePath(`/patients/${id}`); revalidatePath('/patients');\r\n    return { success: true };\r\n  } catch (error) { return { success: false, error: \"Update failed\" }; }\r\n}\r\n\r\n// 9. Delete Consultation\r\nexport async function deleteVisit(consultationId: string, patientId: string) {\r\n  try {\r\n    await db.consultation.delete({ where: { id: consultationId } });\r\n    revalidatePath(`/patients/${patientId}`);\r\n  } catch (error) {\r\n    console.error(\"Delete Error:\", error);\r\n  }\r\n}\r\n\r\n// 10. Upload Report Action\r\nexport async function uploadConsultationReport(formData: FormData) {\r\n  try {\r\n    const file = formData.get(\"file\") as File;\r\n    const consultationId = formData.get(\"consultationId\") as string;\r\n\r\n    if (!file || !consultationId) return { success: false, error: \"Missing file\" };\r\n\r\n    const supabase = createClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    );\r\n\r\n    const fileExt = file.name.split('.').pop();\r\n    const fileName = `${consultationId}_${Date.now()}.${fileExt}`;\r\n    const filePath = `${fileName}`; \r\n\r\n    const { error: uploadError } = await supabase.storage\r\n      .from(\"medical-reports\")\r\n      .upload(filePath, file);\r\n\r\n    if (uploadError) throw uploadError;\r\n\r\n    const { data } = supabase.storage\r\n      .from(\"medical-reports\")\r\n      .getPublicUrl(filePath);\r\n\r\n    await db.consultation.update({\r\n      where: { id: consultationId },\r\n      data: { reportUrl: data.publicUrl }\r\n    });\r\n\r\n    const consultation = await db.consultation.findUnique({\r\n        where: { id: consultationId },\r\n        select: { patientId: true }\r\n    });\r\n\r\n    if (consultation) {\r\n        revalidatePath(`/patients/${consultation.patientId}`);\r\n    }\r\n    \r\n    return { success: true, url: data.publicUrl };\r\n\r\n  } catch (error) {\r\n    console.error(\"Upload Action Error:\", error);\r\n    return { success: false, error: \"Upload failed\" };\r\n  }\r\n}\r\n\r\n// ‚úÖ Update Patient Wallet (This is now the ONLY way to update wallet)\r\nexport async function updatePatientWallet(patientId: string, amount: number, type: 'CREDIT' | 'DUE') {\r\n  try {\r\n    const numericAmount = parseFloat(amount.toString());\r\n    if (isNaN(numericAmount) || numericAmount <= 0) return { success: false, error: \"Invalid amount\" };\r\n\r\n    const adjustment = type === 'CREDIT' ? numericAmount : -numericAmount;\r\n\r\n    await db.patient.update({\r\n      where: { id: patientId },\r\n      data: { walletBalance: { increment: adjustment } }\r\n    });\r\n\r\n    revalidatePath('/patients');\r\n    revalidatePath(`/patients/${patientId}`);\r\n    \r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Wallet Update Error:\", error);\r\n    return { success: false, error: \"Failed to update wallet\" };\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\patients\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[842,845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[842,845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1140,1143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1140,1143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1374,1377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1374,1377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2524,2527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2524,2527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4159,4162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4159,4162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5148,5151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5148,5151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport StaffHeader from \"@/app/components/StaffHeader\";\r\nimport { \r\n  Users, Search, Plus, Edit2, Trash2, \r\n  ChevronRight, Loader2, X, Filter, ChevronDown, ChevronUp, Wallet \r\n} from \"lucide-react\";\r\nimport { getPatients, createPatient, updatePatient, deletePatient, updatePatientWallet } from \"@/app/actions\";\r\n\r\n// Template for Physical Generals\r\nconst PHYSICAL_GENERALS_TEMPLATE = `Appetite : \r\nThirst : \r\nCraving : \r\nAversion : \r\nTaste : Sweet [ ], Spicy [ ], Sour [ ], Salty [ ]\r\nThermal : \r\nPerspiration : \r\nBowels : \r\nUrine : \r\nSleep : \r\nDreams : \r\nFears : `;\r\n\r\nexport default function PatientManager() {\r\n  const router = useRouter();\r\n  const [patients, setPatients] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [saving, setSaving] = useState(false);\r\n  \r\n  // Patient Modal State\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [editingPatient, setEditingPatient] = useState<any>(null);\r\n  const [showExtendedForm, setShowExtendedForm] = useState(false); \r\n  \r\n  // Wallet Modal State\r\n  const [isWalletModalOpen, setIsWalletModalOpen] = useState(false);\r\n  const [walletPatient, setWalletPatient] = useState<any>(null);\r\n  const [walletAmount, setWalletAmount] = useState(\"\");\r\n  const [walletType, setWalletType] = useState<\"CREDIT\" | \"DUE\">(\"CREDIT\");\r\n\r\n  // Form State\r\n  const [formData, setFormData] = useState({\r\n    name: \"\", phone: \"\", age: \"\", gender: \"Male\",\r\n    bloodGroup: \"\", prakriti: \"\", \r\n    initialWeight: \"\", currentWeight: \"\", history: \"\",\r\n    chiefComplaints: \"\", kco: \"\", currentMedications: \"\", investigations: \"\",\r\n    pastHistory: \"\", familyHistory: \"\", mentalGenerals: \"\", obsGynHistory: \"\",\r\n    physicalGenerals: PHYSICAL_GENERALS_TEMPLATE\r\n  });\r\n\r\n  // --- Load Data ---\r\n  const loadPatients = useCallback(async (query: string) => {\r\n    setLoading(true);\r\n    try {\r\n      const data = await getPatients(query);\r\n      setPatients(data);\r\n    } catch (e) {\r\n      console.error(\"Failed to load patients\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const delayDebounce = setTimeout(() => {\r\n      loadPatients(search);\r\n    }, 300);\r\n    return () => clearTimeout(delayDebounce);\r\n  }, [search, loadPatients]);\r\n\r\n  // --- Handlers ---\r\n  const handleOpenModal = (patient?: any) => {\r\n    if (patient) {\r\n      setEditingPatient(patient);\r\n      setFormData({\r\n        name: patient.name,\r\n        phone: patient.phone,\r\n        age: patient.age?.toString() || \"\",\r\n        gender: patient.gender || \"Male\",\r\n        bloodGroup: patient.bloodGroup || \"\",\r\n        prakriti: patient.prakriti || \"\",\r\n        initialWeight: patient.initialWeight || \"\",\r\n        currentWeight: patient.currentWeight || \"\",\r\n        history: patient.history || \"\",\r\n        chiefComplaints: patient.chiefComplaints || \"\",\r\n        kco: patient.kco || \"\",\r\n        currentMedications: patient.currentMedications || \"\",\r\n        investigations: patient.investigations || \"\",\r\n        pastHistory: patient.pastHistory || \"\",\r\n        familyHistory: patient.familyHistory || \"\",\r\n        mentalGenerals: patient.mentalGenerals || \"\",\r\n        obsGynHistory: patient.obsGynHistory || \"\",\r\n        physicalGenerals: patient.physicalGenerals || PHYSICAL_GENERALS_TEMPLATE\r\n      });\r\n    } else {\r\n      setEditingPatient(null);\r\n      setFormData({\r\n        name: \"\", phone: \"\", age: \"\", gender: \"Male\",\r\n        bloodGroup: \"\", prakriti: \"\", \r\n        initialWeight: \"\", currentWeight: \"\", history: \"\",\r\n        chiefComplaints: \"\", kco: \"\", currentMedications: \"\", investigations: \"\",\r\n        pastHistory: \"\", familyHistory: \"\", mentalGenerals: \"\", obsGynHistory: \"\",\r\n        physicalGenerals: PHYSICAL_GENERALS_TEMPLATE\r\n      });\r\n    }\r\n    setShowExtendedForm(false); \r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSaving(true);\r\n    \r\n    let res: any;\r\n    \r\n    const cleanData = {\r\n        ...formData,\r\n        age: formData.age ? parseInt(formData.age) : 0,\r\n        initialWeight: formData.initialWeight || null,\r\n        currentWeight: formData.currentWeight || null\r\n    };\r\n\r\n    if (editingPatient) {\r\n      res = await updatePatient(editingPatient.id, cleanData);\r\n    } else {\r\n      res = await createPatient(cleanData);\r\n    }\r\n\r\n    setSaving(false);\r\n\r\n    if (res.success) {\r\n      setIsModalOpen(false);\r\n      if (!editingPatient && res.patient?.id) {\r\n          router.push(`/patients/${res.patient.id}`);\r\n      } else {\r\n          loadPatients(search); \r\n      }\r\n    } else {\r\n      alert(res.error || \"Operation failed\");\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (confirm(\"Are you sure? This will delete all history for this patient.\")) {\r\n      await deletePatient(id);\r\n      loadPatients(search);\r\n    }\r\n  };\r\n\r\n  // --- Wallet Handlers ---\r\n  const handleOpenWallet = (patient: any) => {\r\n      setWalletPatient(patient);\r\n      setWalletAmount(\"\");\r\n      setWalletType(\"CREDIT\");\r\n      setIsWalletModalOpen(true);\r\n  };\r\n\r\n  const handleWalletUpdate = async () => {\r\n      if (!walletAmount || parseFloat(walletAmount) <= 0) return alert(\"Enter valid amount\");\r\n      \r\n      const res = await updatePatientWallet(walletPatient.id, parseFloat(walletAmount), walletType);\r\n      \r\n      if (res.success) {\r\n          setIsWalletModalOpen(false);\r\n          loadPatients(search); // Refresh list\r\n      } else {\r\n          alert(\"Failed to update wallet\");\r\n      }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[#FDFBF7] font-sans text-neutral-800\">\r\n      <StaffHeader />\r\n\r\n      <main className=\"max-w-7xl mx-auto p-6 md:p-10\">\r\n        \r\n        {/* --- Header --- */}\r\n        <div className=\"flex flex-col md:flex-row justify-between items-center mb-8 gap-4\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-serif font-bold text-[#1e3a29] flex items-center gap-3\">\r\n              <Users className=\"text-[#c5a059]\" /> Patient Management\r\n            </h1>\r\n            <p className=\"text-gray-500 text-sm mt-1\">Manage profiles, history, and vitals.</p>\r\n          </div>\r\n          \r\n          <button \r\n            onClick={() => handleOpenModal()}\r\n            className=\"bg-[#1e3a29] text-white px-6 py-2.5 rounded-lg font-bold shadow-lg hover:bg-[#162b1e] transition flex items-center gap-2\"\r\n          >\r\n            <Plus size={18} /> Add New Patient\r\n          </button>\r\n        </div>\r\n\r\n        {/* --- Search & Filters --- */}\r\n        <div className=\"bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6 flex gap-4\">\r\n           <div className=\"relative flex-1\">\r\n             <Search className=\"absolute left-3 top-3 text-gray-400\" size={18} />\r\n             <input \r\n               type=\"text\" \r\n               placeholder=\"Search by Name, Phone or ID...\" \r\n               className=\"w-full pl-10 p-2.5 border rounded-lg text-sm focus:outline-none focus:border-[#c5a059]\"\r\n               value={search}\r\n               onChange={(e) => setSearch(e.target.value)}\r\n             />\r\n           </div>\r\n           <button className=\"p-2.5 border rounded-lg hover:bg-gray-50 text-gray-600\">\r\n             <Filter size={18} />\r\n           </button>\r\n        </div>\r\n\r\n        {/* --- Patient Table --- */}\r\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm text-left\">\r\n              <thead className=\"bg-[#1e3a29] text-white uppercase text-xs\">\r\n                <tr>\r\n                  <th className=\"p-4\">ID</th>\r\n                  <th className=\"p-4\">Name / Phone</th>\r\n                  <th className=\"p-4\">Details</th>\r\n                  <th className=\"p-4\">Prakriti</th>\r\n                  <th className=\"p-4\">Weight (Cur/Init)</th>\r\n                  <th className=\"p-4 text-center\">Wallet</th>\r\n                  <th className=\"p-4 text-right\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-100\">\r\n                {loading ? (\r\n                  <tr><td colSpan={7} className=\"p-8 text-center\"><Loader2 className=\"animate-spin inline text-[#c5a059]\"/></td></tr>\r\n                ) : patients.length === 0 ? (\r\n                  <tr><td colSpan={7} className=\"p-8 text-center text-gray-400\">No patients found.</td></tr>\r\n                ) : (\r\n                  patients.map((p) => {\r\n                    // ‚úÖ CHECK FOR APPOINTMENT\r\n                    // If appointment exists, link to it. Else generic profile.\r\n                    const activeApptId = p.appointments && p.appointments.length > 0 ? p.appointments[0].readableId : null;\r\n                    const profileLink = activeApptId \r\n                        ? `/patients/${p.id}?appointmentId=${activeApptId}` \r\n                        : `/patients/${p.id}`;\r\n\r\n                    return (\r\n                    <tr key={p.id} className=\"hover:bg-gray-50 group transition\">\r\n                      <td className=\"p-4 font-mono font-bold text-[#c5a059]\">{p.readableId || \"N/A\"}</td>\r\n                      \r\n                      <td className=\"p-4\">\r\n                        <div className=\"font-bold text-[#1e3a29]\">{p.name}</div>\r\n                        <div className=\"text-xs text-gray-500\">{p.phone}</div>\r\n                      </td>\r\n                      \r\n                      <td className=\"p-4 text-gray-600\">\r\n                        {p.age} Y / {p.gender} / {p.bloodGroup || \"-\"}\r\n                      </td>\r\n                      \r\n                      <td className=\"p-4 font-medium text-purple-700\">\r\n                        {p.prakriti || <span className=\"text-gray-300\">-</span>}\r\n                      </td>\r\n                      \r\n                      <td className=\"p-4\">\r\n                        {p.currentWeight ? (\r\n                          <span className=\"font-bold text-green-700\">{p.currentWeight} <span className=\"text-gray-400 font-normal text-xs\">/ {p.initialWeight}</span></span>\r\n                        ) : \"-\"}\r\n                      </td>\r\n\r\n                      {/* Wallet Column */}\r\n                      <td className=\"p-4 text-center\">\r\n                          {p.walletBalance !== undefined && p.walletBalance !== 0 ? (\r\n                              <span className={`px-2 py-1 rounded text-xs font-bold ${p.walletBalance < 0 ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`}>\r\n                                  {p.walletBalance < 0 ? `Due: ‚Çπ${Math.abs(p.walletBalance)}` : `Credit: ‚Çπ${p.walletBalance}`}\r\n                              </span>\r\n                          ) : (\r\n                              <span className=\"text-gray-300 text-xs\">‚Çπ0</span>\r\n                          )}\r\n                      </td>\r\n                      \r\n                      <td className=\"p-4 text-right flex justify-end gap-2\">\r\n                        {/* Wallet Action Button */}\r\n                        <button onClick={() => handleOpenWallet(p)} className=\"p-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100\" title=\"Manage Wallet\">\r\n                            <Wallet size={16}/>\r\n                        </button>\r\n\r\n                        {/* ‚úÖ View Profile Button with Logic */}\r\n                        <Link href={profileLink} className={`p-2 rounded-lg hover:bg-blue-100 ${activeApptId ? 'bg-blue-100 text-blue-700 font-bold border border-blue-300' : 'bg-blue-50 text-blue-600'}`} title=\"View Profile\">\r\n                          <ChevronRight size={16} />\r\n                        </Link>\r\n\r\n                        <button onClick={() => handleOpenModal(p)} className=\"p-2 bg-amber-50 text-amber-600 rounded-lg hover:bg-amber-100\" title=\"Edit\">\r\n                          <Edit2 size={16} />\r\n                        </button>\r\n                        <button onClick={() => handleDelete(p.id)} className=\"p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100\" title=\"Delete\">\r\n                          <Trash2 size={16} />\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  )})\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n\r\n      </main>\r\n\r\n      {/* --- ADD / EDIT MODAL --- */}\r\n      {isModalOpen && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n          <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col animate-in zoom-in duration-200\">\r\n            <div className=\"bg-[#1e3a29] p-4 flex justify-between items-center text-white shrink-0\">\r\n              <h3 className=\"font-bold text-lg flex items-center gap-2\">\r\n                {editingPatient ? <Edit2 size={18}/> : <Plus size={18}/>} \r\n                {editingPatient ? \"Edit Patient Details\" : \"Register New Patient\"}\r\n              </h3>\r\n              <button onClick={() => setIsModalOpen(false)} className=\"hover:text-[#c5a059]\"><X size={20}/></button>\r\n            </div>\r\n            \r\n            <form onSubmit={handleSubmit} className=\"p-6 space-y-4 overflow-y-auto flex-1\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Full Name *</label>\r\n                  <input required className=\"w-full p-2 border rounded focus:border-[#c5a059] outline-none\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Phone *</label>\r\n                  <input required className=\"w-full p-2 border rounded focus:border-[#c5a059] outline-none\" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} />\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Age</label>\r\n                    <input type=\"number\" className=\"w-full p-2 border rounded focus:border-[#c5a059] outline-none\" value={formData.age} onChange={e => setFormData({...formData, age: e.target.value})} />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Gender</label>\r\n                    <select className=\"w-full p-2 border rounded bg-white\" value={formData.gender} onChange={e => setFormData({...formData, gender: e.target.value})}>\r\n                      <option>Male</option><option>Female</option><option>Other</option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Blood Group</label>\r\n                  <select className=\"w-full p-2 border rounded bg-white\" value={formData.bloodGroup} onChange={e => setFormData({...formData, bloodGroup: e.target.value})}>\r\n                    <option value=\"\">Select...</option>\r\n                    <option>A+</option><option>A-</option><option>B+</option><option>B-</option>\r\n                    <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>\r\n                  </select>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-bold uppercase text-purple-600 mb-1\">Prakriti (Dosha)</label>\r\n                  <input placeholder=\"e.g. Vata-Pitta\" className=\"w-full p-2 border rounded focus:border-purple-500 outline-none\" value={formData.prakriti} onChange={e => setFormData({...formData, prakriti: e.target.value})} />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Initial Weight</label>\r\n                    <input placeholder=\"e.g. 70 kg\" className=\"w-full p-2 border rounded focus:border-[#c5a059] outline-none\" value={formData.initialWeight} onChange={e => setFormData({...formData, initialWeight: e.target.value})} />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-xs font-bold uppercase text-green-600 mb-1\">Current Weight</label>\r\n                    <input placeholder=\"e.g. 68 kg\" className=\"w-full p-2 border rounded border-green-200 bg-green-50 focus:border-green-500 outline-none\" value={formData.currentWeight} onChange={e => setFormData({...formData, currentWeight: e.target.value})} />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Basic History / Allergies</label>\r\n                <textarea rows={2} className=\"w-full p-2 border rounded bg-gray-50 focus:bg-white focus:border-[#c5a059] outline-none\" value={formData.history} onChange={e => setFormData({...formData, history: e.target.value})} />\r\n              </div>\r\n\r\n              <div className=\"border-t pt-4\">\r\n                 <button \r\n                    type=\"button\" \r\n                    onClick={() => setShowExtendedForm(!showExtendedForm)}\r\n                    className=\"flex items-center gap-2 text-sm font-bold text-[#c5a059] hover:underline w-full justify-center\"\r\n                 >\r\n                    {showExtendedForm ? <><ChevronUp size={16}/> Hide Medical Details</> : <><ChevronDown size={16}/> Add Medical Details</>}\r\n                 </button>\r\n\r\n                 {showExtendedForm && (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 bg-gray-50 p-4 rounded-lg animate-in slide-in-from-top-2 border\">\r\n                        <div className=\"md:col-span-2\">\r\n                           <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Chief Complaints</label>\r\n                           <textarea rows={2} className=\"w-full p-2 border rounded text-sm\" value={formData.chiefComplaints} onChange={e => setFormData({...formData, chiefComplaints: e.target.value})} />\r\n                        </div>\r\n                        \r\n                        <div>\r\n                           <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">K/C/O</label>\r\n                           <input className=\"w-full p-2 border rounded text-sm\" value={formData.kco} onChange={e => setFormData({...formData, kco: e.target.value})} />\r\n                        </div>\r\n\r\n                        <div>\r\n                           <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Current Medications</label>\r\n                           <input className=\"w-full p-2 border rounded text-sm\" value={formData.currentMedications} onChange={e => setFormData({...formData, currentMedications: e.target.value})} />\r\n                        </div>\r\n\r\n                        <div className=\"md:col-span-2\">\r\n                           <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Investigations</label>\r\n                           <textarea rows={2} className=\"w-full p-2 border rounded text-sm\" value={formData.investigations} onChange={e => setFormData({...formData, investigations: e.target.value})} />\r\n                        </div>\r\n\r\n                        <div><label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Past History</label><textarea rows={2} className=\"w-full p-2 border rounded text-sm\" value={formData.pastHistory} onChange={e => setFormData({...formData, pastHistory: e.target.value})} /></div>\r\n                        <div><label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Family History</label><textarea rows={2} className=\"w-full p-2 border rounded text-sm\" value={formData.familyHistory} onChange={e => setFormData({...formData, familyHistory: e.target.value})} /></div>\r\n                        \r\n                        <div><label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Mental Generals</label><textarea rows={2} className=\"w-full p-2 border rounded text-sm\" value={formData.mentalGenerals} onChange={e => setFormData({...formData, mentalGenerals: e.target.value})} /></div>\r\n                        <div><label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">OBS/GYN History</label><textarea rows={2} className=\"w-full p-2 border rounded text-sm\" value={formData.obsGynHistory} onChange={e => setFormData({...formData, obsGynHistory: e.target.value})} /></div>\r\n\r\n                        <div className=\"md:col-span-2\">\r\n                           <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Physical Generals</label>\r\n                           <textarea \r\n                              className=\"w-full p-2 border rounded text-xs font-mono h-48 bg-white\" \r\n                              value={formData.physicalGenerals} \r\n                              onChange={e => setFormData({...formData, physicalGenerals: e.target.value})} \r\n                           />\r\n                        </div>\r\n                    </div>\r\n                 )}\r\n              </div>\r\n\r\n              <div className=\"pt-4 border-t flex justify-end gap-3 shrink-0 bg-white sticky bottom-0\">\r\n                <button type=\"button\" onClick={() => setIsModalOpen(false)} className=\"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm font-bold\">Cancel</button>\r\n                <button \r\n                    type=\"submit\" \r\n                    disabled={saving}\r\n                    className=\"px-6 py-2 bg-[#1e3a29] text-white rounded-lg text-sm font-bold hover:bg-[#162b1e] flex items-center gap-2 disabled:opacity-50\"\r\n                >\r\n                  {saving ? <Loader2 className=\"animate-spin\" size={16}/> : (editingPatient ? \"Update Details\" : \"Register Patient\")}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* ‚úÖ WALLET UPDATE MODAL */}\r\n      {isWalletModalOpen && (\r\n          <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n              <div className=\"bg-white rounded-xl shadow-xl w-full max-w-sm p-6 animate-in zoom-in-95\">\r\n                  <h3 className=\"text-lg font-bold text-[#1e3a29] mb-4 flex items-center gap-2\"><Wallet/> Update Wallet</h3>\r\n                  <p className=\"text-sm text-gray-500 mb-4\">Managing balance for <span className=\"font-bold text-black\">{walletPatient?.name}</span></p>\r\n                  \r\n                  <div className=\"space-y-4\">\r\n                      <div>\r\n                          <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Transaction Type</label>\r\n                          <select \r\n                              className=\"w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-[#c5a059]\"\r\n                              value={walletType}\r\n                              onChange={(e) => setWalletType(e.target.value as \"CREDIT\" | \"DUE\")}\r\n                          >\r\n                              <option value=\"CREDIT\">Credit (Deposit / Advance)</option>\r\n                              <option value=\"DUE\">Due (Charge / Debt)</option>\r\n                          </select>\r\n                      </div>\r\n\r\n                      <div>\r\n                          <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Amount (‚Çπ)</label>\r\n                          <input \r\n                              type=\"number\" \r\n                              autoFocus\r\n                              placeholder=\"Enter Amount\" \r\n                              className=\"w-full p-3 border rounded-lg text-lg font-bold outline-none focus:ring-2 focus:ring-[#c5a059]\"\r\n                              value={walletAmount}\r\n                              onChange={(e) => setWalletAmount(e.target.value)}\r\n                          />\r\n                      </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex gap-3 mt-6\">\r\n                      <button onClick={() => setIsWalletModalOpen(false)} className=\"flex-1 py-2 text-gray-600 font-bold bg-gray-100 rounded-lg hover:bg-gray-200\">Cancel</button>\r\n                      <button \r\n                          onClick={handleWalletUpdate} \r\n                          className={`flex-1 py-2 text-white font-bold rounded-lg transition ${walletType === 'CREDIT' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}\r\n                      >\r\n                          {walletType === 'CREDIT' ? 'Add Credit' : 'Add Due'}\r\n                      </button>\r\n                  </div>\r\n              </div>\r\n          </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\pharmacy\\PharmacyClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'savePrescription' is defined but never used.","line":14,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":56,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"savePrescription"},"fix":{"range":[581,599],"text":""},"desc":"Remove unused variable \"savePrescription\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1406,1409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1406,1409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1894,1897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1894,1897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6227,6230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6227,6230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6766,6769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6766,6769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":268,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16768,16771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16768,16771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":323,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20600,20603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20600,20603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":324,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20650,20653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20650,20653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":325,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20718,20721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20718,20721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21920,21923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21920,21923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":354,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22223,22226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22223,22226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":362,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22640,22643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22640,22643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":367,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22831,22834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22831,22834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":391,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":391,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23445,23448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23445,23448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":392,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":392,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23492,23495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23492,23495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":393,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23533,23536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23533,23536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":437,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":437,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25251,25254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25251,25254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":471,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":471,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26566,26569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26566,26569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":473,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":473,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26680,26683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26680,26683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":589,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":589,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30964,30967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30964,30967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":591,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":591,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31026,31029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31026,31029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":599,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":599,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31282,31285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31282,31285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":645,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":645,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32895,32898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32895,32898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'walkInDetails.patientId'. Either include it or remove the dependency array.","line":673,"column":6,"nodeType":"ArrayExpression","endLine":673,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [walkInDetails.patientName, isGuest, walkInDetails.patientId]","fix":{"range":[33821,33857],"text":"[walkInDetails.patientName, isGuest, walkInDetails.patientId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":675,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":675,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33891,33894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33891,33894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":680,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":680,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34075,34078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34075,34078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":735,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":735,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35930,35933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35930,35933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadInventory' is assigned a value but never used.","line":773,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":773,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":799,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":799,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38594,38597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38594,38597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":799,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":799,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38618,38621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38618,38621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":27,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef, useMemo, memo } from \"react\"; \r\nimport { useSearchParams, useRouter } from \"next/navigation\"; \r\nimport { \r\n  Pill, Search, RefreshCw, Package, Clock, CheckCircle, \r\n  Loader2, Plus, Trash2, FileText, History, Printer,\r\n  ShoppingCart, X, BadgePercent, User, AlertTriangle, Stethoscope, Filter,\r\n  RotateCcw, Banknote, MessageCircle, Wallet\r\n} from \"lucide-react\";\r\nimport { \r\n  getPharmacyInventory, updateMedicine, getPharmacyQueue, \r\n  dispenseMedicine, createMedicine, deleteMedicine,\r\n  getDispensedHistory, searchPatients, savePrescription,\r\n  reopenConsultation, deleteVisit,\r\n  updateConsultationFinancials, \r\n  createDirectSale,\r\n  updatePatientWallet \r\n} from \"@/app/actions\";\r\nimport StaffHeader from \"@/app/components/StaffHeader\"; \r\nimport { generateBill } from \"@/app/components/BillGenerator\"; \r\n\r\nconst MEDICINE_TYPES = [\r\n  \"Syrup\", \"Lehyam\", \"Oil\", \"Powder\", \"Soap\", \"Shampoo\", \"Gel\", \r\n  \"Ointment\", \"Scrub\", \"Lehya\", \"Hair Pack\", \"Face Pack\", \r\n  \"Granules\", \"Pak\", \"Tablet\", \"Capsule\", \"Sachet\", \"Bhasma\", \r\n  \"Ghrit\", \"Panchkarma\", \"Procedure\"\r\n];\r\n\r\n// ‚úÖ HELPER: Sanitize Name\r\nconst cleanName = (name: string) => {\r\n    if (!name) return \"Unknown\";\r\n    return name.replace(/[0-9]/g, '').trim();\r\n};\r\n\r\n// ‚úÖ HELPER: Smartly Resolve Patient Name (Handles Guest Names stored in Diagnosis)\r\nconst getPatientDisplayName = (consult: any) => {\r\n    if (consult.patient?.readableId === 'GUEST') {\r\n        if (consult.diagnosis && consult.diagnosis.startsWith(\"Guest:\")) {\r\n            return consult.diagnosis.replace(\"Guest:\", \"\").trim(); \r\n        }\r\n        return \"Guest\"; \r\n    }\r\n    return cleanName(consult.patient?.name || consult.patientName || consult.name || \"Unknown\");\r\n};\r\n\r\n// --- Inventory Row ---\r\nconst InventoryRow = memo(({ med, editingId, editForm, setEditForm, handleEdit, saveEdit, handleDelete }: any) => {\r\n    const isEditing = editingId === med.id;\r\n    \r\n    // ‚úÖ STABLE LOW STOCK LOGIC: Default to 10\r\n    const stockVal = Number(med.stock);\r\n    const minVal = (med.minStock !== null && med.minStock !== \"\" && med.minStock !== undefined) ? Number(med.minStock) : 10;\r\n    const isLowStock = stockVal < minVal;\r\n\r\n    return (\r\n        <tr className=\"hover:bg-gray-50 group\">\r\n          <td className=\"p-4 font-medium text-[#1e3a29]\">\r\n             {isEditing ? (\r\n                <input className=\"w-full p-1 border rounded text-sm bg-white focus:ring-2 focus:ring-[#c5a059] outline-none\" value={editForm.name} onChange={e => setEditForm({...editForm, name: e.target.value})} />\r\n             ) : med.name}\r\n          </td>\r\n          <td className=\"p-4 text-gray-500\">\r\n            {isEditing ? (\r\n                <select className=\"w-full p-1 border rounded text-sm bg-white focus:ring-2 focus:ring-[#c5a059] outline-none\" value={editForm.type} onChange={e => setEditForm({...editForm, type: e.target.value})}>\r\n                   {MEDICINE_TYPES.map(t => <option key={t}>{t}</option>)}\r\n                </select>\r\n            ) : med.type}\r\n          </td>\r\n          <td className=\"p-4\">\r\n            {isEditing ? (\r\n                <div className=\"space-y-1\">\r\n                    <input className=\"w-16 p-1 border rounded text-center bg-yellow-50\" placeholder=\"Stock\" value={editForm.stock} onChange={(e) => setEditForm({...editForm, stock: e.target.value})} />\r\n                    <input className=\"w-16 p-1 border rounded text-center bg-red-50 text-xs\" placeholder=\"Min\" value={editForm.minStock} onChange={(e) => setEditForm({...editForm, minStock: e.target.value})} />\r\n                </div>\r\n            ) : (\r\n                <div>\r\n                    <div className={`font-bold flex items-center gap-2 ${isLowStock ? 'text-red-500' : 'text-gray-700'}`}>\r\n                        {med.stock} <span className=\"text-gray-400 text-xs font-normal\">/ {minVal}</span>\r\n                        {isLowStock && <AlertTriangle size={14} className=\"text-red-500\"/>}\r\n                    </div>\r\n                </div>\r\n            )}\r\n          </td>\r\n          <td className=\"p-4\">\r\n             {isEditing ? (\r\n                <div className=\"space-y-1\">\r\n                   <input type=\"date\" className=\"w-24 p-1 border rounded text-xs\" value={editForm.mfgDate} onChange={e => setEditForm({...editForm, mfgDate: e.target.value})}/>\r\n                   <input type=\"date\" className=\"w-24 p-1 border rounded text-xs bg-red-50\" value={editForm.expDate} onChange={e => setEditForm({...editForm, expDate: e.target.value})}/>\r\n                </div>\r\n             ) : (\r\n                <div className=\"text-xs text-gray-600 space-y-0.5\">\r\n                   <div><span className=\"font-bold text-gray-400\">M:</span> {med.mfgDate ? new Date(med.mfgDate).toLocaleDateString() : \"-\"}</div>\r\n                   <div><span className=\"font-bold text-red-300\">E:</span> {med.expDate ? new Date(med.expDate).toLocaleDateString() : \"-\"}</div>\r\n                </div>\r\n             )}\r\n          </td>\r\n          <td className=\"p-4\">\r\n            {isEditing ? <input className=\"w-16 p-1 border rounded text-center bg-green-50\" value={editForm.price} onChange={e => setEditForm({...editForm, price: e.target.value})} /> : <span>‚Çπ {med.price}</span>}\r\n          </td>\r\n          <td className=\"p-4 text-right flex justify-end gap-3\">\r\n            {isEditing ? <button onClick={() => saveEdit(med.id)} className=\"text-green-600 font-bold hover:underline\">Save</button> : <><button onClick={() => handleEdit(med)} className=\"text-[#c5a059] font-bold hover:underline opacity-0 group-hover:opacity-100 transition\">Edit</button><button onClick={() => handleDelete(med.id)} className=\"text-red-400 hover:text-red-600 opacity-0 group-hover:opacity-100 transition\"><Trash2 size={16}/></button></>}\r\n          </td>\r\n        </tr>\r\n    );\r\n});\r\nInventoryRow.displayName = \"InventoryRow\";\r\n\r\n// --- Queue Item (Updated) ---\r\nconst QueueItem = memo(({ \r\n    consult, dispenseQtys, handleQtyChange, discounts, discountTypes, \r\n    handleDiscountChange, toggleDiscountType, \r\n    printConsultationBill, printPharmacyBill, handleDispenseAll, handleDispenseItem, \r\n    handleReopen, handleDeleteHistoryRecord, openWalletModal, isHistory = false \r\n}: any) => {\r\n\r\n    const isDirectSale = consult.doctorName === \"Pharmacy Direct Sale\";\r\n    const apptDiscount = consult.appointment?.discount || 0;\r\n    const fee = isDirectSale ? 0 : (500 - apptDiscount);\r\n\r\n    const displayName = getPatientDisplayName(consult);\r\n    const displayId = consult.patient?.readableId || (isDirectSale ? \"GUEST\" : \"-\");\r\n\r\n    const discountType = discountTypes[consult.id] || 'PERCENT';\r\n\r\n    let currentTotal = 0;\r\n    const items = consult.prescriptions?.[0]?.items || [];\r\n    \r\n    items.forEach((item: any) => {\r\n        const qty = isHistory \r\n            ? (item.dispensedQty || 1)\r\n            : parseInt(dispenseQtys[item.id] || (item.dispensedQty ? item.dispensedQty.toString() : \"1\"));\r\n        \r\n        const medPrice = item.medicine?.price || 0;\r\n        currentTotal += (qty * medPrice);\r\n    });\r\n\r\n    const inputDiscount = parseFloat(discounts[consult.id] || \"0\");\r\n    const dbDiscount = parseFloat(consult.discount || \"0\");\r\n    const effectiveDiscount = (isHistory && inputDiscount === 0) ? dbDiscount : inputDiscount;\r\n\r\n    let discountAmountToSubtract = 0;\r\n    if (effectiveDiscount > 0) {\r\n        if (isHistory && inputDiscount === 0) {\r\n            discountAmountToSubtract = effectiveDiscount;\r\n        } else {\r\n            if (discountType === 'PERCENT') {\r\n                discountAmountToSubtract = (currentTotal * effectiveDiscount) / 100;\r\n            } else {\r\n                discountAmountToSubtract = effectiveDiscount;\r\n            }\r\n        }\r\n    }\r\n\r\n    const finalTotal = currentTotal - discountAmountToSubtract;\r\n\r\n    const persistFinancials = async () => {\r\n        if (isHistory) return; \r\n        await updateConsultationFinancials(\r\n            consult.id, \r\n            discountAmountToSubtract, \r\n            finalTotal, \r\n            \"Cash\"\r\n        );\r\n    };\r\n\r\n    const handleShareBill = () => {\r\n        if (!consult.patient?.phone && !consult.phone) return alert(\"No phone number found.\");\r\n        let phone = (consult.patient?.phone || consult.phone).replace(/[^0-9]/g, '');\r\n        if (phone.length === 10) phone = \"91\" + phone;\r\n        const message = `Namaste ${displayName}, your total pharmacy bill at Rudra Ayurved is ‚Çπ${finalTotal.toFixed(0)}. Thank you for visiting us.`;\r\n        window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');\r\n    };\r\n\r\n    const walletBalance = consult.patient?.walletBalance || 0;\r\n    const hasWallet = consult.patient !== undefined && consult.patient !== null;\r\n    const isGuest = consult.patient?.readableId === 'GUEST';\r\n\r\n    return (\r\n        <div className=\"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition\">\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n                <div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <h3 className=\"text-lg font-bold text-[#1e3a29]\">{displayName}</h3>\r\n                        {!isHistory && (\r\n                            <span className={`text-[10px] px-2 py-0.5 rounded font-bold border flex items-center gap-1 ${fee > 0 ? 'bg-green-50 text-green-700 border-green-200' : 'bg-blue-50 text-blue-700 border-blue-200'}`}>\r\n                                <Stethoscope size={10}/>\r\n                                Consultation: {fee > 0 ? `‚Çπ${fee}` : \"FREE\"}\r\n                            </span>\r\n                        )}\r\n                        {hasWallet && !isGuest && (\r\n                            <button \r\n                                onClick={() => openWalletModal(consult.patient)}\r\n                                className={`text-[10px] px-2 py-0.5 rounded font-bold flex items-center gap-1 hover:bg-purple-100 transition border ${walletBalance < 0 ? 'bg-red-50 text-red-700 border-red-200' : (walletBalance > 0 ? 'bg-green-50 text-green-700 border-green-200' : 'bg-purple-50 text-purple-700 border-purple-200')}`}\r\n                                title=\"Manage Wallet\"\r\n                            >\r\n                                <Wallet size={12}/> \r\n                                {walletBalance < 0 ? `Due: ‚Çπ${Math.abs(walletBalance)}` : `Adv: ‚Çπ${walletBalance}`}\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                    <p className=\"text-xs text-gray-500 mt-1\">Prescribed by {consult.doctorName} ‚Ä¢ {new Date(consult.createdAt).toLocaleDateString('en-GB')} at {new Date(consult.createdAt).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}</p>\r\n                    <div className=\"flex gap-2 mt-2\">\r\n                        <span className=\"text-[10px] bg-gray-100 px-2 py-0.5 rounded text-gray-500 font-mono\">PID: {displayId}</span>\r\n                        {!isHistory && !isDirectSale && <span className=\"text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded font-mono\">APP: {consult.appointment?.readableId || \"WALK-IN\"}</span>}\r\n                        {isDirectSale && <span className=\"text-[10px] bg-amber-50 text-amber-700 px-2 py-0.5 rounded font-bold\">DIRECT SALE</span>}\r\n                    </div>\r\n                </div>\r\n                \r\n                {!isHistory && (\r\n                <div className=\"flex flex-col items-end gap-2\">\r\n                    <div className=\"text-lg font-bold text-[#1e3a29] flex items-center gap-2 bg-green-50 px-3 py-1 rounded border border-green-100\">\r\n                        <Banknote size={18} className=\"text-green-600\"/>\r\n                        Total: ‚Çπ{finalTotal.toFixed(0)}\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-2 items-center\">\r\n                        <div className=\"flex items-center bg-gray-50 border rounded overflow-hidden\">\r\n                            <button onClick={() => toggleDiscountType(consult.id)} className=\"px-2 py-1 text-[10px] font-bold bg-gray-200 text-gray-600 hover:bg-gray-300 border-r\" title=\"Click to switch between % and ‚Çπ\">\r\n                                {discountType === 'PERCENT' ? '%' : '‚Çπ'}\r\n                            </button>\r\n                            <input type=\"number\" placeholder={discountType === 'PERCENT' ? \"Disc %\" : \"Disc ‚Çπ\"} className=\"w-16 px-2 py-1 text-xs bg-transparent outline-none font-medium\" value={discounts[consult.id] || \"\"} onChange={(e) => handleDiscountChange(consult.id, e.target.value)}/>\r\n                        </div>\r\n                        \r\n                        <button onClick={handleShareBill} className=\"text-[#25D366] hover:bg-green-50 p-2 rounded-lg transition border border-transparent hover:border-green-200\" title=\"Share Bill on WhatsApp\">\r\n                            <MessageCircle size={18}/>\r\n                        </button>\r\n\r\n                        <button onClick={async () => { await persistFinancials(); printConsultationBill(consult); }} className=\"bg-blue-50 border border-blue-200 text-blue-700 font-bold px-3 py-2 rounded-lg text-xs hover:bg-blue-100 transition flex items-center gap-1\"><FileText size={14}/> Consult</button>\r\n                        <button onClick={async () => { await persistFinancials(); printPharmacyBill(consult, false); }} className=\"bg-white border border-[#1e3a29] text-[#1e3a29] font-bold px-3 py-2 rounded-lg text-xs hover:bg-gray-50 transition flex items-center gap-1\"><FileText size={14}/> Meds</button>\r\n                        <button onClick={async () => { await persistFinancials(); handleDispenseAll(items); }} className=\"bg-[#1e3a29] text-white font-bold px-4 py-2 rounded-lg text-xs shadow hover:bg-[#162b1e] transition flex items-center gap-2\"><CheckCircle size={14}/> Dispense</button>\r\n                    </div>\r\n                </div>\r\n                )}\r\n\r\n                {isHistory && (\r\n                    <div className=\"flex flex-col items-end\">\r\n                         <div className=\"mt-2 text-sm font-bold text-[#1e3a29] flex items-center gap-2 mb-2\">\r\n                             <Banknote size={16} className=\"text-[#c5a059]\"/> Total Bill: ‚Çπ{finalTotal.toFixed(0)}\r\n                         </div>\r\n                         <div className=\"flex gap-2\">\r\n                            <button onClick={handleShareBill} className=\"text-[#25D366] hover:bg-green-50 p-2 rounded-lg transition border border-transparent hover:border-green-200\" title=\"Share Bill on WhatsApp\">\r\n                                <MessageCircle size={18}/>\r\n                            </button>\r\n\r\n                            <button onClick={() => handleReopen(consult.id)} className=\"bg-amber-50 border border-amber-200 text-amber-700 font-bold px-3 py-2 rounded-lg text-xs hover:bg-amber-100 flex items-center gap-1 transition\"><RotateCcw size={14}/> Reopen</button>\r\n                            <button onClick={() => printConsultationBill(consult)} className=\"bg-blue-50 border border-blue-200 text-blue-700 font-bold px-3 py-2 rounded-lg text-xs hover:bg-blue-100 flex items-center gap-1 transition\"><Printer size={14}/> Consult</button>\r\n                            <button onClick={() => printPharmacyBill(consult, true)} className=\"bg-gray-100 border border-gray-300 text-gray-700 font-bold px-3 py-2 rounded-lg text-xs hover:bg-gray-200 flex items-center gap-1 transition\"><Printer size={14}/> Pharma</button>\r\n                            <button onClick={() => handleDeleteHistoryRecord(consult.id, consult.patientId)} className=\"bg-red-50 border border-red-200 text-red-600 font-bold px-3 py-2 rounded-lg text-xs hover:bg-red-100 flex items-center gap-1 transition\"><Trash2 size={14}/></button>\r\n                         </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"bg-gray-50 rounded-lg border border-gray-100 overflow-hidden\">\r\n                <table className=\"w-full text-sm\">\r\n                    <thead className=\"bg-gray-100 text-xs uppercase text-gray-500 text-left\">\r\n                        <tr>\r\n                            <th className=\"p-3 w-1/4\">Medicine</th>\r\n                            <th className=\"p-3\">Dosage / Info</th>\r\n                            <th className=\"p-3\">Duration</th>\r\n                            <th className=\"p-3 text-center w-24\">Qty Given</th>\r\n                            <th className=\"p-3 text-right w-24\">Cost (‚Çπ)</th>\r\n                            <th className=\"p-3 text-right\">Status</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-gray-200\">\r\n                        {items.map((item: any) => {\r\n                            const currentQty = isHistory\r\n                                ? (item.dispensedQty || 1)\r\n                                : parseInt(dispenseQtys[item.id] || (item.dispensedQty ? item.dispensedQty.toString() : \"1\"));\r\n                            \r\n                            const itemCost = (item.medicine?.price || 0) * currentQty;\r\n                            return (\r\n                                <tr key={item.id} className={item.status === 'DISPENSED' ? 'bg-green-50' : ''}>\r\n                                    <td className=\"p-3\">\r\n                                        <div className=\"font-medium text-[#1e3a29]\">{item.medicine?.name || \"Unknown\"}</div>\r\n                                        <div className=\"flex gap-2 mt-1\">\r\n                                            <span className=\"text-[10px] bg-gray-200 px-1.5 py-0.5 rounded text-gray-600 font-bold\">{item.unit || \"Tablet\"}</span>\r\n                                            {item.panchkarma && <span className=\"text-[10px] bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded font-bold\">{item.panchkarma}</span>}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"p-3\">\r\n                                        <div className=\"font-mono text-xs text-gray-800\">{item.dosage}</div>\r\n                                        <div className=\"text-[10px] text-gray-500\">{item.instruction}</div>\r\n                                    </td>\r\n                                    <td className=\"p-3 font-bold text-gray-600\">{item.duration}</td>\r\n                                    <td className=\"p-3 text-center\">\r\n                                        {item.status === 'PENDING' ? (\r\n                                            <input type=\"number\" className=\"w-16 p-1 border border-gray-300 rounded text-center text-sm font-bold focus:border-[#c5a059] outline-none\"\r\n                                                value={dispenseQtys[item.id] || \"1\"}\r\n                                                onChange={(e) => handleQtyChange(item.id, e.target.value)} min=\"1\" />\r\n                                        ) : (\r\n                                            <span className=\"text-gray-600 font-bold bg-white border px-2 py-1 rounded\">{item.dispensedQty || 1}</span>\r\n                                        )}\r\n                                    </td>\r\n                                    <td className=\"p-3 text-right font-bold text-gray-700\">‚Çπ{itemCost}</td>\r\n                                    <td className=\"p-3 text-right\">\r\n                                        {item.status === 'DISPENSED' ? (\r\n                                            <span className=\"inline-flex items-center gap-1 text-green-700 font-bold text-xs bg-green-100 px-2 py-1 rounded-full\"><CheckCircle size={12} /> Dispensed</span>\r\n                                        ) : (\r\n                                            <button onClick={() => handleDispenseItem(item.id)} className=\"inline-flex items-center gap-1 bg-[#c5a059] text-[#1e3a29] font-bold text-xs px-3 py-1.5 rounded hover:bg-[#b08d4b]\">Dispense</button>\r\n                                        )}\r\n                                    </td>\r\n                                </tr>\r\n                            );\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n});\r\nQueueItem.displayName = \"QueueItem\";\r\n\r\n// ... [Main Component] ...\r\n\r\nexport default function PharmacyClient() {\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n  \r\n  const [activeTab, setActiveTab] = useState<'queue' | 'inventory' | 'history'>('queue');\r\n  const [inventory, setInventory] = useState<any[]>([]);\r\n  const [queue, setQueue] = useState<any[]>([]);\r\n  const [historyResults, setHistoryResults] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [inventorySearch, setInventorySearch] = useState(\"\");\r\n  const [showLowStockOnly, setShowLowStockOnly] = useState(false);\r\n  \r\n  const [historySearch, setHistorySearch] = useState(\"\");\r\n  const [dateRange, setDateRange] = useState({ start: \"\", end: \"\" }); \r\n  const [isSearchingHistory, setIsSearchingHistory] = useState(false);\r\n\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [editForm, setEditForm] = useState({ \r\n      name: \"\", stock: \"\", price: \"\", minStock: \"\", mfgDate: \"\", expDate: \"\", type: \"\" \r\n  }); \r\n\r\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n  const [newMed, setNewMed] = useState({ \r\n    name: \"\", type: \"Tablet\", stock: \"0\", price: \"0\", minStock: \"10\", mfgDate: \"\", expDate: \"\"\r\n  });\r\n\r\n  const [dispenseQtys, setDispenseQtys] = useState<{[key: string]: string}>({});\r\n  const [discounts, setDiscounts] = useState<{[key: string]: string}>({});\r\n  const [discountTypes, setDiscountTypes] = useState<{[key: string]: 'PERCENT' | 'VALUE'}>({});\r\n\r\n  const [isWalkInModalOpen, setIsWalkInModalOpen] = useState(false);\r\n  const [walkInCart, setWalkInCart] = useState<any[]>([]);\r\n  const [walkInSearch, setWalkInSearch] = useState(\"\");\r\n  const [walkInDetails, setWalkInDetails] = useState({ patientName: \"\", phone: \"\", patientId: \"\", discount: \"\" });\r\n  const [isGuest, setIsGuest] = useState(false);\r\n  \r\n  const [patientSuggestions, setPatientSuggestions] = useState<any[]>([]);\r\n  const [showPatientSearch, setShowPatientSearch] = useState(false);\r\n  const patientSearchRef = useRef<HTMLDivElement>(null);\r\n\r\n  // ‚úÖ Wallet State\r\n  const [showWalletModal, setShowWalletModal] = useState(false);\r\n  const [walletAmount, setWalletAmount] = useState(\"\");\r\n  const [walletType, setWalletType] = useState<\"CREDIT\" | \"DUE\">(\"CREDIT\");\r\n  const [walletPatient, setWalletPatient] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    const tabParam = searchParams.get('tab');\r\n    if (tabParam && ['queue', 'inventory', 'history'].includes(tabParam)) {\r\n      setActiveTab(tabParam as any);\r\n    }\r\n  }, [searchParams]);\r\n\r\n  const switchTab = (tab: 'queue' | 'inventory' | 'history') => {\r\n    setActiveTab(tab);\r\n    router.replace(`/pharmacy?tab=${tab}`);\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, []);\r\n\r\n  const loadData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const [invData, queueData] = await Promise.all([\r\n        getPharmacyInventory(\"\", 10000), // ‚úÖ Fetch ALL Inventory\r\n        getPharmacyQueue()\r\n      ]);\r\n      setInventory(invData);\r\n      setQueue(queueData);\r\n      \r\n      const initialQtys: {[key: string]: string} = {};\r\n      queueData.forEach((q: any) => {\r\n        q.prescriptions.forEach((p: any) => {\r\n          p.items.forEach((i: any) => {\r\n             if (!initialQtys[i.id]) {\r\n                 initialQtys[i.id] = i.dispensedQty ? i.dispensedQty.toString() : \"1\"; \r\n             }\r\n          });\r\n        });\r\n      });\r\n      setDispenseQtys(prev => ({...prev, ...initialQtys}));\r\n    } catch (e) {\r\n      console.error(\"Error loading pharmacy data\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ‚úÖ RESTORED STABLE LOGIC for Low Stock (Defaults to 10 if null)\r\n  const filteredInventory = useMemo(() => {\r\n    return inventory.filter(m => {\r\n        const matchesSearch = m.name.toLowerCase().includes(inventorySearch.toLowerCase());\r\n        const stockVal = Number(m.stock);\r\n        const minVal = (m.minStock !== null && m.minStock !== \"\" && m.minStock !== undefined) ? Number(m.minStock) : 10;\r\n        const isLowStock = stockVal < minVal;\r\n        return showLowStockOnly ? (matchesSearch && isLowStock) : matchesSearch;\r\n    });\r\n  }, [inventory, inventorySearch, showLowStockOnly]);\r\n\r\n  const inventoryMap = useMemo(() => {\r\n      const map = new Map();\r\n      inventory.forEach(item => map.set(item.name.toLowerCase(), item)); // ‚úÖ Case-insensitive Map\r\n      return map;\r\n  }, [inventory]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab === 'history') {\r\n        const delayDebounce = setTimeout(async () => {\r\n            setIsSearchingHistory(true);\r\n            const results = await getDispensedHistory(historySearch, dateRange.start, dateRange.end);\r\n            setHistoryResults(results);\r\n            setIsSearchingHistory(false);\r\n        }, 500);\r\n        return () => clearTimeout(delayDebounce);\r\n    }\r\n  }, [historySearch, dateRange, activeTab]); \r\n\r\n  const printConsultationBill = async (consult: any) => {\r\n     // ‚úÖ FIX: Fee is 0 if Direct Sale, else (500 - Appointment Discount)\r\n     const isDirectSale = consult.doctorName === \"Pharmacy Direct Sale\";\r\n     const apptDiscount = consult.appointment?.discount || 0;\r\n     const fee = isDirectSale ? 0 : (500 - apptDiscount);\r\n\r\n     // ‚úÖ FIX: Use Correct Name for Bill (Handle Guest)\r\n     const patientNameForBill = getPatientDisplayName(consult);\r\n\r\n     const items = [{\r\n        name: \"Consultation Charge\",\r\n        qty: 1,\r\n        amount: fee\r\n     }];\r\n\r\n     const dateStr = new Date(consult.createdAt).toISOString().slice(0,10).replace(/-/g, \"\");\r\n     const uniqueId = consult.id.slice(-4).toUpperCase();\r\n     const billNo = `OPD-${dateStr}-${uniqueId}`;\r\n\r\n     const billDate = consult.appointment?.date \r\n        ? new Date(consult.appointment.date).toLocaleDateString() \r\n        : new Date(consult.createdAt).toLocaleDateString();\r\n\r\n     await generateBill({\r\n       billNo,\r\n       date: billDate, \r\n       patientName: patientNameForBill,\r\n       patientId: consult.patient?.readableId || consult.patient?.id.slice(0,6) || \"GUEST\",\r\n       appointmentId: consult.appointment?.readableId || \"WALK-IN\",\r\n       doctorName: consult.doctorName || \"Dr. Chirag Raval\",\r\n       items\r\n    });\r\n  };\r\n\r\n  const printPharmacyBill = async (consult: any, isReprint = false) => {\r\n    let subTotal = 0;\r\n    const items = consult.prescriptions[0]?.items.map((item: any) => {\r\n       const qty = isReprint \r\n          ? (item.dispensedQty || 1) \r\n          : parseInt(dispenseQtys[item.id] || (item.dispensedQty ? item.dispensedQty.toString() : \"1\"));\r\n\r\n       // ‚úÖ FIX: Prioritize price in prescription record\r\n       const medName = item.medicine?.name || \"Medicine\";\r\n       let unitPrice = item.medicine?.price; \r\n       \r\n       if (unitPrice === undefined || unitPrice === null) {\r\n          const medInfo = inventoryMap.get(medName.toLowerCase());\r\n          unitPrice = medInfo?.price || 0;\r\n       }\r\n       \r\n       const lineTotal = unitPrice * qty;\r\n       subTotal += lineTotal;\r\n\r\n       const dosageInfo = [\r\n           item.dosage, \r\n           item.instruction ? `(${item.instruction})` : null\r\n       ].filter(Boolean).join(\" \"); // Joins dosage and instruction with a space\r\n\r\n       return {\r\n          name: `${medName} (${item.unit || '-'})`,\r\n          qty: qty,\r\n          amount: lineTotal,\r\n          dosage: dosageInfo || \"-\" // Pass the combined string\r\n       };\r\n    }) || [];\r\n\r\n    if(items.length === 0) return alert(\"No pharmacy items to bill\");\r\n\r\n    const inputDiscount = parseFloat(discounts[consult.id] || \"0\");\r\n    const dbDiscount = parseFloat(consult.discount || \"0\");\r\n    const effectiveDiscount = (isReprint && inputDiscount === 0) ? dbDiscount : inputDiscount;\r\n    const discType = discountTypes[consult.id] || 'PERCENT';\r\n    \r\n    let discountAmount = 0;\r\n    \r\n    // ‚úÖ Logic: History = Flat Amount | Live = Toggle Calculation\r\n    if (effectiveDiscount > 0) {\r\n        if (isReprint && inputDiscount === 0) {\r\n             discountAmount = effectiveDiscount;\r\n             items.push({\r\n                name: `PHARMACY DISCOUNT (Flat)`,\r\n                qty: 1,\r\n                amount: -discountAmount,\r\n                dosage: \"\"\r\n            });\r\n        } else {\r\n             if (discType === 'PERCENT') {\r\n                discountAmount = (subTotal * effectiveDiscount) / 100;\r\n                items.push({\r\n                    name: `PHARMACY DISCOUNT (${effectiveDiscount}%)`,\r\n                    qty: 1,\r\n                    amount: -discountAmount,\r\n                    dosage: \"\"\r\n                });\r\n             } else {\r\n                discountAmount = effectiveDiscount;\r\n                items.push({\r\n                    name: `PHARMACY DISCOUNT (Flat)`,\r\n                    qty: 1,\r\n                    amount: -discountAmount,\r\n                    dosage: \"\"\r\n                });\r\n             }\r\n        }\r\n    }\r\n\r\n    const dateStr = new Date(consult.createdAt).toISOString().slice(0,10).replace(/-/g, \"\");\r\n    const uniqueId = consult.id.slice(-4).toUpperCase();\r\n    const billNo = `PH-${dateStr}-${uniqueId}`;\r\n\r\n    const billDate = consult.appointment?.date \r\n        ? new Date(consult.appointment.date).toLocaleDateString() \r\n        : new Date(consult.createdAt).toLocaleDateString();\r\n\r\n    // ‚úÖ FIX: Use Correct Name for Bill\r\n    const patientNameForBill = getPatientDisplayName(consult);\r\n\r\n    await generateBill({\r\n       billNo,\r\n       date: billDate,\r\n       patientName: patientNameForBill,\r\n       patientId: consult.patient?.readableId || consult.patient?.id.slice(0,6) || \"GUEST\",\r\n       appointmentId: consult.appointment?.readableId || \"WALK-IN\",\r\n       doctorName: consult.doctorName || \"Dr. Chirag Raval\",\r\n       items\r\n    });\r\n  };\r\n\r\n  const handleQtyChange = (itemId: string, val: string) => {\r\n    setDispenseQtys(prev => ({...prev, [itemId]: val}));\r\n  };\r\n\r\n  const handleDiscountChange = (consultId: string, val: string) => {\r\n    setDiscounts(prev => ({...prev, [consultId]: val}));\r\n  };\r\n\r\n  const toggleDiscountType = (consultId: string) => {\r\n      setDiscountTypes(prev => ({\r\n          ...prev,\r\n          [consultId]: prev[consultId] === 'VALUE' ? 'PERCENT' : 'VALUE'\r\n      }));\r\n  };\r\n\r\n  const handleDispenseItem = async (itemId: string, qtyOverride?: number) => {\r\n    const qtyToDeduct = qtyOverride || parseInt(dispenseQtys[itemId]) || 1;\r\n    if(qtyToDeduct <= 0) return alert(\"Invalid quantity\");\r\n\r\n    const result = await dispenseMedicine(itemId, qtyToDeduct);\r\n    \r\n    if (result.success) {\r\n      setQueue(prev => prev.map(consult => ({\r\n        ...consult,\r\n        prescriptions: consult.prescriptions.map((p: any) => ({\r\n          ...p,\r\n          items: p.items.map((i: any) => i.id === itemId ? { ...i, status: 'DISPENSED', dispensedQty: qtyToDeduct } : i)\r\n        }))\r\n      })));\r\n      const inv = await getPharmacyInventory(\"\", 10000);\r\n      setInventory(inv);\r\n    }\r\n  };\r\n\r\n  const handleDispenseAll = async (items: any[]) => {\r\n    if(!confirm(\"Dispense all items using entered quantities?\")) return;\r\n    for (const item of items) {\r\n      if (item.status === 'PENDING') {\r\n        const qty = parseInt(dispenseQtys[item.id] || \"1\");\r\n        await handleDispenseItem(item.id, qty);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleReopen = async (consultId: string) => {\r\n    if(!confirm(\"Are you sure you want to reopen this item? It will move back to the Live Queue for correction.\")) return;\r\n    setLoading(true);\r\n    const result = await reopenConsultation(consultId);\r\n    setLoading(false);\r\n    if (result.success) {\r\n        alert(\"Moved back to Live Queue successfully.\");\r\n        switchTab('queue'); \r\n        loadData();\r\n    } else {\r\n        alert(\"Failed to reopen: \" + result.error);\r\n    }\r\n  };\r\n\r\n  const handleDeleteHistoryRecord = async (consultId: string, patientId: string) => {\r\n      if(!confirm(\"‚ö†Ô∏è Delete this record permanently?\\nThis will remove it from history and reports.\")) return;\r\n      setLoading(true);\r\n      await deleteVisit(consultId, patientId);\r\n      setHistoryResults(prev => prev.filter(h => h.id !== consultId));\r\n      setLoading(false);\r\n  };\r\n\r\n  const handleAddNew = async () => {\r\n    await createMedicine(newMed);\r\n    setIsAddModalOpen(false);\r\n    setNewMed({ name: \"\", type: \"Tablet\", stock: \"0\", price: \"0\", minStock: \"10\", mfgDate: \"\", expDate: \"\" });\r\n    loadData();\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if(confirm(\"Delete this medicine permanently?\")) {\r\n      await deleteMedicine(id);\r\n      loadData();\r\n    }\r\n  };\r\n\r\n  const handleEdit = (med: any) => {\r\n    setEditingId(med.id);\r\n    setEditForm({ \r\n        name: med.name, \r\n        stock: med.stock.toString(), \r\n        price: med.price.toString(),\r\n        minStock: (med.minStock || 10).toString(),\r\n        mfgDate: med.mfgDate ? new Date(med.mfgDate).toISOString().split('T')[0] : \"\",\r\n        expDate: med.expDate ? new Date(med.expDate).toISOString().split('T')[0] : \"\",\r\n        type: med.type || \"Tablet\" \r\n    });\r\n  };\r\n\r\n  const saveEdit = async (id: string) => {\r\n    await updateMedicine(id, editForm);\r\n    setEditingId(null);\r\n    loadData();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isGuest) return; \r\n    const t = setTimeout(async () => {\r\n      if (walkInDetails.patientName.length > 1 && !walkInDetails.patientId) {\r\n        setPatientSuggestions(await searchPatients(walkInDetails.patientName));\r\n        setShowPatientSearch(true);\r\n      }\r\n    }, 300);\r\n    return () => clearTimeout(t);\r\n  }, [walkInDetails.patientName, isGuest]);\r\n\r\n  const selectPatient = (p: any) => {\r\n    setWalkInDetails({ ...walkInDetails, patientName: p.name, phone: p.phone, patientId: p.id });\r\n    setShowPatientSearch(false);\r\n  };\r\n\r\n  const addToWalkInCart = (med: any) => {\r\n    if (walkInCart.find(i => i.id === med.id)) return alert(\"Item already in cart\");\r\n    setWalkInCart([...walkInCart, { ...med, qty: 1 }]);\r\n    setWalkInSearch(\"\"); \r\n  };\r\n\r\n  const removeFromWalkInCart = (index: number) => {\r\n    const newCart = [...walkInCart];\r\n    newCart.splice(index, 1);\r\n    setWalkInCart(newCart);\r\n  };\r\n\r\n  const updateWalkInQty = (index: number, val: string) => {\r\n    const newCart = [...walkInCart];\r\n    newCart[index].qty = parseInt(val) || 1;\r\n    setWalkInCart(newCart);\r\n  };\r\n\r\n  const handleWalkInCheckout = async () => {\r\n    if (walkInCart.length === 0) return alert(\"Cart is empty\");\r\n    if (!walkInDetails.patientName) return alert(\"Please enter Patient Name\");\r\n\r\n    // 1. Prepare Data for Direct Sale Action\r\n    const saleData = {\r\n        patientId: isGuest ? null : walkInDetails.patientId,\r\n        phone: walkInDetails.phone,\r\n        name: walkInDetails.patientName,\r\n        discount: walkInDetails.discount,\r\n        items: walkInCart.map(item => ({\r\n            medicineId: item.id,\r\n            quantity: item.qty\r\n        }))\r\n    };\r\n\r\n    // 2. Call the Server Action\r\n    const result = await createDirectSale(saleData);\r\n\r\n    if (result.success) {\r\n        alert(\"‚úÖ Sale added to Live Queue! Please go to the Queue tab to Print Bill and Dispense items.\");\r\n        \r\n        // 3. Reset Form\r\n        setIsWalkInModalOpen(false);\r\n        setWalkInCart([]);\r\n        setWalkInDetails({ patientName: \"\", phone: \"\", patientId: \"\", discount: \"\" });\r\n        setIsGuest(false);\r\n        \r\n        // 4. Switch to Queue Tab to show the new item\r\n        switchTab('queue');\r\n        loadData();\r\n    } else {\r\n        alert(\"‚ùå Failed to create sale: \" + result.error);\r\n    }\r\n  };\r\n\r\n  // ‚úÖ Wallet Helper Functions (Consistent with other pages)\r\n  const openWalletModal = (patient: any) => {\r\n    if(!patient || !patient.id) return alert(\"This patient is not registered. Cannot use wallet.\");\r\n    setWalletPatient(patient);\r\n    setWalletAmount(\"\");\r\n    setWalletType(\"CREDIT\");\r\n    setShowWalletModal(true);\r\n  };\r\n\r\n  const handleWalletTransaction = async () => {\r\n      if(!walletPatient || !walletAmount) return;\r\n      const amount = parseFloat(walletAmount);\r\n      if(isNaN(amount) || amount <= 0) return alert(\"Enter valid amount\");\r\n\r\n      // Use the DEDICATED Wallet Action\r\n      const res = await updatePatientWallet(walletPatient.id, amount, walletType);\r\n\r\n      if(res.success) {\r\n          alert(\"Wallet Updated Successfully!\");\r\n          setShowWalletModal(false);\r\n          loadData(); \r\n      } else {\r\n          alert(\"Failed to update wallet: \" + res.error);\r\n      }\r\n  };\r\n\r\n  const handleOpenDirectSale = () => {\r\n      setIsWalkInModalOpen(true);\r\n      // ‚úÖ FIX: Load Full Inventory for Direct Sale\r\n      if(inventory.length === 0) {\r\n          const fetchFull = async () => {\r\n             const data = await getPharmacyInventory(\"\", 10000);\r\n             setInventory(data);\r\n          }\r\n          fetchFull();\r\n      }\r\n  };\r\n  \r\n  // ‚úÖ LOAD FULL INVENTORY ON INVENTORY TAB\r\n  const loadInventory = async () => {\r\n      const data = await getPharmacyInventory(inventorySearch, 10000, false);\r\n      setInventory(data);\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-screen bg-[#FDFBF7] flex flex-col font-sans text-neutral-800 overflow-hidden\">\r\n      <StaffHeader />\r\n      \r\n      <div className=\"bg-white border-b px-8 py-4 flex justify-between items-center shadow-sm z-10 shrink-0\">\r\n        <div className=\"flex items-center gap-3\">\r\n           <div className=\"bg-[#1e3a29] text-white p-2 rounded-lg\"><Pill size={24} /></div>\r\n           <h1 className=\"text-xl font-serif font-bold text-[#1e3a29]\">Pharmacy Dashboard</h1>\r\n        </div>\r\n        \r\n        <div className=\"flex gap-4\">\r\n            <button \r\n                onClick={handleOpenDirectSale}\r\n                className=\"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-blue-700 shadow-md transition\"\r\n            >\r\n                <ShoppingCart size={16}/> Direct Sale\r\n            </button>\r\n\r\n            <div className=\"flex bg-gray-100 p-1 rounded-lg\">\r\n                <button onClick={() => switchTab('queue')} className={`px-4 py-2 text-sm font-bold rounded-md transition flex items-center gap-2 ${activeTab === 'queue' ? 'bg-white shadow text-[#1e3a29]' : 'text-gray-500'}`}>\r\n                    <Clock size={16}/> Live Queue\r\n                    {queue.some(q => q.prescriptions.some((p:any) => p.items.some((i:any) => i.status === 'PENDING'))) && <span className=\"bg-red-500 w-2 h-2 rounded-full animate-pulse\"></span>}\r\n                </button>\r\n                <button onClick={() => switchTab('history')} className={`px-4 py-2 text-sm font-bold rounded-md transition flex items-center gap-2 ${activeTab === 'history' ? 'bg-white shadow text-[#1e3a29]' : 'text-gray-500'}`}>\r\n                    <History size={16}/> History\r\n                </button>\r\n                <button onClick={() => switchTab('inventory')} className={`px-4 py-2 text-sm font-bold rounded-md transition flex items-center gap-2 ${activeTab === 'inventory' ? 'bg-white shadow text-[#1e3a29]' : 'text-gray-500'}`}>\r\n                    <Package size={16}/> Inventory\r\n                </button>\r\n            </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex-1 overflow-y-auto p-8\">\r\n        {loading ? <div className=\"flex justify-center mt-20\"><Loader2 className=\"animate-spin text-[#c5a059]\" size={40}/></div> : (\r\n          <>\r\n            {activeTab === 'queue' && (\r\n              <div className=\"max-w-6xl mx-auto space-y-4\">\r\n                {queue.length === 0 ? (\r\n                   <div className=\"text-center py-20 text-gray-400 border-2 border-dashed rounded-xl\">\r\n                     <Clock className=\"mx-auto mb-2 text-gray-300\" size={40}/>\r\n                     No active patients waiting.\r\n                   </div>\r\n                ) : (\r\n                   queue.map((consult) => (\r\n                      <QueueItem \r\n                         key={consult.id}\r\n                         consult={consult}\r\n                         dispenseQtys={dispenseQtys}\r\n                         handleQtyChange={handleQtyChange}\r\n                         discounts={discounts}\r\n                         discountTypes={discountTypes}\r\n                         handleDiscountChange={handleDiscountChange}\r\n                         toggleDiscountType={toggleDiscountType}\r\n                         printConsultationBill={printConsultationBill}\r\n                         printPharmacyBill={printPharmacyBill}\r\n                         handleDispenseAll={handleDispenseAll}\r\n                         handleDispenseItem={handleDispenseItem}\r\n                         // ‚úÖ PASS WALLET FUNCTION\r\n                         openWalletModal={openWalletModal} \r\n                      />\r\n                   ))\r\n                )}\r\n              </div>\r\n            )}\r\n            \r\n            {/* ... Other Tabs ... */}\r\n            \r\n             {activeTab === 'history' && (\r\n              <div className=\"max-w-5xl mx-auto\">\r\n                  <div className=\"bg-white p-4 rounded-xl shadow-sm border border-gray-200 mb-6 flex flex-col md:flex-row gap-4 items-center justify-between\">\r\n                     <div className=\"relative w-full md:w-1/3\">\r\n                        <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={18}/>\r\n                        <input \r\n                          type=\"text\" \r\n                          placeholder=\"Search Name, Phone or ID...\" \r\n                          className=\"w-full pl-10 p-2 border rounded-lg text-sm outline-none focus:ring-2 focus:ring-[#c5a059]\"\r\n                          value={historySearch}\r\n                          onChange={(e) => setHistorySearch(e.target.value)}\r\n                        />\r\n                     </div>\r\n                     <div className=\"flex items-center gap-2 w-full md:w-auto\">\r\n                        <input type=\"date\" className=\"p-2 border rounded-lg text-sm\" value={dateRange.start} onChange={(e) => setDateRange({...dateRange, start: e.target.value})} />\r\n                        <span className=\"text-gray-400\">-</span>\r\n                        <input type=\"date\" className=\"p-2 border rounded-lg text-sm\" value={dateRange.end} onChange={(e) => setDateRange({...dateRange, end: e.target.value})} />\r\n                     </div>\r\n                     {isSearchingHistory && <Loader2 className=\"animate-spin text-[#c5a059]\" size={20}/>}\r\n                  </div>\r\n\r\n                  <div className=\"space-y-4\">\r\n                      {historyResults.length === 0 ? (\r\n                         <div className=\"text-center text-gray-400 py-10 border-2 border-dashed rounded-xl bg-gray-50\">\r\n                            {historySearch || dateRange.start ? \"No records found matching your filters.\" : \"No recent dispensed history found.\"}\r\n                         </div>\r\n                      ) : (\r\n                         historyResults.map((consult) => (\r\n                            <QueueItem \r\n                               key={consult.id}\r\n                               consult={consult}\r\n                               dispenseQtys={dispenseQtys}\r\n                               handleQtyChange={() => {}} \r\n                               discounts={{}}\r\n                               discountTypes={{}}\r\n                               handleDiscountChange={() => {}}\r\n                               toggleDiscountType={() => {}}\r\n                               printConsultationBill={printConsultationBill}\r\n                               printPharmacyBill={printPharmacyBill}\r\n                               handleDispenseAll={() => {}}\r\n                               handleDispenseItem={() => {}}\r\n                               isHistory={true}\r\n                               handleReopen={handleReopen}\r\n                               handleDeleteHistoryRecord={handleDeleteHistoryRecord}\r\n                               openWalletModal={openWalletModal} // ‚úÖ PASS WALLET FUNCTION\r\n                            />\r\n                         ))\r\n                      )}\r\n                  </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Inventory Tab */}\r\n            {activeTab === 'inventory' && (\r\n              <div className=\"max-w-6xl mx-auto\">\r\n                <div className=\"flex justify-between mb-6\">\r\n                   <div className=\"relative w-96\">\r\n                     <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={18}/>\r\n                     <input type=\"text\" placeholder=\"Search medicines...\" className=\"w-full pl-10 p-2 border rounded-lg text-sm focus:ring-2 focus:ring-[#c5a059] outline-none\" value={inventorySearch} onChange={(e) => setInventorySearch(e.target.value)}/>\r\n                   </div>\r\n                   <div className=\"flex gap-2\">\r\n                     <button onClick={loadData} className=\"p-2 bg-white border rounded hover:bg-gray-50 text-gray-600\"><RefreshCw size={18}/></button>\r\n                     \r\n                     <button \r\n                        onClick={() => setShowLowStockOnly(!showLowStockOnly)}\r\n                        className={`p-2 border rounded flex items-center gap-2 text-sm font-bold transition ${showLowStockOnly ? 'bg-red-50 text-red-600 border-red-200' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\r\n                      >\r\n                        <Filter size={16}/> Low Stock\r\n                      </button>\r\n\r\n                     <button onClick={() => setIsAddModalOpen(true)} className=\"flex items-center gap-2 bg-[#1e3a29] text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-[#162b1e]\"><Plus size={16}/> Add New</button>\r\n                   </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\r\n                  <table className=\"w-full text-sm text-left\">\r\n                    <thead className=\"bg-[#1e3a29] text-white text-xs uppercase\">\r\n                      <tr>\r\n                        <th className=\"p-4 font-medium\">Name</th>\r\n                        <th className=\"p-4 font-medium\">Type</th>\r\n                        <th className=\"p-4 font-medium\">Stock / Min</th>\r\n                        <th className=\"p-4 font-medium\">Dates (Mfg / Exp)</th>\r\n                        <th className=\"p-4 font-medium\">Price (‚Çπ)</th>\r\n                        <th className=\"p-4 font-medium text-right\">Action</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-gray-100\">\r\n                      {filteredInventory.map((med) => (\r\n                        <InventoryRow \r\n                            key={med.id} \r\n                            med={med} \r\n                            editingId={editingId} \r\n                            editForm={editForm} \r\n                            setEditForm={setEditForm} \r\n                            handleEdit={handleEdit} \r\n                            saveEdit={saveEdit} \r\n                            handleDelete={handleDelete} \r\n                        />\r\n                      ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* ‚úÖ WALLET MODAL (CONSISTENT) */}\r\n            {showWalletModal && (\r\n                <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n                    <div className=\"bg-white rounded-xl shadow-xl w-full max-w-sm p-6 animate-in zoom-in-95\">\r\n                        <h3 className=\"text-lg font-bold text-[#1e3a29] mb-4 flex items-center gap-2\"><Wallet/> Manage Wallet</h3>\r\n                        <p className=\"text-sm text-gray-500 mb-4\">Update balance for {walletPatient?.name}</p>\r\n                        \r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Transaction Type</label>\r\n                                <select \r\n                                    className=\"w-full p-2 border rounded bg-gray-50 focus:ring-2 focus:ring-[#c5a059]\"\r\n                                    value={walletType}\r\n                                    onChange={(e) => setWalletType(e.target.value as \"CREDIT\" | \"DUE\")}\r\n                                >\r\n                                    <option value=\"CREDIT\">Credit (Deposit / Advance)</option>\r\n                                    <option value=\"DUE\">Due (Charge / Debt)</option>\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Amount (‚Çπ)</label>\r\n                                <input \r\n                                    type=\"number\" \r\n                                    placeholder=\"Enter Amount (e.g. 500)\" \r\n                                    className=\"w-full p-3 border rounded-lg text-lg font-bold mb-4 focus:ring-2 focus:ring-[#c5a059] outline-none\"\r\n                                    value={walletAmount}\r\n                                    onChange={(e) => setWalletAmount(e.target.value)}\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        \r\n                        <div className=\"flex gap-3 mt-4\">\r\n                            <button onClick={() => setShowWalletModal(false)} className=\"flex-1 py-2 text-gray-600 font-bold bg-gray-100 rounded-lg hover:bg-gray-200\">Cancel</button>\r\n                            <button \r\n                                onClick={handleWalletTransaction} \r\n                                className={`flex-1 py-2 text-white font-bold rounded-lg transition ${walletType === 'CREDIT' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'}`}\r\n                            >\r\n                                {walletType === 'CREDIT' ? 'Add Credit' : 'Add Due'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Add Medicine Modal & Walk In Modal */}\r\n             {isAddModalOpen && (\r\n              <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\r\n                <div className=\"bg-white rounded-xl p-8 w-[550px] shadow-2xl animate-in zoom-in\">\r\n                  <h2 className=\"text-xl font-bold mb-6 text-[#1e3a29]\">Add New Medicine</h2>\r\n                  {/* ... Add New Form ... */}\r\n                  <div className=\"space-y-4\">\r\n                    <div>\r\n                      <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Medicine Name</label>\r\n                      <input className=\"w-full p-2.5 border rounded text-sm focus:ring-2 focus:ring-[#c5a059] outline-none\" placeholder=\"e.g. Paracetamol\" value={newMed.name} onChange={e => setNewMed({...newMed, name: e.target.value})} />\r\n                    </div>\r\n                    \r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Type</label>\r\n                            <select className=\"w-full p-2.5 border rounded text-sm bg-white focus:ring-2 focus:ring-[#c5a059] outline-none\" value={newMed.type} onChange={e => setNewMed({...newMed, type: e.target.value})}>\r\n                               {MEDICINE_TYPES.map(t => <option key={t}>{t}</option>)}\r\n                            </select>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Initial Stock</label>\r\n                            <input className=\"w-full p-2.5 border rounded text-sm focus:ring-2 focus:ring-[#c5a059] outline-none\" type=\"number\" placeholder=\"0\" value={newMed.stock} onChange={e => setNewMed({...newMed, stock: e.target.value})} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Price (‚Çπ)</label>\r\n                            <input className=\"w-full p-2.5 border rounded text-sm focus:ring-2 focus:ring-[#c5a059] outline-none\" type=\"number\" placeholder=\"0\" value={newMed.price} onChange={e => setNewMed({...newMed, price: e.target.value})} />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase mb-1 text-red-500\">Min. Stock Alert</label>\r\n                            <input className=\"w-full p-2.5 border rounded text-sm focus:ring-2 focus:ring-red-300 outline-none\" type=\"number\" placeholder=\"10\" value={newMed.minStock} onChange={e => setNewMed({...newMed, minStock: e.target.value})} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 pt-2 border-t\">\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Mfg. Date</label>\r\n                            <input className=\"w-full p-2.5 border rounded text-sm focus:ring-2 focus:ring-[#c5a059] outline-none\" type=\"date\" value={newMed.mfgDate} onChange={e => setNewMed({...newMed, mfgDate: e.target.value})} />\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Exp. Date</label>\r\n                            <input className=\"w-full p-2.5 border rounded text-sm focus:ring-2 focus:ring-[#c5a059] outline-none\" type=\"date\" value={newMed.expDate} onChange={e => setNewMed({...newMed, expDate: e.target.value})} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-3 pt-6\">\r\n                      <button onClick={() => setIsAddModalOpen(false)} className=\"flex-1 bg-gray-100 text-gray-600 font-bold py-3 rounded-lg text-sm hover:bg-gray-200\">Cancel</button>\r\n                      <button onClick={handleAddNew} className=\"flex-1 bg-[#1e3a29] text-white font-bold py-3 rounded-lg text-sm hover:bg-[#162b1e]\">Create Item</button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {isWalkInModalOpen && (\r\n              <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\r\n                  <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-[80vh] flex overflow-hidden animate-in zoom-in-95\">\r\n                    {/* Walk-in Modal Content (Already correct in previous steps) */}\r\n                    <div className=\"w-1/2 border-r bg-gray-50 flex flex-col\">\r\n                        <div className=\"p-4 border-b bg-white\">\r\n                           <h3 className=\"font-bold text-lg text-[#1e3a29] mb-3\">Select Medicine</h3>\r\n                           <div className=\"relative\"><Search className=\"absolute left-3 top-2.5 text-gray-400\" size={18}/><input autoFocus type=\"text\" placeholder=\"Search to add...\" className=\"w-full pl-10 p-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none\" value={walkInSearch} onChange={(e) => setWalkInSearch(e.target.value)}/></div>\r\n                        </div>\r\n                        <div className=\"flex-1 overflow-y-auto p-2\">\r\n                           {inventory.filter(m => m.name.toLowerCase().includes(walkInSearch.toLowerCase())).slice(0, 20).map(med => (\r\n                              <button \r\n                                 key={med.id}\r\n                                 onClick={() => addToWalkInCart(med)}\r\n                                 className=\"w-full text-left p-3 mb-2 bg-white border rounded-lg hover:border-blue-500 hover:shadow-sm transition group\"\r\n                              >\r\n                                 <div className=\"flex justify-between\">\r\n                                    <span className=\"font-bold text-[#1e3a29]\">{med.name}</span>\r\n                                    <span className=\"text-xs bg-gray-100 px-2 py-1 rounded text-gray-600\">Stock: {med.stock}</span>\r\n                                 </div>\r\n                                 <div className=\"text-xs text-gray-500 mt-1 flex justify-between\">\r\n                                    <span>{med.type}</span>\r\n                                    <span className=\"font-bold text-green-600\">‚Çπ{med.price}</span>\r\n                                 </div>\r\n                              </button>\r\n                           ))}\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"w-1/2 flex flex-col bg-white\">\r\n                        <div className=\"p-4 border-b flex justify-between items-center bg-[#1e3a29] text-white\">\r\n                           <h3 className=\"font-bold text-lg\">Direct Sale (Walk-in)</h3>\r\n                           <button onClick={() => setIsWalkInModalOpen(false)} className=\"hover:text-red-300\"><X size={20}/></button>\r\n                        </div>\r\n                        <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n                           <div className=\"flex items-center gap-2 mb-2\"><input type=\"checkbox\" id=\"guestCheck\" checked={isGuest} onChange={(e) => { setIsGuest(e.target.checked); setWalkInDetails(prev => ({...prev, patientId: \"\", patientName: \"\"})); }} className=\"w-4 h-4 text-[#1e3a29] focus:ring-[#1e3a29] border-gray-300 rounded\"/><label htmlFor=\"guestCheck\" className=\"text-sm font-bold text-gray-600 select-none cursor-pointer\">Guest (Not a Patient)</label></div>\r\n                           {isGuest ? (\r\n                              <div className=\"flex items-center border rounded p-2 focus-within:ring-2 focus-within:ring-blue-500\"><User size={18} className=\"text-gray-400 mr-2\"/><input placeholder=\"Enter Guest Name *\" className=\"flex-1 text-sm outline-none\" value={walkInDetails.patientName} onChange={e => setWalkInDetails({...walkInDetails, patientName: e.target.value})} /></div>\r\n                           ) : (\r\n                              <div className=\"relative\" ref={patientSearchRef}>\r\n                                 <div className=\"flex items-center border rounded p-2 focus-within:ring-2 focus-within:ring-blue-500\"><Search size={18} className=\"text-gray-400 mr-2\"/><input placeholder=\"Search Patient Name *\" className=\"flex-1 text-sm outline-none\" value={walkInDetails.patientName} onChange={e => setWalkInDetails({...walkInDetails, patientName: e.target.value, patientId: \"\"})} /></div>\r\n                                 {showPatientSearch && patientSuggestions.length > 0 && (\r\n                                    <div className=\"absolute top-full left-0 w-full bg-white border shadow-lg rounded mt-1 z-50 max-h-40 overflow-y-auto\">{patientSuggestions.map(p => (<div key={p.id} onClick={() => selectPatient(p)} className=\"p-2 text-sm hover:bg-gray-100 cursor-pointer border-b\"><div className=\"font-bold text-[#1e3a29]\">{p.name}</div><div className=\"text-xs text-gray-500\">{p.phone}</div></div>))}</div>\r\n                                 )}\r\n                              </div>\r\n                           )}\r\n                           <input placeholder=\"Phone (Optional)\" className=\"w-full p-2 border rounded text-sm outline-none bg-gray-50\" value={walkInDetails.phone} onChange={e => setWalkInDetails({...walkInDetails, phone: e.target.value})} readOnly={!isGuest} />\r\n                           <div className=\"border rounded-lg overflow-hidden\">\r\n                              <table className=\"w-full text-sm\">\r\n                                 <thead className=\"bg-gray-100 text-xs uppercase text-gray-500\"><tr><th className=\"p-2 text-left\">Item</th><th className=\"p-2 w-16\">Qty</th><th className=\"p-2 text-right\">Total</th><th className=\"p-2 w-8\"></th></tr></thead>\r\n                                 <tbody className=\"divide-y\">\r\n                                    {walkInCart.length === 0 ? (<tr><td colSpan={4} className=\"p-8 text-center text-gray-400 italic\">Cart is empty</td></tr>) : (\r\n                                       walkInCart.map((item, idx) => (\r\n                                          <tr key={idx}><td className=\"p-2\"><div className=\"font-medium\">{item.name}</div><div className=\"text-[10px] text-gray-500\">‚Çπ{item.price}</div></td><td className=\"p-2\"><input type=\"number\" min=\"1\" className=\"w-12 p-1 border rounded text-center outline-none\" value={item.qty} onChange={(e) => updateWalkInQty(idx, e.target.value)}/></td><td className=\"p-2 text-right font-bold\">‚Çπ{item.price * item.qty}</td><td className=\"p-2 text-center\"><button onClick={() => removeFromWalkInCart(idx)} className=\"text-red-400 hover:text-red-600\"><Trash2 size={16}/></button></td></tr>\r\n                                       ))\r\n                                    )}\r\n                                 </tbody>\r\n                              </table>\r\n                           </div>\r\n                        </div>\r\n                        <div className=\"p-4 border-t bg-gray-50 space-y-3\">\r\n                           <div className=\"flex justify-between items-center text-sm\"><span className=\"font-bold text-gray-600\">Subtotal:</span><span>‚Çπ{walkInCart.reduce((acc, i) => acc + (i.price * i.qty), 0)}</span></div>\r\n                           <div className=\"flex justify-between items-center text-sm\"><span className=\"font-bold text-gray-600 flex items-center gap-1\"><BadgePercent size={14}/> Discount (%):</span><input type=\"number\" placeholder=\"0\" className=\"w-20 p-1 border rounded text-right outline-none\" value={walkInDetails.discount} onChange={e => setWalkInDetails({...walkInDetails, discount: e.target.value})}/></div>\r\n                           <div className=\"flex justify-between items-center text-lg font-bold text-[#1e3a29] border-t pt-2\"><span>Grand Total:</span><span>{(() => { const sub = walkInCart.reduce((acc, i) => acc + (i.price * i.qty), 0); const discPercent = parseFloat(walkInDetails.discount) || 0; const discAmount = (sub * discPercent) / 100; return `‚Çπ${(sub - discAmount).toFixed(0)}`; })()}</span></div>\r\n                           <button onClick={handleWalkInCheckout} className=\"w-full bg-[#1e3a29] text-white py-3 rounded-lg font-bold text-sm hover:bg-[#162b1e] transition shadow-md flex justify-center items-center gap-2\"><CheckCircle size={16}/> Complete Sale</button>\r\n                        </div>\r\n                    </div>\r\n                  </div>\r\n              </div>\r\n            )}\r\n\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\pharmacy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\pharmacy_actions_stub.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is assigned a value but never used.","line":6,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'limit' is assigned a value but never used.","line":6,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAll' is assigned a value but never used.","line":6,"column":84,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":91},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":11,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[356,359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[356,359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":15,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":15,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[455,458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[455,458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":19,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'itemId' is defined but never used.","line":27,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qty' is defined but never used.","line":27,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used.","line":31,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'start' is defined but never used.","line":31,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'end' is defined but never used.","line":31,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":35,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[915,918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[915,918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":39,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":43,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'patientId' is defined but never used.","line":43,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":47,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'discount' is defined but never used.","line":47,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":72},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'total' is defined but never used.","line":47,"column":82,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":87},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'paymentMode' is defined but never used.","line":47,"column":97,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":108},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used.","line":51,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1356,1359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1356,1359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// ==========================================\r\n// 3. üíä PHARMACY ACTIONS (STUBS/IMPLEMENTATION)\r\n// ==========================================\r\n\r\nexport async function getPharmacyInventory(query: string = \"\", limit: number = 50, showAll: boolean = false) {\r\n    // Stub: return empty list\r\n    return [];\r\n}\r\n\r\nexport async function createMedicine(data: any) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function updateMedicine(id: string, data: any) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function deleteMedicine(id: string) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function getPharmacyQueue() {\r\n    return [];\r\n}\r\n\r\nexport async function dispenseMedicine(itemId: string, qty: number) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function getDispensedHistory(query: string, start?: string, end?: string) {\r\n    return [];\r\n}\r\n\r\nexport async function savePrescription(data: any) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function reopenConsultation(id: string) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function deleteVisit(id: string, patientId: string) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function updateConsultationFinancials(id: string, discount: number, total: number, paymentMode: string) {\r\n    return { success: true };\r\n}\r\n\r\nexport async function createDirectSale(data: any) {\r\n    return { success: true };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\app\\reports\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used.","line":9,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":43,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FileText"},"fix":{"range":[278,288],"text":""},"desc":"Remove unused variable \"FileText\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Activity' is defined but never used.","line":9,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":69,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Activity"},"fix":{"range":[304,314],"text":""},"desc":"Remove unused variable \"Activity\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[556,559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[556,559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReports'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [dateRange, loadReports]","fix":{"range":[1356,1367],"text":"[dateRange, loadReports]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1733,1736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1733,1736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2031,2034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2031,2034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2328,2331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2328,2331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":333,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19686,19689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19686,19689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":387,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":387,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23286,23289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23286,23289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport StaffHeader from \"@/app/components/StaffHeader\";\r\nimport { \r\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend\r\n} from 'recharts';\r\nimport { \r\n  Download, Printer, IndianRupee, FileText, Loader2, Users, Activity, \r\n  Pill, Scale, X, Sparkles, Eye, Lock\r\n} from \"lucide-react\";\r\nimport { getReportData } from \"@/app/actions\";\r\n\r\nexport default function ReportsPage() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [data, setData] = useState<any>(null);\r\n  const [filter, setFilter] = useState<'ALL' | 'APPOINTMENT' | 'PHARMACY' | 'PANCHKARMA'>('ALL'); // ‚úÖ Added Panchkarma\r\n  \r\n  const [showWeightLossModal, setShowWeightLossModal] = useState(false);\r\n\r\n  // ‚úÖ Revenue Masking State\r\n  const [isRevenueVisible, setIsRevenueVisible] = useState(false);\r\n  const [pinInput, setPinInput] = useState(\"\");\r\n  const [showPinInput, setShowPinInput] = useState(false);\r\n\r\n  const today = new Date();\r\n  const firstDay = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];\r\n  const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0).toISOString().split('T')[0];\r\n\r\n  const [dateRange, setDateRange] = useState({\r\n    start: firstDay,\r\n    end: lastDay\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadReports();\r\n  }, [dateRange]);\r\n\r\n  const loadReports = async () => {\r\n    setLoading(true);\r\n    try {\r\n        const result = await getReportData(dateRange.start, dateRange.end);\r\n        setData(result);\r\n    } catch (e) {\r\n        console.error(\"Report Error\", e);\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n  };\r\n\r\n  const filteredTransactions = data?.rawTransactions.filter((t: any) => {\r\n      if (filter === 'ALL') return true;\r\n      return t.type === filter;\r\n  }) || [];\r\n\r\n  const handleExport = () => {\r\n    if (!data) return;\r\n    const headers = [\"Date\", \"Type\", \"Appt ID\", \"Patient Name\", \"Detail\", \"Amount (INR)\"];\r\n    const rows = filteredTransactions.map((item: any) => [\r\n        new Date(item.date).toLocaleDateString('en-GB'),\r\n        item.type,\r\n        item.appointmentId,\r\n        item.patient,\r\n        item.detail,\r\n        item.amount\r\n    ]);\r\n\r\n    const csvContent = \"data:text/csv;charset=utf-8,\" \r\n        + [headers.join(','), ...rows.map((r: any) => r.join(','))].join('\\n');\r\n\r\n    const encodedUri = encodeURI(csvContent);\r\n    const link = document.createElement(\"a\");\r\n    link.setAttribute(\"href\", encodedUri);\r\n    link.setAttribute(\"download\", `report_${filter}_${dateRange.start}.csv`);\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n\r\n  const handlePinCheck = (val: string) => {\r\n      setPinInput(val);\r\n      if (val === \"1989\") {\r\n          setIsRevenueVisible(true);\r\n          setShowPinInput(false);\r\n          setPinInput(\"\");\r\n      }\r\n  };\r\n\r\n  function RefreshCwIcon({size}:{size:number}) {\r\n    return <svg xmlns=\"http://www.w3.org/2000/svg\" width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\"/><path d=\"M21 3v5h-5\"/><path d=\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\"/><path d=\"M8 16H3v5\"/></svg>\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[#FDFBF7] flex flex-col font-sans text-neutral-800\">\r\n      <div className=\"print:hidden\">\r\n        <StaffHeader />\r\n      </div>\r\n\r\n      <div className=\"flex-1 p-8 max-w-7xl mx-auto w-full\">\r\n        {/* Header Controls */}\r\n        <div className=\"flex flex-col md:flex-row justify-between items-end md:items-center mb-8 gap-4 print:hidden\">\r\n           <div>\r\n              <h1 className=\"text-3xl font-serif font-bold text-[#1e3a29]\">Clinic Reports</h1>\r\n              <p className=\"text-gray-500 text-sm mt-1\">Analytics and performance overview.</p>\r\n           </div>\r\n\r\n           <div className=\"flex gap-2 items-center bg-white p-2 rounded-lg border shadow-sm\">\r\n              <div className=\"flex items-center gap-2 px-2\">\r\n                 <span className=\"text-xs font-bold text-gray-500 uppercase\">From</span>\r\n                 <input type=\"date\" className=\"text-sm outline-none bg-transparent\" value={dateRange.start} onChange={(e) => setDateRange({...dateRange, start: e.target.value})} />\r\n              </div>\r\n              <span className=\"text-gray-300\">|</span>\r\n              <div className=\"flex items-center gap-2 px-2\">\r\n                 <span className=\"text-xs font-bold text-gray-500 uppercase\">To</span>\r\n                 <input type=\"date\" className=\"text-sm outline-none bg-transparent\" value={dateRange.end} onChange={(e) => setDateRange({...dateRange, end: e.target.value})} />\r\n              </div>\r\n              <button onClick={loadReports} className=\"bg-[#1e3a29] text-white p-2 rounded hover:bg-[#162b1e] transition\">\r\n                 <RefreshCwIcon size={16}/>\r\n              </button>\r\n           </div>\r\n\r\n           <div className=\"flex gap-2\">\r\n              <button onClick={() => window.print()} className=\"flex items-center gap-2 bg-white border border-gray-300 px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-50\">\r\n                 <Printer size={16}/> Print\r\n              </button>\r\n              <button onClick={handleExport} className=\"flex items-center gap-2 bg-[#c5a059] text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-[#b08d4b]\">\r\n                 <Download size={16}/> Export CSV\r\n              </button>\r\n           </div>\r\n        </div>\r\n\r\n        {/* --- PRINT HEADER --- */}\r\n        <div className=\"hidden print:block mb-8 text-center border-b pb-4\">\r\n            <h1 className=\"text-2xl font-bold text-black\">RUDRA AYURVED - REPORT</h1>\r\n            <p className=\"text-sm text-gray-600\">\r\n               Period: {new Date(dateRange.start).toLocaleDateString('en-GB')} to {new Date(dateRange.end).toLocaleDateString('en-GB')}\r\n            </p>\r\n        </div>\r\n\r\n        {loading ? (\r\n           <div className=\"h-64 flex items-center justify-center text-[#c5a059]\">\r\n              <Loader2 className=\"animate-spin\" size={48} />\r\n           </div>\r\n        ) : data && (\r\n           <div className=\"space-y-8\">\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 print:grid-cols-4\">\r\n                 \r\n                 {/* ‚úÖ Total Revenue (Masked) */}\r\n                 <div \r\n                    onClick={() => setFilter('ALL')}\r\n                    className={`p-6 rounded-xl shadow-sm border cursor-pointer transition transform hover:scale-105 ${filter === 'ALL' ? 'bg-[#1e3a29] text-white border-[#1e3a29]' : 'bg-white border-gray-100 text-[#1e3a29]'}`}\r\n                 >\r\n                    <div className=\"flex justify-between items-start\">\r\n                       <div>\r\n                          <p className={`text-xs font-bold uppercase tracking-wider ${filter === 'ALL' ? 'text-white/70' : 'text-gray-400'}`}>Total Revenue</p>\r\n                          <div className=\"mt-1 flex items-center gap-2 h-8\">\r\n                             {isRevenueVisible ? (\r\n                                <h3 className=\"text-2xl font-bold\">‚Çπ {data.summary.totalRevenue.toLocaleString()}</h3>\r\n                             ) : (\r\n                                showPinInput ? (\r\n                                    <input \r\n                                        autoFocus\r\n                                        type=\"password\" \r\n                                        className=\"w-24 bg-white/20 border border-white/30 text-white rounded px-2 py-1 text-sm outline-none placeholder-white/50\"\r\n                                        placeholder=\"PIN\"\r\n                                        value={pinInput}\r\n                                        onChange={(e) => handlePinCheck(e.target.value)}\r\n                                        onBlur={() => setShowPinInput(false)}\r\n                                    />\r\n                                ) : (\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <h3 className=\"text-2xl font-bold\">****</h3>\r\n                                        <button onClick={(e) => { e.stopPropagation(); setShowPinInput(true); }} className=\"opacity-70 hover:opacity-100\"><Eye size={18}/></button>\r\n                                    </div>\r\n                                )\r\n                             )}\r\n                          </div>\r\n                       </div>\r\n                       <div className={`p-2 rounded-lg ${filter === 'ALL' ? 'bg-white/20' : 'bg-green-50 text-green-700'}`}>\r\n                           {isRevenueVisible ? <IndianRupee size={24}/> : <Lock size={24}/>}\r\n                       </div>\r\n                    </div>\r\n                 </div>\r\n\r\n                 {/* Appointments */}\r\n                 <div \r\n                    onClick={() => setFilter('APPOINTMENT')}\r\n                    className={`p-6 rounded-xl shadow-sm border cursor-pointer transition transform hover:scale-105 ${filter === 'APPOINTMENT' ? 'bg-[#c5a059] text-white border-[#c5a059]' : 'bg-white border-gray-100 text-[#1e3a29]'}`}\r\n                 >\r\n                    <div className=\"flex justify-between items-start\">\r\n                       <div>\r\n                          <p className={`text-xs font-bold uppercase tracking-wider ${filter === 'APPOINTMENT' ? 'text-white/70' : 'text-gray-400'}`}>Appointments</p>\r\n                          <h3 className=\"text-2xl font-bold mt-1\">{data.summary.totalPatients}</h3>\r\n                       </div>\r\n                       <div className={`p-2 rounded-lg ${filter === 'APPOINTMENT' ? 'bg-white/20' : 'bg-blue-50 text-blue-700'}`}><Users size={24}/></div>\r\n                    </div>\r\n                    <p className={`text-[10px] mt-2 ${filter === 'APPOINTMENT' ? 'text-white/80' : 'text-gray-400'}`}>\r\n                        {isRevenueVisible ? `‚Çπ ${data.summary.appointmentRevenue.toLocaleString()}` : '****'} Generated\r\n                    </p>\r\n                 </div>\r\n\r\n                 {/* Pharmacy */}\r\n                 <div \r\n                    onClick={() => setFilter('PHARMACY')}\r\n                    className={`p-6 rounded-xl shadow-sm border cursor-pointer transition transform hover:scale-105 ${filter === 'PHARMACY' ? 'bg-orange-600 text-white border-orange-600' : 'bg-white border-gray-100 text-[#1e3a29]'}`}\r\n                 >\r\n                    <div className=\"flex justify-between items-start\">\r\n                       <div>\r\n                          <p className={`text-xs font-bold uppercase tracking-wider ${filter === 'PHARMACY' ? 'text-white/70' : 'text-gray-400'}`}>Pharmacy Sales</p>\r\n                          <h3 className=\"text-2xl font-bold mt-1\">{data.summary.totalPrescriptions}</h3>\r\n                       </div>\r\n                       <div className={`p-2 rounded-lg ${filter === 'PHARMACY' ? 'bg-white/20' : 'bg-orange-50 text-orange-700'}`}><Pill size={24}/></div>\r\n                    </div>\r\n                    <p className={`text-[10px] mt-2 ${filter === 'PHARMACY' ? 'text-white/80' : 'text-gray-400'}`}>\r\n                        {isRevenueVisible ? `‚Çπ ${data.summary.pharmacyRevenue.toLocaleString()}` : '****'} Generated\r\n                    </p>\r\n                 </div>\r\n\r\n                 {/* ‚úÖ Panchkarma Card */}\r\n                 <div \r\n                    onClick={() => setFilter('PANCHKARMA')}\r\n                    className={`p-6 rounded-xl shadow-sm border cursor-pointer transition transform hover:scale-105 ${filter === 'PANCHKARMA' ? 'bg-purple-600 text-white border-purple-600' : 'bg-white border-gray-100 text-[#1e3a29]'}`}\r\n                 >\r\n                    <div className=\"flex justify-between items-start\">\r\n                       <div>\r\n                          <p className={`text-xs font-bold uppercase tracking-wider ${filter === 'PANCHKARMA' ? 'text-white/70' : 'text-gray-400'}`}>Panchkarma</p>\r\n                          <h3 className=\"text-sm font-bold mt-2 opacity-80\">Procedures</h3>\r\n                       </div>\r\n                       <div className={`p-2 rounded-lg ${filter === 'PANCHKARMA' ? 'bg-white/20' : 'bg-purple-50 text-purple-700'}`}><Sparkles size={24}/></div>\r\n                    </div>\r\n                    <p className={`text-[10px] mt-2 ${filter === 'PANCHKARMA' ? 'text-white/80' : 'text-gray-400'}`}>\r\n                        {isRevenueVisible ? `‚Çπ ${data.summary.panchkarmaRevenue.toLocaleString()}` : '****'} Generated\r\n                    </p>\r\n                 </div>\r\n\r\n                 {/* Weight Loss Card */}\r\n                 <div \r\n                    onClick={() => setShowWeightLossModal(true)}\r\n                    className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100 cursor-pointer transition transform hover:scale-105 hover:shadow-md\"\r\n                 >\r\n                    <div className=\"flex justify-between items-start mb-3\">\r\n                       <div>\r\n                          <p className=\"text-xs font-bold text-gray-400 uppercase tracking-wider\">Total Weight Loss</p>\r\n                          <h3 className=\"text-2xl font-bold mt-1 text-[#1e3a29]\">{data.summary.totalWeightLoss?.toFixed(1) || 0} <span className=\"text-sm font-normal text-gray-500\">kg</span></h3>\r\n                       </div>\r\n                       <div className=\"p-2 bg-pink-50 text-pink-700 rounded-lg\"><Scale size={24}/></div>\r\n                    </div>\r\n                    \r\n                    {/* Gender Breakdown */}\r\n                    <div className=\"space-y-2 mt-2\">\r\n                       <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-[10px] font-bold text-blue-600 w-8\">Male</span>\r\n                          <div className=\"flex-1 h-1.5 bg-gray-100 rounded-full overflow-hidden\">\r\n                             <div className=\"h-full bg-blue-500\" style={{ width: `${data.summary.totalWeightLoss > 0 ? (data.summary.weightLossByGender?.Male / data.summary.totalWeightLoss) * 100 : 0}%` }}></div>\r\n                          </div>\r\n                          <span className=\"text-[10px] font-bold text-gray-600\">{data.summary.weightLossByGender?.Male?.toFixed(1) || 0}</span>\r\n                       </div>\r\n                       <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-[10px] font-bold text-pink-600 w-8\">Fem</span>\r\n                          <div className=\"flex-1 h-1.5 bg-gray-100 rounded-full overflow-hidden\">\r\n                             <div className=\"h-full bg-pink-500\" style={{ width: `${data.summary.totalWeightLoss > 0 ? (data.summary.weightLossByGender?.Female / data.summary.totalWeightLoss) * 100 : 0}%` }}></div>\r\n                          </div>\r\n                          <span className=\"text-[10px] font-bold text-gray-600\">{data.summary.weightLossByGender?.Female?.toFixed(1) || 0}</span>\r\n                       </div>\r\n                    </div>\r\n                 </div>\r\n              </div>\r\n\r\n              {/* Charts Row */}\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 print:break-inside-avoid\">\r\n                 <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80\">\r\n                    <h3 className=\"font-bold text-[#1e3a29] mb-4\">Revenue Overview (Daily Breakdown)</h3>\r\n                    {isRevenueVisible ? (\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <BarChart data={data.charts.revenueOverTime}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} />\r\n                                <XAxis dataKey=\"date\" tickFormatter={(str) => new Date(str).getDate().toString()} tick={{fontSize: 12}} />\r\n                                <YAxis tick={{fontSize: 12}} />\r\n                                <Tooltip \r\n                                    contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)'}}\r\n                                    labelFormatter={(label) => new Date(label).toLocaleDateString('en-GB')} \r\n                                />\r\n                                <Legend />\r\n                                <Bar dataKey=\"appointment\" name=\"Appointments\" stackId=\"a\" fill=\"#c5a059\" radius={[0, 0, 0, 0]} barSize={20} />\r\n                                <Bar dataKey=\"pharmacy\" name=\"Pharmacy\" stackId=\"a\" fill=\"#1e3a29\" radius={[0, 0, 0, 0]} barSize={20} />\r\n                                <Bar dataKey=\"panchkarma\" name=\"Panchkarma\" stackId=\"a\" fill=\"#9333ea\" radius={[4, 4, 0, 0]} barSize={20} />\r\n                            </BarChart>\r\n                        </ResponsiveContainer>\r\n                    ) : (\r\n                        <div className=\"h-full flex items-center justify-center text-gray-400 flex-col gap-2\">\r\n                            <Lock size={32}/>\r\n                            <p className=\"text-sm\">Revenue chart is locked</p>\r\n                        </div>\r\n                    )}\r\n                 </div>\r\n\r\n                 <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100 h-80\">\r\n                    <h3 className=\"font-bold text-[#1e3a29] mb-4\">Top 5 Selling Medicines</h3>\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                       <BarChart layout=\"vertical\" data={data.charts.topMedicines} margin={{left: 20}}>\r\n                          <CartesianGrid strokeDasharray=\"3 3\" horizontal={false} />\r\n                          <XAxis type=\"number\" hide />\r\n                          <YAxis dataKey=\"name\" type=\"category\" width={100} tick={{fontSize: 11}} />\r\n                          <Tooltip cursor={{fill: 'transparent'}} />\r\n                          <Bar dataKey=\"count\" fill=\"#E86C42\" radius={[0, 4, 4, 0]} barSize={20} label={{ position: 'right', fill: '#666', fontSize: 12 }}/>\r\n                       </BarChart>\r\n                    </ResponsiveContainer>\r\n                 </div>\r\n              </div>\r\n\r\n              {/* Transactions Table */}\r\n              <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print:shadow-none print:border\">\r\n                 <div className=\"px-6 py-4 border-b bg-gray-50 flex justify-between items-center\">\r\n                    <h3 className=\"font-bold text-[#1e3a29]\">\r\n                       {filter === 'ALL' ? 'All Transactions' : filter === 'PHARMACY' ? 'Pharmacy Sales' : filter === 'PANCHKARMA' ? 'Panchkarma Procedures' : 'Appointment History'}\r\n                    </h3>\r\n                    <span className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full\">{filteredTransactions.length} records</span>\r\n                 </div>\r\n                 <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm text-left\">\r\n                       <thead className=\"bg-[#1e3a29] text-white text-xs uppercase\">\r\n                          <tr>\r\n                             <th className=\"p-3\">Date</th>\r\n                             <th className=\"p-3\">Type</th>\r\n                             <th className=\"p-3\">Appt ID</th>\r\n                             <th className=\"p-3\">Patient</th>\r\n                             <th className=\"p-3\">Detail</th>\r\n                             <th className=\"p-3 text-right\">Amount</th>\r\n                          </tr>\r\n                       </thead>\r\n                       <tbody className=\"divide-y divide-gray-100\">\r\n                          {filteredTransactions.map((item: any) => (\r\n                             <tr key={item.id} className=\"hover:bg-gray-50\">\r\n                                <td className=\"p-3 text-gray-500\">\r\n                                   {new Date(item.date).toLocaleDateString('en-GB')} \r\n                                   <span className=\"block text-[10px]\">{new Date(item.date).toLocaleTimeString()}</span>\r\n                                </td>\r\n                                <td className=\"p-3\">\r\n                                   <span className={`text-[10px] font-bold px-2 py-1 rounded ${item.type === 'APPOINTMENT' ? 'bg-blue-100 text-blue-700' : item.type === 'PANCHKARMA' ? 'bg-purple-100 text-purple-700' : 'bg-orange-100 text-orange-700'}`}>\r\n                                      {item.type}\r\n                                   </span>\r\n                                </td>\r\n                                <td className=\"p-3 font-mono text-xs text-gray-600\">\r\n                                   {item.appointmentId}\r\n                                </td>\r\n                                <td className=\"p-3 font-medium text-[#1e3a29]\">{item.patient}</td>\r\n                                <td className=\"p-3 text-gray-600\">{item.detail}</td>\r\n                                <td className=\"p-3 text-right font-bold text-[#1e3a29]\">\r\n                                    {isRevenueVisible ? `‚Çπ ${item.amount}` : '****'}\r\n                                </td>\r\n                             </tr>\r\n                          ))}\r\n                          {filteredTransactions.length === 0 && (\r\n                             <tr><td colSpan={6} className=\"p-8 text-center text-gray-400\">No records found for this category.</td></tr>\r\n                          )}\r\n                       </tbody>\r\n                    </table>\r\n                 </div>\r\n              </div>\r\n\r\n           </div>\r\n        )}\r\n\r\n        {/* Weight Loss Modal */}\r\n        {showWeightLossModal && data && (\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\">\r\n                <div className=\"bg-white rounded-xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col animate-in zoom-in-95\">\r\n                    <div className=\"bg-[#1e3a29] p-4 flex justify-between items-center text-white rounded-t-xl shrink-0\">\r\n                        <h3 className=\"font-bold text-lg flex items-center gap-2\">\r\n                           <Scale size={20}/> Weight Loss Achievers\r\n                        </h3>\r\n                        <button onClick={() => setShowWeightLossModal(false)} className=\"hover:text-red-300\"><X size={24}/></button>\r\n                    </div>\r\n                    <div className=\"p-4 flex-1 overflow-y-auto\">\r\n                        {data.weightLossPatients && data.weightLossPatients.length > 0 ? (\r\n                            <table className=\"w-full text-sm\">\r\n                                <thead className=\"bg-gray-100 text-xs uppercase text-gray-600 sticky top-0\">\r\n                                    <tr>\r\n                                        <th className=\"p-3 text-left\">Patient</th>\r\n                                        <th className=\"p-3 text-center\">Initial</th>\r\n                                        <th className=\"p-3 text-center\">Current</th>\r\n                                        <th className=\"p-3 text-right\">Lost</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y\">\r\n                                    {data.weightLossPatients.map((p: any) => (\r\n                                        <tr key={p.id}>\r\n                                            <td className=\"p-3\">\r\n                                                <div className=\"font-bold text-[#1e3a29]\">{p.name}</div>\r\n                                                <div className=\"text-xs text-gray-500\">{p.readableId}</div>\r\n                                            </td>\r\n                                            <td className=\"p-3 text-center text-gray-600\">{p.initial}</td>\r\n                                            <td className=\"p-3 text-center text-gray-600\">{p.current}</td>\r\n                                            <td className=\"p-3 text-right font-bold text-green-600\">-{p.loss} kg</td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        ) : (\r\n                            <p className=\"text-center text-gray-400 py-10\">No weight loss records found.</p>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"p-4 border-t text-center text-xs text-gray-500\">\r\n                        Total Weight Lost: <span className=\"font-bold text-[#1e3a29]\">{data.summary.totalWeightLoss?.toFixed(1)} kg</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )}\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\components\\AppointmentModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":6,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Search"},"fix":{"range":[135,143],"text":""},"desc":"Remove unused variable \"Search\"."}]},{"ruleId":"prefer-const","severity":2,"message":"'minutes' is never reassigned. Use 'const' instead.","line":14,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":14,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'m' is assigned a value but never used.","line":25,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":10},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1896,1899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1896,1899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1926,1929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1926,1929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2998,3001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2998,3001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Gaurav\\rudra-ayurved\\components\\AppointmentModal.tsx:88:7\n  86 |   useEffect(() => {\n  87 |     if (isOpen) {\n> 88 |       setIsRecurring(false);\n     |       ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  89 |       setRecurringCount(\"3\");\n  90 |       setFrequency(\"daily\");\n  91 |       setCustomDates([]);","line":88,"column":7,"nodeType":null,"endLine":88,"endColumn":21},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Gaurav\\rudra-ayurved\\components\\AppointmentModal.tsx:153:9\n  151 |\n  152 |       if (needed > customDates.length) {\n> 153 |         setCustomDates(prev => [...prev, ...Array(needed - prev.length).fill(\"\")]);\n      |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  154 |       } else if (needed < customDates.length) {\n  155 |         setCustomDates(prev => prev.slice(0, needed));\n  156 |       }","line":153,"column":9,"nodeType":null,"endLine":153,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'customDates.length'. Either include it or remove the dependency array.","line":158,"column":6,"nodeType":"ArrayExpression","endLine":158,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [recurringCount, frequency, customDates.length]","fix":{"range":[5652,5679],"text":"[recurringCount, frequency, customDates.length]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5900,5903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5900,5903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport {\r\n  X, Ban, Search, Loader2, Stethoscope, Repeat, User, Phone\r\n} from \"lucide-react\";\r\nimport { searchPatients } from \"@/app/actions\";\r\n\r\n// ‚úÖ HELPER: Convert 12h to 24h for internal state logic\r\nconst to24h = (time12h: string) => {\r\n  if (!time12h) return \"\";\r\n  const [time, modifier] = time12h.split(' ');\r\n  let [hours, minutes] = time.split(':');\r\n  if (hours === '12') hours = '00';\r\n  if (modifier === 'PM') hours = (parseInt(hours, 10) + 12).toString();\r\n  return `${hours.padStart(2, '0')}:${minutes}`;\r\n};\r\n\r\n// ‚úÖ HELPER: Convert 24h to 12h for saving/display\r\nconst to12h = (time24h: string) => {\r\n  if (!time24h) return \"\";\r\n  const [hours, minutes] = time24h.split(':');\r\n  const h = parseInt(hours, 10);\r\n  const m = parseInt(minutes, 10);\r\n  const suffix = h >= 12 ? 'PM' : 'AM';\r\n  const adjustedH = h % 12 || 12;\r\n  return `${adjustedH.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')} ${suffix}`;\r\n};\r\n\r\nconst generateTimeSlots = () => {\r\n  const slots = [];\r\n  const startHour = 7;\r\n  const endHour = 20;\r\n  for (let h = startHour; h <= endHour; h++) {\r\n    for (let m = 0; m < 60; m += 10) {\r\n      if (h === endHour && m > 0) break;\r\n      const date = new Date();\r\n      date.setHours(h, m);\r\n\r\n      const value = date.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });\r\n      const label = date.toLocaleTimeString('en-US', { hour12: true, hour: '2-digit', minute: '2-digit' });\r\n\r\n      slots.push({ value, label });\r\n    }\r\n  }\r\n  return slots;\r\n};\r\nconst TIME_SLOTS = generateTimeSlots();\r\n\r\ninterface AppointmentModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  initialData: { date?: string; startTime?: string; patientName?: string; phone?: string } | null;\r\n  existingAppointment: any | null;\r\n  onSave: (data: any) => void;\r\n  onDelete: (id: string) => void;\r\n}\r\n\r\nexport default function AppointmentModal({\r\n  isOpen, onClose, initialData, existingAppointment, onSave, onDelete\r\n}: AppointmentModalProps) {\r\n\r\n  const router = useRouter();\r\n  const searchRef = useRef<HTMLDivElement>(null);\r\n\r\n  const [patientName, setPatientName] = useState(\"\");\r\n  const [patientId, setPatientId] = useState<string | null>(null);\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [doctor, setDoctor] = useState(\"Dr. Chirag Raval\");\r\n  const [type, setType] = useState(\"Consultation\");\r\n  const [date, setDate] = useState(\"\");\r\n\r\n  const [startTime, setStartTime] = useState(\"10:00\");\r\n  const [endTime, setEndTime] = useState(\"10:10\");\r\n\r\n  const [isRecurring, setIsRecurring] = useState(false);\r\n  const [recurringCount, setRecurringCount] = useState(\"3\");\r\n  const [frequency, setFrequency] = useState(\"daily\");\r\n  const [customDates, setCustomDates] = useState<string[]>([]);\r\n\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const [searchResults, setSearchResults] = useState<any[]>([]);\r\n  const [showResults, setShowResults] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setIsRecurring(false);\r\n      setRecurringCount(\"3\");\r\n      setFrequency(\"daily\");\r\n      setCustomDates([]);\r\n\r\n      if (existingAppointment) {\r\n        setPatientName(existingAppointment.patientName || \"\");\r\n        setPatientId(existingAppointment.patientId || null);\r\n        setPhone(existingAppointment.phone || \"\");\r\n        setDoctor(existingAppointment.doctor || \"Dr. Chirag Raval\");\r\n        setType(existingAppointment.type || \"Consultation\");\r\n\r\n        // ‚úÖ Ensure date is a valid string\r\n        const aptDate = existingAppointment.date ? existingAppointment.date.toString().split('T')[0] : \"\";\r\n        setDate(aptDate);\r\n\r\n        setStartTime(to24h(existingAppointment.startTime || \"10:00 AM\"));\r\n        setEndTime(to24h(existingAppointment.endTime || \"10:10 AM\"));\r\n\r\n      } else if (initialData) {\r\n        setPatientName(initialData.patientName || \"\");\r\n        setPatientId(null);\r\n        setPhone(initialData.phone || \"\");\r\n        setDoctor(\"Dr. Chirag Raval\");\r\n        setType(\"Consultation\");\r\n        setDate(initialData.date || \"\");\r\n\r\n        const start24 = to24h(initialData.startTime || \"10:00 AM\");\r\n        setStartTime(start24);\r\n\r\n        const startIndex = TIME_SLOTS.findIndex(s => s.value === start24);\r\n        if (startIndex !== -1 && startIndex < TIME_SLOTS.length - 1) {\r\n          setEndTime(TIME_SLOTS[startIndex + 1].value);\r\n        } else {\r\n          setEndTime(start24);\r\n        }\r\n      }\r\n      setSearchResults([]);\r\n      setShowResults(false);\r\n    }\r\n  }, [isOpen, initialData, existingAppointment]);\r\n\r\n  useEffect(() => {\r\n    const delayDebounceFn = setTimeout(async () => {\r\n      if (patientName.length > 1 && !patientId && !existingAppointment) {\r\n        setIsSearching(true);\r\n        const results = await searchPatients(patientName);\r\n        setSearchResults(results);\r\n        setIsSearching(false);\r\n        if (results.length > 0) setShowResults(true);\r\n      } else {\r\n        setSearchResults([]);\r\n        setShowResults(false);\r\n      }\r\n    }, 300);\r\n\r\n    return () => clearTimeout(delayDebounceFn);\r\n  }, [patientName, patientId, existingAppointment]);\r\n\r\n  useEffect(() => {\r\n    if (frequency === 'custom') {\r\n      const count = parseInt(recurringCount) || 1;\r\n      const needed = count - 1;\r\n\r\n      if (needed > customDates.length) {\r\n        setCustomDates(prev => [...prev, ...Array(needed - prev.length).fill(\"\")]);\r\n      } else if (needed < customDates.length) {\r\n        setCustomDates(prev => prev.slice(0, needed));\r\n      }\r\n    }\r\n  }, [recurringCount, frequency]);\r\n\r\n  const handleCustomDateChange = (index: number, val: string) => {\r\n    const newDates = [...customDates];\r\n    newDates[index] = val;\r\n    setCustomDates(newDates);\r\n  };\r\n\r\n  const handleSelectPatient = (patient: any) => {\r\n    setPatientName(patient.name);\r\n    setPhone(patient.phone);\r\n    setPatientId(patient.id);\r\n    setShowResults(false);\r\n  };\r\n\r\n  const handleNameChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setPatientName(e.target.value);\r\n    setPatientId(null);\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (startTime >= endTime) {\r\n      alert(\"End time must be after start time.\");\r\n      return;\r\n    }\r\n\r\n    const recurringData = isRecurring ? {\r\n      count: parseInt(recurringCount) || 1,\r\n      frequency: frequency,\r\n      customDates: frequency === 'custom' ? customDates : undefined\r\n    } : undefined;\r\n\r\n    onSave({\r\n      id: existingAppointment?.id || undefined,\r\n      patientName: type === 'Unavailable' ? 'BLOCKED' : patientName,\r\n      phone: type === 'Unavailable' ? '-' : phone,\r\n      doctor,\r\n      type,\r\n      date,\r\n      startTime: to12h(startTime),\r\n      endTime: to12h(endTime),\r\n      patientId: patientId,\r\n      recurring: recurringData\r\n    });\r\n    onClose();\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (confirm(\"Delete this entry?\")) {\r\n      if (existingAppointment?.id) onDelete(existingAppointment.id);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleVisitProfile = () => {\r\n    if (patientId) {\r\n      const query = existingAppointment?.readableId || existingAppointment?.id;\r\n      const url = query ? `/patients/${patientId}?appointmentId=${query}` : `/patients/${patientId}`;\r\n      router.push(url);\r\n      onClose();\r\n    } else {\r\n      alert(\"Please click 'Confirm' to save the appointment first.\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (searchRef.current && !searchRef.current.contains(event.target as Node)) {\r\n        setShowResults(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n      <div className={`rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200 ${type === 'Unavailable' ? 'bg-gray-50' : 'bg-white'}`}>\r\n\r\n        <div className={`p-4 flex justify-between items-center text-white ${type === 'Unavailable' ? 'bg-gray-600' : 'bg-[#1e3a29]'}`}>\r\n          <h3 className=\"font-serif text-xl font-bold flex items-center gap-2\">\r\n            {type === 'Unavailable' && <Ban size={20} />}\r\n            {existingAppointment ? \"Edit Details\" : \"New Entry\"}\r\n          </h3>\r\n          <button onClick={onClose} className=\"hover:text-[#c5a059] transition\"><X size={24} /></button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-4 max-h-[80vh] overflow-y-auto\">\r\n\r\n          <div>\r\n            <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Entry Type</label>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              {['Consultation', 'Panchkarma-1', 'Panchkarma-2', 'Panchkarma-3', 'Unavailable'].map((t) => (\r\n                <button\r\n                  key={t}\r\n                  type=\"button\"\r\n                  onClick={() => setType(t)}\r\n                  className={`py-2 text-xs font-medium rounded-md border transition ${type === t\r\n                      ? (t === 'Unavailable' ? 'bg-gray-600 text-white border-gray-600' : 'bg-[#1e3a29] text-white border-[#1e3a29]')\r\n                      : 'bg-white text-gray-600 hover:bg-gray-50 border-gray-200'\r\n                    }`}\r\n                >\r\n                  {t}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Date</label>\r\n              <input type=\"date\" required className=\"w-full p-2 border rounded text-sm\" value={date} onChange={(e) => setDate(e.target.value)} />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Time</label>\r\n              <div className=\"flex gap-1\">\r\n                <select className=\"w-full p-2 border rounded text-sm\" value={startTime} onChange={(e) => setStartTime(e.target.value)}>\r\n                  {TIME_SLOTS.map(t => <option key={t.value} value={t.value}>{t.label}</option>)}\r\n                </select>\r\n                <span className=\"self-center\">-</span>\r\n                <select className=\"w-full p-2 border rounded text-sm\" value={endTime} onChange={(e) => setEndTime(e.target.value)}>\r\n                  {TIME_SLOTS.map(t => (\r\n                    t.value > startTime && <option key={t.value} value={t.value}>{t.label}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {!existingAppointment && type !== 'Unavailable' && (\r\n            <div className=\"bg-gray-50 p-3 rounded-lg border border-gray-200 transition-all\">\r\n              <div className=\"flex items-center gap-2 mb-2\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"repeat\"\r\n                  checked={isRecurring}\r\n                  onChange={(e) => setIsRecurring(e.target.checked)}\r\n                  className=\"w-4 h-4 text-[#c5a059] focus:ring-[#c5a059] border-gray-300 rounded cursor-pointer\"\r\n                />\r\n                <label htmlFor=\"repeat\" className=\"text-sm font-bold text-gray-700 flex items-center gap-2 cursor-pointer select-none\">\r\n                  <Repeat size={14} className=\"text-[#c5a059]\" /> Repeat Appointment\r\n                </label>\r\n              </div>\r\n\r\n              {isRecurring && (\r\n                <div className=\"animate-in slide-in-from-top-1 pl-6 space-y-3\">\r\n                  <div className=\"grid grid-cols-2 gap-3\">\r\n                    <div>\r\n                      <label className=\"block text-[10px] font-bold uppercase text-gray-400 mb-1\">Frequency</label>\r\n                      <select className=\"w-full p-1.5 border rounded text-sm bg-white\" value={frequency} onChange={(e) => setFrequency(e.target.value)}>\r\n                        <option value=\"daily\">Daily</option>\r\n                        <option value=\"weekly\">Weekly</option>\r\n                        <option value=\"biweekly\">Bi-Weekly</option>\r\n                        <option value=\"monthly\">Monthly</option>\r\n                        <option value=\"custom\">Custom Dates</option>\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"block text-[10px] font-bold uppercase text-gray-400 mb-1\">Total Sessions</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        min=\"2\" max=\"30\"\r\n                        className=\"w-full p-1.5 border rounded text-sm bg-white\"\r\n                        value={recurringCount}\r\n                        onChange={(e) => setRecurringCount(e.target.value)}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  {frequency === 'custom' && (\r\n                    <div className=\"space-y-2 mt-2\">\r\n                      <p className=\"text-[10px] font-bold uppercase text-gray-400\">Select Additional Dates:</p>\r\n                      <div className=\"max-h-32 overflow-y-auto space-y-2 pr-1 custom-scrollbar\">\r\n                        {customDates.map((d, i) => (\r\n                          <div key={i} className=\"flex items-center gap-2\">\r\n                            <span className=\"text-xs font-mono text-gray-500 w-6\">#{i + 2}</span>\r\n                            <input\r\n                              type=\"date\"\r\n                              className=\"flex-1 p-1 border rounded text-xs bg-white\"\r\n                              value={d}\r\n                              onChange={(e) => handleCustomDateChange(i, e.target.value)}\r\n                              required\r\n                            />\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {type !== 'Unavailable' && (\r\n            <>\r\n              <div className=\"relative\" ref={searchRef}>\r\n                <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Patient Name</label>\r\n                <div className=\"relative\">\r\n                  <User className=\"absolute left-3 top-2.5 text-gray-400\" size={16} />\r\n                  <input\r\n                    type=\"text\"\r\n                    required\r\n                    placeholder=\"Search or Enter Full Name\"\r\n                    className=\"w-full p-2 pl-9 border rounded text-sm focus:border-[#c5a059] outline-none\"\r\n                    value={patientName}\r\n                    onChange={handleNameChange}\r\n                    onFocus={() => { if (patientName.length > 1) setShowResults(true) }}\r\n                  />\r\n                  {isSearching && <Loader2 className=\"absolute right-3 top-2.5 animate-spin text-[#c5a059]\" size={16} />}\r\n                </div>\r\n\r\n                {showResults && searchResults.length > 0 && (\r\n                  <div className=\"absolute top-full mt-1 left-0 w-full bg-white border border-gray-200 rounded-md shadow-lg max-h-48 overflow-y-auto z-50\">\r\n                    {searchResults.map((p) => (\r\n                      <button\r\n                        key={p.id}\r\n                        type=\"button\"\r\n                        onClick={() => handleSelectPatient(p)}\r\n                        className=\"w-full text-left px-3 py-2 text-sm hover:bg-green-50 border-b last:border-0 flex justify-between items-center group\"\r\n                      >\r\n                        <div>\r\n                          <span className=\"font-bold text-[#1e3a29] block\">{p.name}</span>\r\n                          <span className=\"text-xs text-gray-500\">{p.phone}</span>\r\n                        </div>\r\n                        {p.readableId && (\r\n                          <span className=\"text-[10px] bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded group-hover:bg-[#c5a059] group-hover:text-white transition\">\r\n                            {p.readableId}\r\n                          </span>\r\n                        )}\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">WhatsApp <span className=\"text-red-500\">*</span></label>\r\n                <div className=\"relative\">\r\n                  <Phone className=\"absolute left-3 top-2.5 text-gray-400\" size={16} />\r\n                  <input\r\n                    type=\"tel\"\r\n                    required\r\n                    placeholder=\"+91...\"\r\n                    className=\"w-full p-2 pl-9 border rounded text-sm\"\r\n                    value={phone}\r\n                    onChange={(e) => setPhone(e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-bold uppercase text-gray-500 mb-1\">Doctor</label>\r\n                <select className=\"w-full p-2 border rounded text-sm\" value={doctor} onChange={(e) => setDoctor(e.target.value)}>\r\n                  <option>Dr. Chirag Raval</option>\r\n                  <option>Dr. Dipal Raval</option>\r\n                </select>\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          <div className=\"flex gap-3 mt-4 pt-2 border-t\">\r\n            {patientId && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleVisitProfile}\r\n                className=\"flex-1 bg-blue-50 text-blue-600 font-bold py-2 rounded hover:bg-blue-100 text-sm flex items-center justify-center border border-blue-200\"\r\n              >\r\n                {existingAppointment ? <Stethoscope size={16} className=\"mr-2\" /> : <User size={16} className=\"mr-2\" />}\r\n                {existingAppointment ? \"Start Consult\" : \"View Profile\"}\r\n              </button>\r\n            )}\r\n\r\n            {existingAppointment && (\r\n              <button type=\"button\" onClick={handleDelete} className=\"flex-1 bg-red-50 text-red-600 font-bold py-2 rounded hover:bg-red-100 text-sm\">\r\n                Delete\r\n              </button>\r\n            )}\r\n\r\n            <button type=\"submit\" className={`flex-[2] text-white font-bold py-2 rounded text-sm shadow-md ${type === 'Unavailable' ? 'bg-gray-600 hover:bg-gray-700' : 'bg-[#c5a059] hover:bg-[#b08d4b] text-[#1e3a29]'}`}>\r\n              {existingAppointment ? \"Update\" : (type === 'Unavailable' ? \"Block Time\" : \"Confirm\")}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\lib\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[294,297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[294,297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[509,512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[509,512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":23,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[916,919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[916,919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SignJWT, jwtVerify } from \"jose\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nconst secretKey = process.env.SESSION_SECRET || \"rudra-ayurved-secret-key\";\r\nconst key = new TextEncoder().encode(secretKey);\r\n\r\n// --- 1. CORE CRYPTO FUNCTIONS ---\r\n\r\nexport async function encrypt(payload: any) {\r\n  return await new SignJWT(payload)\r\n    .setProtectedHeader({ alg: \"HS256\" })\r\n    .setIssuedAt()\r\n    .setExpirationTime(\"24h\")\r\n    .sign(key);\r\n}\r\n\r\nexport async function decrypt(input: string): Promise<any> {\r\n  try {\r\n    const { payload } = await jwtVerify(input, key, {\r\n      algorithms: [\"HS256\"],\r\n    });\r\n    return payload;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ‚úÖ FIXED: Re-added this function for middleware.ts\r\nexport async function verifySession(token: string) {\r\n  return await decrypt(token);\r\n}\r\n\r\n// --- 2. SESSION MANAGEMENT ---\r\n\r\nexport async function createSession(payload: any) {\r\n  const expires = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\r\n  const session = await encrypt({ ...payload, expires });\r\n\r\n  const cookieStore = await cookies();\r\n  cookieStore.set(\"session\", session, { \r\n    expires, \r\n    httpOnly: true, \r\n    secure: process.env.NODE_ENV === \"production\",\r\n    sameSite: \"lax\",\r\n    path: \"/\",\r\n  });\r\n}\r\n\r\nexport async function getSession() {\r\n  const cookieStore = await cookies();\r\n  const session = cookieStore.get(\"session\")?.value;\r\n  if (!session) return null;\r\n  return await decrypt(session);\r\n}\r\n\r\nexport async function logout() {\r\n  const cookieStore = await cookies();\r\n  cookieStore.set(\"session\", \"\", { expires: new Date(0) });\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\lib\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\prisma.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Gaurav\\rudra-ayurved\\utils\\timeSlots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]