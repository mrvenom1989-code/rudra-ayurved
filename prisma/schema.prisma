// FINAL COMPLETE SCHEMA

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. DOCTOR / USER
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   
  name      String
  role      String   @default("DOCTOR") 
  specialty String?  
}

// 2. PATIENT
model Patient {
  id             String   @id @default(cuid())
  readableId     String   @unique 
  name           String
  phone          String
  age            Int?
  gender         String?
  bloodGroup     String?
  prakriti       String?
  initialWeight String?
  currentWeight String?
  history        String?  

  // âœ… NEW FIELDS
  chiefComplaints    String?
  kco                String?  
  currentMedications String?
  investigations     String?
  pastHistory        String?
  familyHistory      String?
  mentalGenerals     String?
  obsGynHistory      String?
  physicalGenerals   String?  

  // ðŸ’° WALLET / ADVANCE SYSTEM
  // Positive = Advance (Patient has money with us)
  // Negative = Due (Patient owes us)
  walletBalance      Float    @default(0.0) 

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  appointments   Appointment[]
  consultations Consultation[]
}

// 3. APPOINTMENT
model Appointment {
  id           String   @id @default(cuid())
  
  readableId   String?  @unique 

  date         String   
  startTime    String   
  endTime      String   
  type         String   
  status       String   @default("SCHEDULED")
  
  fee          Float    @default(500.0) 
  discount     Float    @default(0.0)

  // Tracks if WhatsApp reminder was sent
  reminderSent Boolean @default(false)

  doctor       String   
  patientName String   
  phone        String   

  patientId    String?
  patient      Patient? @relation(fields: [patientId], references: [id])
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  consultation Consultation?
}

// 4. CONSULTATION
model Consultation {
  id             String    @id @default(cuid())
  createdAt      DateTime  @default(now())
    
  symptoms       String
  diagnosis      String
  notes          String?
  doctorName     String
  reportUrl      String?   

  // âœ… FINANCIALS 
  discount       Float     @default(0.0)
  
  // ðŸ’° PAYMENT TRACKING (For Part-Payment)
  paymentMode    String?   @default("Cash") // Cash, UPI, Card, Wallet
  paidAmount     Float     @default(0.0)    // How much they actually paid

  appointmentId String?       @unique
  appointment   Appointment?  @relation(fields: [appointmentId], references: [id])

  patientId      String
  patient        Patient       @relation(fields: [patientId], references: [id])

  prescriptions Prescription[]
}

// 5. MEDICINE (Inventory)
model Medicine {
  id          String   @id @default(cuid())
  name        String   @unique
  type        String   
  stock       Int      @default(0)
  price       Float    @default(0)
  
  minStock    Int?     @default(10)
  mfgDate     DateTime?
  expDate     DateTime?

  items       PrescriptionItem[]
}

// 6. PRESCRIPTION
model Prescription {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())

  consultationId  String
  consultation    Consultation @relation(fields: [consultationId], references: [id], onDelete: Cascade)
  
  items           PrescriptionItem[]
}

// 7. PRESCRIPTION ITEM
model PrescriptionItem {
  id              String   @id @default(cuid())
  
  prescriptionId String
  prescription   Prescription @relation(fields: [prescriptionId], references: [id], onDelete: Cascade)
  
  medicineId      String
  medicine        Medicine @relation(fields: [medicineId], references: [id])

  dosage          String   
  duration        String   
  instruction     String
  
  unit            String?  
  panchkarma      String?  

  status          String   @default("PENDING") 
  dispensedQty    Int?     @default(0)
}

// 8. ONLINE APPOINTMENT REQUESTS
model AppointmentRequest {
  id        String   @id @default(cuid())
  name      String
  phone     String   
  symptoms  String?
  createdAt DateTime @default(now())
  status    String   @default("PENDING") 
}

// 9. COUNTER
model Counter {
  id    String @id @default(cuid())
  name  String @unique 
  value Int    @default(0)
}